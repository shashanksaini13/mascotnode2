/* version: 2.1.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).msc={},t.d3)}(this,(function(t,e){"use strict";function i(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}var s=i(e);class n{constructor(t,e,i,s){this.left=t,this.top=e,this.width=i,this.height=s}toJSON(){let t={};return t.left=this.left,t.top=this.top,t.width=this.width,t.height=this.height,t}union(t){let e=Math.min(this.left,t.left),i=Math.min(this.top,t.top),s=Math.max(this.right,t.right),r=Math.max(this.bottom,t.bottom);return new n(e,i,s-e,r-i)}clone(){return new n(this.left,this.top,this.width,this.height)}get right(){return this.left+this.width}get bottom(){return this.top+this.height}get x(){return(this.left+this.right)/2}get y(){return(this.top+this.bottom)/2}get center(){return(this.left+this.right)/2}get middle(){return(this.top+this.bottom)/2}contains(t,e){return this.left<=t&&this.right>=t&&this.top<=e&&this.bottom>=e}overlap(t){return!(this.right<t.left||this.bottom<t.top||this.left>t.right||this.top>t.bottom)}}const r="id",a="atlas_rowId",o=["linear","power","log","sqrt","symlog","identity","time","ordinal","band","point","ordinalColor","sequentialColor","divergingColor"],h="natural",l="basis",c="bumpX",u="bumpY",d="linear",f="step",p="CatmullRom",g="cardinal",m={Grid:"grid",Circular:"circular",Stack:"stack",Treemap:"treemap",Packing:"packing",Force:"force",TidyTree:"tidytree",Sugiyama:"sugiyama",Strata:"strata"},y={Vertical:"vertical",Horizontal:"horizontal",Angular:"angular",Radial:"radial"},v={Up:"up",Down:"down",Left:"left",Right:"right",Inward:"inward",Outward:"outward",Clockwise:"clockwise",Anticlockwise:"anticlockwise"},b={Top:"top",Left:"left",Bottom:"bottom",Right:"right",Center:"center",Middle:"middle"},x="alignment",w="affixation",k={Area:"area",Rect:"rect",Ellipse:"ellipse",Circle:"circle",Pie:"pie",Ring:"ring",Arc:"arc",Line:"line",Path:"path",Image:"image",PointText:"pointText",Collection:"collection",Group:"group",Scene:"scene",Axis:"axis",Glyph:"glyph",Legend:"legend",Polygon:"polygon",Gridlines:"gridlines",LinearGradient:"LinearGradient",Link:"link",DataTable:"datatable"},S={Boolean:"boolean",Integer:"integer",Number:"number",Date:"date",String:"string"},C="max",E="min",A="avg",T="median",I="count",O="mean",R="percentile 25",M="percentile 75",N={fillColor:"fill",strokeColor:"stroke",strokeWidth:"stroke-width",fillOpacity:"fill-opacity",strokeOpacity:"stroke-opacity",strokeDash:"stroke-dasharray",opacity:"opacity",fontSize:"font-size",fontFamily:"font-family",fontWeight:"font-weight",visibility:"visibility"},B="Cannot find relevant information to create an axis for ",F="Cannot change scale type to ",P={FIELD_NONEXISTENT:"Data field does not exist in the data table",INCOMPLETE_REPEAT_INFO:"Incomplete information to do repeat. You must specify an item, a categorical data field and a data table",REPEAT_BY_NONCAT:"Repeat only works on a string or date field",PARTITION_BY_NONCAT:"Divide only works on a string or date field",DENSIFY_BY_NONCAT:"Densify only works on a string or date field",INCOMPLETE_REPOPULATE_INFO:"Incomplete information to re-populate. You must specify an item, a categorical data field and a data table",REPOPULATE_BY_NONCAT:"Repopulate only works on a string or date field",REPOPULATE_DT_MISMATCH:"Cannot repopulate with a data table that is different from the item's parent's data table",COMPNT_NON_REPEATABLE:"Item not repeatable",REPEAT_NODE_LINK:"To repeat with a tree or a network, you need to provide two marks, one for node and one for link",INCOMPLETE_PARTITION_INFO:"Incomplete information to divide. You must specify an item, a categorical data field and a data table",COMPNT_NON_PARTITIONABLE:"Item cannot be divided",INCOMPLETE_DENSIFY_INFO:"Incomplete information to densify. You must specify an item, a categorical data field and a data table",COMPNT_NON_DENSIFIABLE:"Item cannot be densified",STRATIFY_WITHOUT_TREE:"Stratify only works on a tree dataset",STRATIFY_WRONG_ITEM:"Stratify only works on a circle or a rectangle",BIND_WITHOUT_DATASCOPE:"Item must be repeated or divided by data first before applyng binding",UNKNOWN_ALIGNMENT:"Unkown alignment",UNKNOWN_Orientation:"Unkown orientation",UNKNOWN_DIRECTION:"Unkown direction",UNKOWNN_SCALE_TYPE:"Unknown scale type",UNKNOWN_ANCHOR:"Unknown anchor",INCOMPLETE_BINDING_INFO:"Incomplete binding information. You must specify an item, a data field and a visual channel",MULTIPLE_VALUES_PER_FIELD:"Multiple distinct field values exist",DIFFERENT_SCALE_TYPE:"Cannot merge different types of scale",INSUFFICIENT_DATA_SCOPES:"Insufficient data to divide or densify a mark",INCORRECT_CONSTRAINT_INFO:"Constrain information is incorreclty passed",FEATURE_NOT_IMPLEMENTED:"This feature has not been implemented yet",LAYOUT_WITHOUT_TREE:"The layout can only be applied to a tree",UNSUPPORTED_FIELDTYPE:"Unsupported field type for encoding ",CANNOT_CLASSIFY:"Cannot classify items in ",CANNOT_CREATE_GLYPH:"Cannot create glyph. A glyph must consist of only paths or only texts, not a mixture of paths and texts"},V=["schemeCategory10","schemeAccent","schemeDark2","schemePaired","schemePastel1","schemePastel2","schemeSet1","schemeSet2","schemeSet3","schemeTableau10"],j=["schemeBrBG","schemePRGn","schemePiYG","schemePuOr","schemeRdBu","schemeRdGy","schemeRdYlBu","schemeRdYlGn","schemeSpectral"],L=["schemeBlues","schemeGreens","schemeGreys","schemeOranges","schemePurples","schemeReds","schemeBuGn","schemeBuPu","schemeGnBu","schemeOrRd","schemePuBuGn","schemePuBu","schemePuRd","schemeRdPu","schemeYlGnBu","schemeYlGn","schemeYlOrBr","schemeYlOrRd"];class D{constructor(t){let e=t||{};this._stops=[],this.type=k.LinearGradient,this.id=this.type+Fg[this.type]++,this.x1="x1"in e?e.x1:0,this.x2="x2"in e?e.x2:100,this.y1="y1"in e?e.y1:0,this.y2="y2"in e?e.y2:0}toJSON(){let t={};return t.type=this.type,t.id=this.id,t.x1=this.x1,t.x2=this.x2,t.y1=this.y1,t.y2=this.y2,t.stops=this._stops,t}addStop(t,e,i){this._stops.push({offset:t,color:e,opacity:i})}get stops(){return this._stops}}class z{constructor(t){if(this._dataScope=void 0,this._id=void 0,this.attrs={},this.styles={},this.staticProperties={},void 0!==t)for(let e in N)e in t&&(this.styles[e]=t[e])}get id(){return this._id}set id(t){this.getScene()?(delete this.getScene()._itemMap[this._id],this._id=t,this.getScene()._itemMap[t]=this):this._id=t}contains(t,e){if(!this._bounds)return!1;if(!this._bounds.contains(t,e))return!1;switch(this.type){case k.Rect:case k.PointText:return!0;case k.Circle:return Math.sqrt(Math.pow(t-this.x,2)+Math.pow(e-this.y,2))<=this.radius+this.strokeWidth;case k.Path:{let i=jg.getContext(),s=new Path2D(this.getSVGPathData());return i.lineWidth=Math.max(this.strokeWidth,2.5),i.stroke(s),this.closed?i.isPointInPath(s,t,e):i.isPointInStroke(s,t,e)}case k.Line:{let i=jg.getContext(),s=new Path2D(this.getSVGPathData());return i.lineWidth=Math.max(this.strokeWidth,2.5),i.stroke(s),i.isPointInStroke(s,t,e)}default:{let i=jg.getContext(),s=new Path2D(this.getSVGPathData());return i.isPointInPath(s,t,e)}}}toJSON(){let t={};t.type=this.type,t.id=this.id,this.classId&&(t.classId=this.classId),this._dataScope&&(t.dataScope=this._dataScope.toJSON()),t.args={};for(let e in this.attrs)t.args[e]=this.attrs[e];for(let e in this.styles)e.indexOf("Color")>0&&this.styles[e]instanceof D?t.args[e]=this.styles[e].toJSON():t.args[e]=this.styles[e];return t}getScene(){let t=this;for(;t;){if(t.type==k.Scene)return t;t=t.parent}}set dataScope(t){this._dataScope=t}get dataScope(){return this._dataScope}duplicate(){let t=this.getScene().mark(this.type);return this.copyPropertiesTo(t),t.classId=this.classId,this._dataScope&&(t._dataScope=this._dataScope.clone()),t}_doTranslate(t,e){}set visibility(t){this.styles.visibility=t}get visibility(){return this.styles.visibility?this.styles.visibility:"visible"}get opacity(){return"opacity"in this.styles?this.styles.opacity:1}set opacity(t){this.styles.opacity=t}}function G(t){return t>=-1e-12&&t<=1e-12}class W{constructor(t,e){this.x=t,this.y=e}transform(t){return t?t._transformPoint(this):this}negate(){return new W(-this.x,-this.y)}subtract(t){return new W(this.x-t.x,this.y-t.y)}isZero(){return G(this.x)&&G(this.y)}isCollinear(t){let e=this.x,i=this.y,s=t.x,n=t.y;return Math.abs(e*n-i*s)<=1e-8*Math.sqrt((e*e+i*i)*(s*s+n*n))}}class Y{constructor(t,e,i){this.type="vertex",this._id=i,this.x=t.x,this.y=t.y,this.dataScope=void 0,this.parent=e,this.shape=void 0,this.width=0,this.height=0,this.radius=0,this.fillColor="#555",this.opacity=1,this.strokeWidth=0,this.strokeColor="#aaa",this._polarAngle=void 0}get bounds(){switch(this.shape){case"rect":return new n(this.x-this.width/2,this.y-this.height/2,this.width,this.height);case"circle":return new n(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius);default:return new n(this.x-.5,this.y-.5,1,1)}}get id(){return this.parent.id+"_v_"+this._id}toJSON(){let t={};return t.type=this.type,t.id=this._id,t.x=this.x,t.y=this.y,this.dataScope&&(t.dataScope=this.dataScope.toJSON()),void 0!==this._polarAngle&&(t.polarAngle=this._polarAngle),t.shape=this.shape,t.width=this.width,t.height=this.height,t.radius=this.radius,t.fillColor=this.fillColor,t.opacity=this.opacity,t.strokeWidth=this.strokeWidth,t.strokeColor=this.strokeColor,t}static fromJSON(t,e){let i=new Y(t,e,t.id);return t.dataScope&&(i.dataScope=t.dataScope),"polarAngle"in t&&(i.polarAngle=t.polarAngle),i.shape=t.shape,i.width=t.width,i.height=t.height,i.radius=t.radius,i.fillColor=t.fillColor,i.opacity=t.opacity,i.strokeWidth=t.strokeWidth,i.strokeColor=t.strokeColor,i}_doTranslate(t,e){this.x+=t,this.y+=e}_clone(t){let e=new Y(new W(this.x,this.y),t,this._id);return this.dataScope&&(e.dataScope=this.dataScope.clone()),e.shape=this.shape,e.width=this.width,e.height=this.height,e.radius=this.radius,e.fillColor=this.fillColor,e.opacity=this.opacity,e.strokeWidth=this.strokeWidth,e.strokeColor=this.strokeColor,e}set polarAngle(t){this._polarAngle=t}get polarAngle(){return this._polarAngle}}Y.styles=["vxShape","vxWidth","vxHeight","vxRadius","vxFillColor","vxStrokeColor","vxStrokeWidth","vxOpacity"];class U{constructor(t,e,i,s){this.type="segment",this._id=s,this.vertex1=t,this.vertex2=e,this.dataScope=void 0,this.parent=i}get id(){return this.parent.id+"_s_"+this._id}_doTranslate(t,e){this.vertex1._doTranslate(t,e),this.vertex2._doTranslate(t,e)}get x(){return(this.vertex1.x+this.vertex2.x)/2}get y(){return(this.vertex1.y+this.vertex2.y)/2}}class q extends z{constructor(t){if(super(t),this.type="type"in t?t.type:k.Path,"strokeColor"in this.styles||(this.styles.strokeColor="#ccc"),"strokeWidth"in this.styles||(this.styles.strokeWidth=1),"strokeDash"in this.styles||(this.styles.strokeDash="none"),this.vertices=[],this.vertexCounter=0,this.segmentCounter=0,this.segments=[],this.anchor=void 0,this.closed=!1,this.curveMode="linear",this.boundsOffsets={top:0,bottom:0,left:0,right:0},this._vxShape=void 0,this._vxWidth=0,this._vxHeight=0,this._vxRadius=0,this._vxFillColor="#555555",this._vxStrokeColor="#aaaaaa",this._vxStrokeWidth=0,this._vxOpacity=1,void 0!==t){for(let e of Y.styles)e in t&&(this["_"+e]=t[e]);"vertices"in t&&this._setVertices(t.vertices)}}toJSON(){let t=super.toJSON();switch(t.type=this.type,t.id=this.id,this.type){case k.Rect:t.args.width=this.width,t.args.height=this.height,t.args.top=this.top,t.args.left=this.left;break;case k.Circle:t.args.x=this.x,t.args.y=this.y,t.args.radius=this.radius;break;case k.Arc:case k.Pie:t.args.x=this._x,t.args.y=this._y,t.args.innerRadius=this._innerRadius,t.args.outerRadius=this._outerRadius,t.args.startAngle=this._startAngle,t.args.endAngle=this._endAngle;break;case k.Link:t.args.mode=this.mode,t.args.directed=this.directed,t.args.sourceAnchor=this.sourceAnchor,t.args.targetAnchor=this.targetAnchor,t.args.sourceOffset=this.sourceOffset,t.args.targetOffset=this.targetOffset,t.args.source=this.source.id,t.args.target=this.target.id;break;default:t.vertices=[];for(let e of this.vertices)t.vertices.push(e.toJSON());this.type===k.Polygon?(t.args.x=this._x,t.args.y=this._y,t.args.radius=this._radius):this.type===k.Area&&(t.args.baseline=this._baseline,t.args.orientation=this._orientation)}t.vertexCounter=this.vertexCounter,t.segmentCounter=this.segmentCounter,t.curveMode=this.curveMode,this._bounds&&(t.bounds=this._bounds.toJSON()),t.boundsOffsets=this.boundsOffsets;for(let e of Y.styles)t.args[e]=this[e];return t}_setVertices(t){let e,i;this.vertices=[],this.segments=[];for(let s=0;s<t.length;s++)if(s!=t.length-1||t[s][0]!==t[0][0]||t[s][1]!==t[0][1]||this.type!==k.Path){i=new W(t[s][0],t[s][1]),e=new Y(i,this,this.vertexCounter++);for(let t of Y.styles)if(this[t]){let i=t.replace("vx","");e[i[0].toLowerCase()+i.slice(1)]=this[t]}this.vertices.push(e),s>0&&this.segments.push(new U(this.vertices[s-1],this.vertices[s],this,this.segmentCounter++))}let s=t[0],n=t[t.length-1];(s[0]===n[0]&&s[1]===n[1]||this.type===k.Rect)&&(this.closed=!0,"fillColor"in this.styles||(this.styles.fillColor="#fff"),this.segments.push(new U(this.vertices[this.vertices.length-1],this.vertices[0],this,this.segmentCounter++)))}copyPropertiesTo(t){t.attrs=Object.assign({},this.attrs),t.styles=Object.assign({},this.styles);for(let e of Y.styles)this["_"+e]&&(t["_"+e]=this["_"+e]);this._dataScope&&(t._dataScope=this._dataScope.clone()),t.closed=this.closed,t.curveMode=this.curveMode,t.vertices=[],t.segments=[];for(let e of this.vertices)t.vertices.push(e._clone(t));t.segmentCounter=0;for(let e=1;e<t.vertices.length;e++)t.segments.push(new U(t.vertices[e-1],t.vertices[e],t,t.segmentCounter++));t.closed&&t.segments.push(new U(t.vertices[t.vertices.length-1],t.vertices[0],t,t.segmentCounter++))}get bounds(){return this._bounds||this._updateBounds(),this._bounds}get refBounds(){this._bounds||this._updateBounds();let t=this._bounds.bottom+this.boundsOffsets.bottom-(this._bounds.top-this.boundsOffsets.top),e=this._bounds.right+this.boundsOffsets.right-(this._bounds.left-this.boundsOffsets.left);return new n(this._bounds.left-this.boundsOffsets.left,this._bounds.top-this.boundsOffsets.top,e,t)}get x(){return this.bounds.x}get y(){return this.bounds.y}get strokeColor(){return this.styles.strokeColor}set strokeColor(t){this.styles.strokeColor=t}get strokeWidth(){return this.styles.strokeWidth}set strokeWidth(t){this.styles.strokeWidth=t}get fillColor(){return this.styles.fillColor}set fillColor(t){this.styles.fillColor=t}get strokeDash(){return this.styles.strokeDash}set strokeDash(t){this.styles.strokeDash=t}_doTranslate(t,e){for(let i of this.vertices)i._doTranslate(t,e);this._updateBounds()}resize(t,e,i,s){let n=this.bounds,r=0===n.width?1:n.width,a=0===n.height?1:n.height;if("right"===i)for(let e of this.vertices)e.x=n.right-t/r*(n.right-e.x);else for(let e of this.vertices)e.x=n.left+t/r*(e.x-n.left);if("top"===s)for(let t of this.vertices)t.y=n.top+e/a*(t.y-n.top);else for(let t of this.vertices)t.y=n.bottom-e/a*(n.bottom-t.y);this._updateBounds()}_updateBounds(){let t=this.vertices.map((t=>t.x)),e=this.vertices.map((t=>t.y)),i=Math.min(...t),s=Math.min(...e),r=Math.max(...t),a=Math.max(...e);if(this._bounds=new n(i,s,r-i,a-s),this.type===k.Line||this.type===k.Path){let t=this.styles.strokeWidth?this.styles.strokeWidth:1;i===r?this._bounds=new n(i-t/2,s,r-i+t,a-s):s===a&&(this._bounds=new n(i,s-t/2,r-i,a-s+t))}}addVertex(t,e,i){let s=new Y(new W(t,e),this,this.vertexCounter++);this.vertices.splice(i,0,s)}sortVertices(t,e){this.vertices.sort(((e,i)=>e[t]-i[t])),e&&this.vertices.reverse();for(let t=0;t<this.segments.length;t++){let e=this.segments[t];e.vertex1=this.vertices[t],e.vertex2=this.vertices[(t+1)%this.vertices.length]}}sortVerticesByData(t,e,i){let s;s=i?(e,s)=>i.indexOf(e.dataScope.getFieldValue(t))-i.indexOf(s.dataScope.getFieldValue(t)):(e,i)=>e.dataScope.getFieldValue(t)<i.dataScope.getFieldValue(t)?-1:1,this.vertices.sort(s),e&&this.vertices.reverse();for(let t=0;t<this.segments.length;t++){let e=this.segments[t];e.vertex1=this.vertices[t],e.vertex2=this.vertices[(t+1)%this.vertices.length]}}getSVGPathData(){let t=s.path(),e=this._getD3CurveFunction(this.curveMode)(t);e.lineStart();for(let t of this.vertices)e.point(t.x,t.y);return this.closed&&e.point(this.vertices[0].x,this.vertices[0].y),e.lineEnd(),t._}get firstVertex(){return this.vertices[0]}get firstSegment(){return this.segments[0]}get lastVertex(){return this.vertices[this.vertices.length-1]}get lastSegment(){return this.segments[this.segments.length-1]}_getD3CurveFunction(t){switch(t){case h:return s.curveNatural;case l:return s.curveBasis;case c:return s.curveBumpX;case u:return s.curveBumpY;case d:return s.curveLinear;case f:return s.curveStep;case p:return s.curveCatmullRom;case g:return s.curveCardinal;default:return s.curveLinear}}get vxShape(){return this._vxShape}set vxShape(t){this._vxShape=t;for(let e of this.vertices)e.shape=t}get vxWidth(){return this._vxWidth}set vxWidth(t){this._vxWidth=t;for(let e of this.vertices)e.width=t}get vxHeight(){return this._vxHeight}set vxHeight(t){this._vxHeight=t;for(let e of this.vertices)e.height=t}get vxRadius(){return this._vxRadius}set vxRadius(t){this._vxRadius=t;for(let e of this.vertices)e.radius=t}get vxFillColor(){return this._vxFillColor}set vxFillColor(t){this._vxFillColor=t;for(let e of this.vertices)e.fillColor=t}get vxStrokeColor(){return this._vxStrokeColor}set vxStrokeColor(t){this._vxStrokeColor=t;for(let e of this.vertices)e.strokeColor=t}get vxStrokeWidth(){return this._vxStrokeWidth}set vxStrokeWidth(t){this._vxStrokeWidth=t;for(let e of this.vertices)e.strokeWidth=t}get vxOpacity(){return this._vxOpacity}set vxOpacity(t){this._vxOpacity=t;for(let e of this.vertices)e.opacity=t}}class J{constructor(t){this.group=void 0}run(){}clone(){}}class H extends J{constructor(t){super(),this.type="grid",this._numCols=t.numCols,this._numRows=t.numRows,this._dir="dir"in t?t.dir:[H.direction.Left2Right,H.direction.Top2Bottom],this._rowGap="rowGap"in t&&void 0!==t.rowGap?t.rowGap:5,this._colGap="colGap"in t&&void 0!==t.colGap?t.colGap:5,this._cellHorzAlignment="horzCellAlignment"in t&&this._validateCellAlignment("h",t.horzCellAlignment)?t.horzCellAlignment:b.Left,this._cellVertAlignment="vertCellAlignment"in t&&this._validateCellAlignment("v",t.vertCellAlignment)?t.vertCellAlignment:b.Bottom,this._numCols||this._numRows||(this._numRows=1)}_validateCellAlignment(t,e){return"h"===t&&[b.Left,b.Center,b.Right].indexOf(e)>=0||("v"===t&&[b.Top,b.Middle,b.Bottom].indexOf(e)>=0||(console.warn("Invalid alignment:",e),!1))}toJSON(){let t={args:{}};return t.type=this.type,t.args.numCols=this._numCols,t.args.numRows=this._numRows,t.args.colGap=this._colGap,t.args.rowGap=this._rowGap,t.args.horzCellAlignment=this._cellHorzAlignment,t.args.vertCellAlignment=this._cellVertAlignment,t.left=this._left,t.top=this._top,t.args.dir=this._dir,t}clone(){return new H({numCols:this._numCols,numRows:this._numRows,dir:this._dir,colGap:this._colGap,rowGap:this._rowGap})}get cellBounds(){let t,e,i=this.group,s=this._colGap,r=this._rowGap;this._numRows?(e=this._numRows,t=Math.ceil(this.group.children.length/this._numRows)):this._numCols&&(t=this._numCols,e=Math.ceil(this.group.children.length/this._numCols));let a=i.children.map((t=>t.bounds));if(void 0===this._left){let t=a.map((t=>t.left)),e=a.map((t=>t.top));this._left=Math.min(...t),this._top=Math.min(...e)}let o=a.map((t=>t.width)),h=a.map((t=>t.height)),l=Math.max(...o),c=Math.max(...h),u=0,d=i.getInternalEncodings("x"),f=i.getInternalEncodings("y"),p=i.getInternalEncodings("width"),g=i.getInternalEncodings("height");if(d.length>0){let t=d[d.length-1],e=t.scale.rangeExtent;u=t.scale.range[0],l=Math.max(e,l)}else p.length>0&&p[p.length-1]._rectNegativeValues&&(l=p[p.length-1].scale.rangeExtent,u=p[p.length-1].scale.range[0]);if(f.length>0){let t=f[f.length-1].scale.rangeExtent;c=Math.max(t,c)}else g.length>0&&g[g.length-1]._rectNegativeValues&&(c=g[g.length-1].scale.rangeExtent);let _=[],m=e*t;switch(this._dir[0]){case H.direction.Left2Right:switch(this._dir[1]){case H.direction.Top2Bottom:for(let e=0;e<m;e++)_.push(new n(this._left+(l+s)*(e%t)+u,this._top+(c+r)*Math.floor(e/t),l,c));break;case H.direction.Bottom2Top:for(let e=0;e<m;e++)_.push(new n(this._left+(l+s)*(e%t)+u,this._top+(this.numRows-1-Math.floor(e/t))*(c+r),l,c))}break;case H.direction.Right2Left:switch(this._dir[1]){case H.direction.Top2Bottom:for(let e=0;e<m;e++)_.push(new n(u+this._left+(t-1)*(l+s)-(l+s)*(e%t),this._top+(c+r)*Math.floor(e/t),l,c));break;case H.direction.Bottom2Top:for(let e=0;e<m;e++)_.push(new n(u+this._left+(t-1-e%t)*(l+s),this._top+(this.numRows-1-Math.floor(e/t))*(c+r),l,c))}break;case H.direction.Top2Bottom:switch(this._dir[1]){case H.direction.Left2Right:for(let t=0;t<m;t++)_.push(new n(u+this._left+(l+s)*Math.floor(t/this.numRows),this._top+(c+r)*(t%this.numRows),l,c));break;case H.direction.Right2Left:for(let t=0;t<m;t++)_.push(new n(u+this._left+(l+s)*(this.numCols-1)-(l+s)*Math.floor(t/this.numRows),this._top+(c+r)*(t%this.numRows),l,c))}break;case H.direction.Bottom2Top:switch(this._dir[1]){case H.direction.Left2Right:for(let t=0;t<m;t++)_.push(new n(u+this._left+(l+s)*Math.floor(t/this.numRows),this._top+(c+r)*(this.numRows-1)-(c+r)*(t%this.numRows),l,c));break;case H.direction.Right2Left:for(let t=0;t<m;t++)_.push(new n(u+this._left+(l+s)*(this.numCols-1)-(l+s)*Math.floor(t/this.numRows),this._top+(c+r)*(this.numRows-1)-(c+r)*(t%this.numRows),l,c))}}return _}run(){if(null==this.group||!this.group.children||0===this.group.children.length)return;let t=this.cellBounds,e=this.group.getInternalEncodings("x"),i=this.group.getInternalEncodings("y"),s=this.group.getInternalEncodings("width"),n=this.group.getInternalEncodings("height");for(let s=0;s<this.group.children.length;s++){let n=this.group.children[s],r=t[s],a=r.x-n.bounds.x,o=r.y-n.bounds.y;n._doTranslate(a,o);let h=0,l=0;if(0==e.length)switch(this._cellHorzAlignment){case b.Left:h=r.left-n.bounds.left;break;case b.Center:h=r.x-n.bounds.x;break;case b.Right:h=r.right-n.bounds.right}if(0==i.length)switch(this._cellVertAlignment){case b.Top:l=r.top-n.bounds.top;break;case b.Middle:l=r.y-n.bounds.y;break;case b.Bottom:l=r.bottom-n.bounds.bottom}n._doTranslate(h,l)}if(e.length>0)for(let t of e)t._apply();else if(s.length>0){let t=s[s.length-1];t._rectNegativeValues&&t._apply()}if(i.length>0)for(let t of i)t._apply();else if(n.length>0){let t=n[n.length-1];t._rectNegativeValues&&t._apply()}this.group._updateBounds()}set rowGap(t){this._rowGap=t,this.run(),this.group.getScene()._relayoutAncestors(this.group)}get rowGap(){return this._rowGap}set colGap(t){this._colGap=t,this.run(),this.group.getScene()._relayoutAncestors(this.group)}get colGap(){return this._colGap}set numCols(t){t<0||t>this.group.children.length?console.warn("Cannot set",t,"columns for",this.group.children.length,"items in grid"):(this._numCols=t,this._numRows=Math.ceil(this.group.children.length/t),this.run(),this.group.getScene()._relayoutAncestors(this.group))}get numCols(){return this._numCols?this._numCols:this._numRows?Math.ceil(this.group.children.length/this._numRows):0}set numRows(t){t<0||t>this.group.children.length?console.warn("Cannot set",t,"rows for",this.group.children.length,"items in grid"):(this._numRows=t,this._numCols=Math.ceil(this.group.children.length/t),this.run(),this.group.getScene()._relayoutAncestors(this.group))}get numRows(){return this._numRows?this._numRows:this._numCols?Math.ceil(this.group.children.length/this._numCols):0}set vertCellAlignment(t){if(t!=b.Top&&t!=b.Bottom&&t!=b.Middle)throw P.UNKOWN_ALIGNMENT;this._cellVertAlignment=t,this.run()}get vertCellAlignment(){return this._cellVertAlignment}set horzCellAlignment(t){if(t!=b.Left&&t!=b.Center&&t!=b.Right)throw P.UNKOWN_ALIGNMENT;this._cellHorzAlignment=t,this.run()}get horzCellAlignment(){return this._cellHorzAlignment}set direction(t){Array.isArray(t)&&2===t.length?this._dir=t:this._dir=t.split("_"),this.run()}get direction(){return this._dir.join("_")}}H.direction={Left2Right:"l2r",Right2Left:"r2l",Top2Bottom:"t2b",Bottom2Top:"b2t"};class X extends J{constructor(t){super(t),this.type="packing",this.x="x"in t?t.x:400,this.y="y"in t?t.y:400,this.width=t.width,this.height=t.height}toJSON(){let t={args:{}};return t.type=this.type,t.args.x=this.x,t.args.y=this.y,t.args.width=this.width,t.args.height=this.height,t}clone(){return new X({x:this.x,y:this.y,width:this.width,height:this.height})}run(){if(null==this.group)return;let t=this.group.children.map((t=>({name:t.id,radius:t.radius,itm:t}))),e=t.reduce(((t,e)=>t+Math.pow(e.radius,2)),0),i=Math.sqrt(e);void 0===this.width&&(this.width=i),void 0===this.height&&(this.height=i);let n=s.hierarchy({name:"root",children:t}).sum((t=>t.radius?t.radius:0)).sort(((t,e)=>e.value-t.value));s.pack().size([this.width,this.height]).radius((t=>t.value))(n);for(let t of n.children){let e=t.data.itm,i=this.x-n.x+t.x-e.x,s=this.y-n.y+t.y-e.y;e._doTranslate(i,s)}this.group._updateBounds()}}class $ extends J{constructor(t){super(t),this.type="treemap",this._width=t.width,this._height=t.height,this._top=t.top,this._left=t.left}toJSON(){let t={args:{}};return t.type=this.type,t.args.left=this._left,t.args.top=this._top,t.args.width=this._width,t.args.height=this._height,t}clone(){return new $({width:this._width,height:this._height,top:this._top,left:this._left})}run(){if(null==this.group||!this.group.children||0==this.group.children.length)return;let t=this._width?this._width:this.group.bounds.width,e=this._height?this._height:this.group.bounds.height,i=void 0===this._top?this.group.bounds.top:this._top,n=void 0===this._left?this.group.bounds.left:this._left,r=s.hierarchy(this.group).sum((t=>"rect"==t.type?t.bounds.width*t.bounds.height:0));s.treemap().size([t,e])(r),this._apply(r,n,i),this.group.getScene()._updateAncestorBounds(r.leaves()[0].data)}_apply(t,e,i){if("collection"==t.data.type&&t.children)for(let s of t.children)this._apply(s,e,i);else"rect"==t.data.type&&(t.data.resize(t.x1-t.x0,t.y1-t.y0),t.data._doTranslate(t.x0+e-t.data.bounds.left,t.y0+i-t.data.bounds.top))}get width(){return this._width}set width(t){this._width=t,this.run()}get height(){return this._width}set height(t){this._height=t,this.run()}get top(){return this._top}set top(t){this._top=t,this.run()}get left(){return this._left}set left(t){this._left=t,this.run()}}function Z(t){return[...new Set(t)]}function K(t,e){if(e.hasField(t))return!0;if(e.tree&&e.tree.nodeTable.hasField(t.split(".")[1]))return!0;throw new Error(P.FIELD_NONEXISTENT+", field: "+t+", data table: "+e.name)}function Q(t){return t<0?t+360:t>360?t-360:t}class tt extends J{constructor(t){super(t),this.type=m.Stack,this._orientation=t.orientation,this._direction=t.direction,this._left=t.left,this._top=t.top,this._horzCellAlignment="horzCellAlignment"in t&&t.horzCellAlignment?t.horzCellAlignment:b.Left,this._vertCellAlignment="vertCellAlignment"in t&&t.vertCellAlignment?t.vertCellAlignment:b.Bottom,this._gap="gap"in t?t.gap:0}toJSON(){let t={args:{}};return t.type=this.type,t.args.orientation=this._orientation,t.args.direction=this._direction,t.args.left=this._left,t.args.top=this._top,t.args.gap=this._gap,t.args.horzCellAlignment=this._horzCellAlignment,t.args.vertCellAlignment=this._vertCellAlignment,t}clone(){let t=new tt({orientation:this._orientation,direction:this._direction,left:this._left,top:this._top});return t._horzCellAlignment=this._horzCellAlignment,t._vertCellAlignment=this._vertCellAlignment,t}_stackAreasVert(){let t=this.group.children,e=this.group.bounds,i=this._vertCellAlignment===b.Top?e.top:e.bottom,s=this._vertCellAlignment===b.Top?1:-1,n=t[0].vertices.length/2,r=new Array(n).fill(0);for(let e of t){for(let t=0;t<n;t++){let a=e.vertices[t],o=e.vertices[2*n-t-1],h=Math.abs(a.y-o.y),l=i+r[t]*s,c=i+(r[t]+h)*s;a._doTranslate(0,l-a.y),o._doTranslate(0,c-o.y),r[t]+=h}e._updateBounds()}if(this.vertCellAlignment===b.Middle)for(let i of t){for(let t=0;t<n;t++){let s=i.vertices[t],a=i.vertices[2*n-t-1],o=e.middle+r[t]/2;s._doTranslate(0,o-e.bottom),a._doTranslate(0,o-e.bottom)}i._updateBounds()}this.group._updateBounds()}_stackAreasHorz(){let t=this.group.children,e=this.group.bounds,i=this._horzCellAlignment===b.Right?e.right:e.left,s=this._horzCellAlignment===b.Right?-1:1,n=t[0].vertices.length/2,r=new Array(n).fill(0);for(let e of t){for(let t=0;t<n;t++){let a=e.vertices[t],o=e.vertices[2*n-t-1],h=Math.abs(a.x-o.x),l=i+r[t]*s,c=i+(r[t]+h)*s;a._doTranslate(0,l-a.y),o._doTranslate(0,c-o.y),r[t]+=h}e._updateBounds()}if(this._horzCellAlignment===b.Center)for(let i of t){for(let t=0;t<n;t++){let s=i.vertices[t],a=i.vertices[2*n-t-1],o=e.center-r[t]/2;s._doTranslate(0,o-e.left),a._doTranslate(0,o-e.left)}i._updateBounds()}this.group._updateBounds()}_stackAreas(){this.group.children[0].orientation===y.Horizontal?this._stackAreasVert():this._stackAreasHorz()}_stackArcs(){let t=this.group;if(this._orientation===y.Angular){let e=this.startAngle?this.startAngle:90;if((this._direction?this._direction:v.Clockwise)===v.Clockwise)for(let i of t.children){let t=Q(e-i.angle);i.adjustAngle(t,e),e=t}else for(let i of t.children){let t=Q(e+i.angle);i.adjustAngle(e,t),e=t}}}_stackRects(){let t=this.group.getScene(),e=this.group,i=this._orientation,s=e.children.map((t=>t.bounds)),n=s.map((t=>t.left)),r=s.map((t=>t.top)),a=s.map((t=>t.width)),o=s.map((t=>t.height)),h=null==this._left?Math.min(...n):this._left,l=null==this._top?Math.min(...r):this._top,c=Math.max(...a),u=Math.max(...o);if(i==y.Vertical){let i=h+c/2;for(let s=0;s<e.children.length;s++){let n=e.children[s],r=i-n.bounds.x,a=l+n.bounds.height/2-n.bounds.y;l+=n.bounds.height+this._gap,n._doTranslate(r,a);let o=0,u=0;if(!t.getEncodingByItem(n,"x"))switch(this._horzCellAlignment){case b.Left:o=h-n.bounds.left;break;case b.Center:o=h+c/2-n.bounds.x;break;case b.Right:o=h+c-n.bounds.right}n._doTranslate(o,u)}}else{let i=l+u/2;for(let s=0;s<e.children.length;s++){let n=e.children[s],r=h+n.bounds.width/2-n.bounds.x,a=i-n.bounds.y;h+=n.bounds.width+this._gap,n._doTranslate(r,a);let o=0,c=0;if(!t.getEncodingByItem(n,"y"))switch(this._vertCellAlignment){case b.Top:c=l-n.bounds.top;break;case b.Middle:c=l+u/2-n.bounds.y;break;case b.Bottom:c=l+u-n.bounds.bottom}n._doTranslate(o,c)}}this.group._updateBounds()}run(){if(null==this.group||!this.group.children||0===this.group.children.length)return;let t=Ig(this.group)[0];switch(t.type){case k.Area:this._stackAreas();break;case k.Arc:case k.Pie:t.parent===this.group&&this._stackArcs();break;case k.Rect:case k.Image:case k.Circle:this._stackRects()}}set vertCellAlignment(t){if(t!=b.Top&&t!=b.Bottom&&t!=b.Middle)throw P.UNKOWN_ALIGNMENT;this._vertCellAlignment=t,this.run()}get vertCellAlignment(){return this._vertCellAlignment}set horzCellAlignment(t){if(t!=b.Left&&t!=b.Center&&t!=b.Right)throw P.UNKOWN_ALIGNMENT;this._horzCellAlignment=t,this.run()}get horzCellAlignment(){return this._horzCellAlignment}get cellBounds(){return this.group.children.map((t=>t.bounds))}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this.run()}}class et extends J{constructor(t){super(t),this.type=m.TidyTree,this._width="width"in t?t.width:500,this._height="height"in t?t.height:500,this._left="left"in t?t.left:100,this._top="top"in t?t.top:100,this._orientation="orientation"in t?t.orientation:y.Horizontal}toJSON(){let t={args:{}};return t.args.type=this.type,t.args.orientation=this._orientation,t.args.left=this._left,t.args.top=this._top,t.args.width=this._width,t.args.height=this._height,t}run(){if(null==this.group)return;let t=this.group.children[0].dataScope._dt;if(!t.tree)throw P.LAYOUT_WITHOUT_TREE;{let e=s.hierarchy(t.tree._data),i=Math.max(...this.group.children.map((t=>t.bounds.width))),n=Math.max(...this.group.children.map((t=>t.bounds.height))),r=this._orientation==y.Horizontal?[this._height,this._width]:[this._width,this._height],a=s.tree().nodeSize([i,n]).size(r)(e);this._apply(a,this.group),this.group._updateBounds(),this.group.getScene()._updateAncestorBounds(this.group)}}_apply(t,e){let i,s,n=e.children.filter((e=>e.dataScope.getFieldValue(r)==t.data[r]))[0];switch(this._orientation){case y.Horizontal:i=t.y+this._left,s=t.x+this._top;break;case y.Vertical:i=t.x+this._left,s=this._top+t.y}if(n.x=i,n.y=s,t.children&&t.children.length>0)for(let i of t.children)this._apply(i,e)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this.run()}get width(){return this._width}set width(t){this._width=t,this.run()}get height(){return this._width}set height(t){this._height=t,this.run()}get size(){return[this._width,this._height]}set size(t){this._width=t[0],this._height=t[1],this.run()}}class it extends J{constructor(t){super(t),this.type=m.Force,this._x="x"in t?t.x:0,this._y="y"in t?t.y:0,this._iterations="iterations"in t?t.iterations:1,this._repulsion="repulsion"in t?t.repulsion:30,this._attraction="attraction"in t?t.attraction:1,this._linkDistance="linkDistance"in t?t.linkDistance:30}toJSON(){let t={args:{}};return t.type=this.type,t.args.x=this._x,t.args.y=this._y,t.args.iterations=this._iterations,t}run(){if(null==this.group)return;let t=this.group.children[0].dataScope._dt.graph;if(t){let e=t.links.map((e=>({source:t.getNode(e.source),target:t.getNode(e.target)}))),i=s.forceSimulation(t.nodes).force("charge",s.forceManyBody().strength(-this._repulsion)).force("link",s.forceLink(e).id((t=>t.id)).distance(this._linkDistance)).force("x",s.forceX()).force("y",s.forceY()).force("center",s.forceCenter(this._x,this._y).strength(this._attraction));i.stop(),i.tick(this._iterations);for(let e=0;e<this.group.children.length;e++)this.group.children[e].x=t.nodes[e].x,this.group.children[e].y=t.nodes[e].y;this.group._updateBounds(),this.group.getScene()._updateAncestorBounds(this.group)}}}var st,nt,rt,at,ot,ht,lt,ct,ut,dt,ft,pt,gt,_t,mt,yt,vt,bt,xt,wt,kt,St,Ct,Et,At,Tt,It,Ot,Rt,Mt,Nt,Bt,Ft,Pt,Vt,jt,Lt,Dt,zt,Gt,Wt,Yt,Ut,qt,Jt,Ht,Xt,$t,Zt,Kt,Qt,te,ee,ie,se,ne,re,ae,oe,he,le,ce,ue,de,fe,pe,ge,_e,me,ye,ve,be,xe,we,ke,Se,Ce,Ee,Ae,Te,Ie,Oe,Re,Me,Ne,Be,Fe,Pe,Ve,je,Le,De,ze,Ge,We,Ye,Ue,qe,Je,He,Xe,$e,Ze,Ke,Qe,ti,ei,ii,si="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ni(){if(at)return rt;return at=1,rt=function(t,e){return t===e||t!=t&&e!=e}}function ri(){if(ht)return ot;ht=1;var t=ni();return ot=function(e,i){for(var s=e.length;s--;)if(t(e[s][0],i))return s;return-1}}function ai(){if(yt)return mt;yt=1;var t=nt?st:(nt=1,st=function(){this.__data__=[],this.size=0}),e=function(){if(ct)return lt;ct=1;var t=ri(),e=Array.prototype.splice;return lt=function(i){var s=this.__data__,n=t(s,i);return!(n<0||(n==s.length-1?s.pop():e.call(s,n,1),--this.size,0))}}(),i=function(){if(dt)return ut;dt=1;var t=ri();return ut=function(e){var i=this.__data__,s=t(i,e);return s<0?void 0:i[s][1]}}(),s=function(){if(pt)return ft;pt=1;var t=ri();return ft=function(e){return t(this.__data__,e)>-1}}(),n=function(){if(_t)return gt;_t=1;var t=ri();return gt=function(e,i){var s=this.__data__,n=t(s,e);return n<0?(++this.size,s.push([e,i])):s[n][1]=i,this}}();function r(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}return r.prototype.clear=t,r.prototype.delete=e,r.prototype.get=i,r.prototype.has=s,r.prototype.set=n,mt=r}function oi(){if(Tt)return At;Tt=1;var t="object"==typeof si&&si&&si.Object===Object&&si;return At=t}function hi(){if(Ot)return It;Ot=1;var t=oi(),e="object"==typeof self&&self&&self.Object===Object&&self,i=t||e||Function("return this")();return It=i}function li(){if(Mt)return Rt;Mt=1;var t=hi().Symbol;return Rt=t}function ci(){if(jt)return Vt;jt=1;var t=li(),e=function(){if(Bt)return Nt;Bt=1;var t=li(),e=Object.prototype,i=e.hasOwnProperty,s=e.toString,n=t?t.toStringTag:void 0;return Nt=
/**
		 * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
		 *
		 * @private
		 * @param {*} value The value to query.
		 * @returns {string} Returns the raw `toStringTag`.
		 */
function(t){var e=i.call(t,n),r=t[n];try{t[n]=void 0;var a=!0}catch(t){}var o=s.call(t);return a&&(e?t[n]=r:delete t[n]),o}}(),i=function(){if(Pt)return Ft;Pt=1;var t=Object.prototype.toString;return Ft=function(e){return t.call(e)}}(),s=t?t.toStringTag:void 0;return Vt=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?e(t):i(t)}}function ui(){if(Dt)return Lt;return Dt=1,Lt=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}}function di(){if(Gt)return zt;Gt=1;var t=ci(),e=ui();return zt=function(i){if(!e(i))return!1;var s=t(i);return"[object Function]"==s||"[object GeneratorFunction]"==s||"[object AsyncFunction]"==s||"[object Proxy]"==s}}function fi(){if(qt)return Ut;qt=1;var t,e=function(){if(Yt)return Wt;Yt=1;var t=hi()["__core-js_shared__"];return Wt=t}(),i=(t=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||""))?"Symbol(src)_1."+t:"";return Ut=function(t){return!!i&&i in t}}function pi(){if(Ht)return Jt;Ht=1;var t=Function.prototype.toString;return Jt=function(e){if(null!=e){try{return t.call(e)}catch(t){}try{return e+""}catch(t){}}return""}}function gi(){if(te)return Qt;te=1;var t=function(){if($t)return Xt;$t=1;var t=di(),e=fi(),i=ui(),s=pi(),n=/^\[object .+?Constructor\]$/,r=Function.prototype,a=Object.prototype,o=r.toString,h=a.hasOwnProperty,l=RegExp("^"+o.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return Xt=function(r){return!(!i(r)||e(r))&&(t(r)?l:n).test(s(r))}}(),e=Kt?Zt:(Kt=1,Zt=function(t,e){return null==t?void 0:t[e]});return Qt=function(i,s){var n=e(i,s);return t(n)?n:void 0}}function _i(){if(ie)return ee;ie=1;var t=gi()(hi(),"Map");return ee=t}function mi(){if(ne)return se;ne=1;var t=gi()(Object,"create");return se=t}function yi(){if(_e)return ge;_e=1;var t=function(){if(ae)return re;ae=1;var t=mi();return re=function(){this.__data__=t?t(null):{},this.size=0}}(),e=he?oe:(he=1,oe=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}),i=function(){if(ce)return le;ce=1;var t=mi(),e=Object.prototype.hasOwnProperty;return le=function(i){var s=this.__data__;if(t){var n=s[i];return"__lodash_hash_undefined__"===n?void 0:n}return e.call(s,i)?s[i]:void 0}}(),s=function(){if(de)return ue;de=1;var t=mi(),e=Object.prototype.hasOwnProperty;return ue=function(i){var s=this.__data__;return t?void 0!==s[i]:e.call(s,i)}}(),n=function(){if(pe)return fe;pe=1;var t=mi();return fe=function(e,i){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=t&&void 0===i?"__lodash_hash_undefined__":i,this}}();function r(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}return r.prototype.clear=t,r.prototype.delete=e,r.prototype.get=i,r.prototype.has=s,r.prototype.set=n,ge=r}function vi(){if(we)return xe;we=1;var t=be?ve:(be=1,ve=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t});return xe=function(e,i){var s=e.__data__;return t(i)?s["string"==typeof i?"string":"hash"]:s.map}}function bi(){if(Me)return Re;Me=1;var t=function(){if(ye)return me;ye=1;var t=yi(),e=ai(),i=_i();return me=function(){this.size=0,this.__data__={hash:new t,map:new(i||e),string:new t}}}(),e=function(){if(Se)return ke;Se=1;var t=vi();return ke=function(e){var i=t(this,e).delete(e);return this.size-=i?1:0,i}}(),i=function(){if(Ee)return Ce;Ee=1;var t=vi();return Ce=function(e){return t(this,e).get(e)}}(),s=function(){if(Te)return Ae;Te=1;var t=vi();return Ae=function(e){return t(this,e).has(e)}}(),n=function(){if(Oe)return Ie;Oe=1;var t=vi();return Ie=function(e,i){var s=t(this,e),n=s.size;return s.set(e,i),this.size+=s.size==n?0:1,this}}();function r(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}return r.prototype.clear=t,r.prototype.delete=e,r.prototype.get=i,r.prototype.has=s,r.prototype.set=n,Re=r}function xi(){if(Pe)return Fe;Pe=1;var t=ai(),e=function(){if(bt)return vt;bt=1;var t=ai();return vt=function(){this.__data__=new t,this.size=0}}(),i=wt?xt:(wt=1,xt=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}),s=St?kt:(St=1,kt=function(t){return this.__data__.get(t)}),n=Et?Ct:(Et=1,Ct=function(t){return this.__data__.has(t)}),r=function(){if(Be)return Ne;Be=1;var t=ai(),e=_i(),i=bi();return Ne=function(s,n){var r=this.__data__;if(r instanceof t){var a=r.__data__;if(!e||a.length<199)return a.push([s,n]),this.size=++r.size,this;r=this.__data__=new i(a)}return r.set(s,n),this.size=r.size,this}}();function a(e){var i=this.__data__=new t(e);this.size=i.size}return a.prototype.clear=e,a.prototype.delete=i,a.prototype.get=s,a.prototype.has=n,a.prototype.set=r,Fe=a}
/**
	 * A specialized version of `_.forEach` for arrays without support for
	 * iteratee shorthands.
	 *
	 * @private
	 * @param {Array} [array] The array to iterate over.
	 * @param {Function} iteratee The function invoked per iteration.
	 * @returns {Array} Returns `array`.
	 */function wi(){if(je)return Ve;return je=1,Ve=function(t,e){for(var i=-1,s=null==t?0:t.length;++i<s&&!1!==e(t[i],i,t););return t}}function ki(){if(De)return Le;De=1;var t=gi(),e=function(){try{var e=t(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();return Le=e}function Si(){if(Ge)return ze;Ge=1;var t=ki();return ze=function(e,i,s){"__proto__"==i&&t?t(e,i,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[i]=s}}function Ci(){if(Ye)return We;Ye=1;var t=Si(),e=ni(),i=Object.prototype.hasOwnProperty;return We=function(s,n,r){var a=s[n];i.call(s,n)&&e(a,r)&&(void 0!==r||n in s)||t(s,n,r)}}function Ei(){if(qe)return Ue;qe=1;var t=Ci(),e=Si();return Ue=function(i,s,n,r){var a=!n;n||(n={});for(var o=-1,h=s.length;++o<h;){var l=s[o],c=r?r(n[l],i[l],l,n,i):void 0;void 0===c&&(c=i[l]),a?e(n,l,c):t(n,l,c)}return n}}function Ai(){if($e)return Xe;return $e=1,Xe=function(t){return null!=t&&"object"==typeof t}}function Ti(){if(ti)return Qe;ti=1;var t=function(){if(Ke)return Ze;Ke=1;var t=ci(),e=Ai();return Ze=function(i){return e(i)&&"[object Arguments]"==t(i)}}(),e=Ai(),i=Object.prototype,s=i.hasOwnProperty,n=i.propertyIsEnumerable,r=t(function(){return arguments}())?t:function(t){return e(t)&&s.call(t,"callee")&&!n.call(t,"callee")};return Qe=r}function Ii(){if(ii)return ei;ii=1;var t=Array.isArray;return ei=t}var Oi,Ri,Mi,Ni,Bi,Fi,Pi,Vi,ji,Li,Di,zi={exports:{}};function Gi(){return Mi||(Mi=1,function(t,e){var i=hi(),s=Ri?Oi:(Ri=1,Oi=function(){return!1}),n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,a=r&&r.exports===n?i.Buffer:void 0,o=(a?a.isBuffer:void 0)||s;t.exports=o}(zi,zi.exports)),zi.exports}function Wi(){if(Bi)return Ni;Bi=1;var t=/^(?:0|[1-9]\d*)$/;return Ni=function(e,i){var s=typeof e;return!!(i=null==i?9007199254740991:i)&&("number"==s||"symbol"!=s&&t.test(e))&&e>-1&&e%1==0&&e<i}}function Yi(){if(Pi)return Fi;Pi=1;return Fi=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}}function Ui(){if(Di)return Li;return Di=1,Li=function(t){return function(e){return t(e)}}}zi.exports;var qi,Ji,Hi,Xi,$i,Zi,Ki,Qi,ts,es,is,ss,ns,rs,as,os,hs,ls,cs,us,ds,fs,ps,gs,_s,ms,ys,vs={exports:{}};function bs(){return qi||(qi=1,function(t,e){var i=oi(),s=e&&!e.nodeType&&e,n=s&&t&&!t.nodeType&&t,r=n&&n.exports===s&&i.process,a=function(){try{var t=n&&n.require&&n.require("util").types;return t||r&&r.binding&&r.binding("util")}catch(t){}}();t.exports=a}(vs,vs.exports)),vs.exports}function xs(){if(Hi)return Ji;Hi=1;var t=function(){if(ji)return Vi;ji=1;var t=ci(),e=Yi(),i=Ai(),s={};return s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,Vi=function(n){return i(n)&&e(n.length)&&!!s[t(n)]}}(),e=Ui(),i=bs(),s=i&&i.isTypedArray,n=s?e(s):t;return Ji=n}function ws(){if($i)return Xi;$i=1;var t=He?Je:(He=1,Je=function(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}),e=Ti(),i=Ii(),s=Gi(),n=Wi(),r=xs(),a=Object.prototype.hasOwnProperty;return Xi=function(o,h){var l=i(o),c=!l&&e(o),u=!l&&!c&&s(o),d=!l&&!c&&!u&&r(o),f=l||c||u||d,p=f?t(o.length,String):[],g=p.length;for(var _ in o)!h&&!a.call(o,_)||f&&("length"==_||u&&("offset"==_||"parent"==_)||d&&("buffer"==_||"byteLength"==_||"byteOffset"==_)||n(_,g))||p.push(_);return p}}function ks(){if(Ki)return Zi;Ki=1;var t=Object.prototype;return Zi=function(e){var i=e&&e.constructor;return e===("function"==typeof i&&i.prototype||t)}}function Ss(){if(ts)return Qi;return ts=1,Qi=function(t,e){return function(i){return t(e(i))}}}function Cs(){if(ns)return ss;ns=1;var t=ks(),e=function(){if(is)return es;is=1;var t=Ss()(Object.keys,Object);return es=t}(),i=Object.prototype.hasOwnProperty;return ss=function(s){if(!t(s))return e(s);var n=[];for(var r in Object(s))i.call(s,r)&&"constructor"!=r&&n.push(r);return n}}function Es(){if(as)return rs;as=1;var t=di(),e=Yi();return rs=function(i){return null!=i&&e(i.length)&&!t(i)}}function As(){if(hs)return os;hs=1;var t=ws(),e=Cs(),i=Es();return os=function(s){return i(s)?t(s):e(s)}}function Ts(){if(ps)return fs;ps=1;var t=ui(),e=ks(),i=ds?us:(ds=1,us=function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}),s=Object.prototype.hasOwnProperty;return fs=function(n){if(!t(n))return i(n);var r=e(n),a=[];for(var o in n)("constructor"!=o||!r&&s.call(n,o))&&a.push(o);return a}}function Is(){if(_s)return gs;_s=1;var t=ws(),e=Ts(),i=Es();return gs=function(s){return i(s)?t(s,!0):e(s)}}vs.exports;var Os,Rs,Ms,Ns,Bs,Fs,Ps,Vs,js,Ls,Ds,zs,Gs,Ws,Ys,Us,qs,Js,Hs,Xs,$s,Zs,Ks,Qs,tn,en,sn,nn,rn,an,on,hn,ln,cn,un,dn,fn,pn,gn,_n,mn,yn,vn,bn,xn,wn,kn,Sn,Cn,En,An,Tn,In,On,Rn,Mn,Nn,Bn,Fn,Pn,Vn,jn,Ln,Dn,zn,Gn,Wn,Yn,Un,qn,Jn,Hn,Xn,$n,Zn,Kn,Qn,tr,er,ir,sr,nr,rr,ar,or,hr,lr,cr,ur,dr,fr,pr,gr,_r,mr,yr,vr,br,xr,wr,kr,Sr,Cr,Er,Ar,Tr,Ir,Or,Rr,Mr,Nr,Br,Fr,Pr,Vr,jr,Lr,Dr,zr,Gr,Wr,Yr,Ur,qr,Jr,Hr,Xr,$r,Zr,Kr,Qr,ta,ea,ia,sa,na,ra,aa,oa,ha,la,ca,ua,da,fa,pa,ga,_a,ma,ya,va,ba,xa,wa,ka,Sa,Ca,Ea,Aa,Ta,Ia,Oa,Ra,Ma,Na,Ba,Fa,Pa,Va,ja,La,Da,za,Ga,Wa,Ya,Ua,qa,Ja,Ha,Xa,$a,Za,Ka,Qa,to,eo,io,so,no,ro,ao,oo,ho,lo,co,uo,fo,po,go,_o,mo,yo,vo,bo,xo,wo,ko,So,Co,Eo,Ao,To,Io,Oo,Ro,Mo,No,Bo,Fo,Po,Vo,jo,Lo,Do,zo,Go,Wo,Yo,Uo,qo,Jo,Ho,Xo,$o,Zo,Ko,Qo,th,eh,ih,sh,nh,rh,ah,oh,hh,lh,ch,uh,dh,fh,ph,gh,_h,mh,yh,vh,bh,xh,wh,kh,Sh,Ch,Eh,Ah,Th,Ih,Oh,Rh,Mh,Nh,Bh,Fh,Ph,Vh,jh,Lh,Dh,zh,Gh={exports:{}};function Wh(){return Os||(Os=1,function(t,e){var i=hi(),s=e&&!e.nodeType&&e,n=s&&t&&!t.nodeType&&t,r=n&&n.exports===s?i.Buffer:void 0,a=r?r.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var i=t.length,s=a?a(i):new t.constructor(i);return t.copy(s),s}}(Gh,Gh.exports)),Gh.exports}function Yh(){if(Ms)return Rs;return Ms=1,Rs=function(t,e){var i=-1,s=t.length;for(e||(e=Array(s));++i<s;)e[i]=t[i];return e}}
/**
	 * A specialized version of `_.filter` for arrays without support for
	 * iteratee shorthands.
	 *
	 * @private
	 * @param {Array} [array] The array to iterate over.
	 * @param {Function} predicate The function invoked per iteration.
	 * @returns {Array} Returns the new filtered array.
	 */function Uh(){if(Bs)return Ns;return Bs=1,Ns=function(t,e){for(var i=-1,s=null==t?0:t.length,n=0,r=[];++i<s;){var a=t[i];e(a,i,t)&&(r[n++]=a)}return r}}function qh(){if(Ps)return Fs;return Ps=1,Fs=function(){return[]}}function Jh(){if(js)return Vs;js=1;var t=Uh(),e=qh(),i=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols;return Vs=s?function(e){return null==e?[]:(e=Object(e),t(s(e),(function(t){return i.call(e,t)})))}:e}function Hh(){if(Gs)return zs;return Gs=1,zs=function(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}}function Xh(){if(Ys)return Ws;Ys=1;var t=Ss()(Object.getPrototypeOf,Object);return Ws=t}function $h(){if(qs)return Us;qs=1;var t=Hh(),e=Xh(),i=Jh(),s=qh(),n=Object.getOwnPropertySymbols;return Us=n?function(s){for(var n=[];s;)t(n,i(s)),s=e(s);return n}:s}function Zh(){if($s)return Xs;$s=1;var t=Hh(),e=Ii();return Xs=function(i,s,n){var r=s(i);return e(i)?r:t(r,n(i))}}function Kh(){if(Ks)return Zs;Ks=1;var t=Zh(),e=Jh(),i=As();return Zs=function(s){return t(s,i,e)}}function Qh(){if(on)return an;on=1;var t=gi()(hi(),"Set");return an=t}function tl(){if(un)return cn;un=1;var t=function(){if(sn)return en;sn=1;var t=gi()(hi(),"DataView");return en=t}(),e=_i(),i=function(){if(rn)return nn;rn=1;var t=gi()(hi(),"Promise");return nn=t}(),s=Qh(),n=function(){if(ln)return hn;ln=1;var t=gi()(hi(),"WeakMap");return hn=t}(),r=ci(),a=pi(),o="[object Map]",h="[object Promise]",l="[object Set]",c="[object WeakMap]",u="[object DataView]",d=a(t),f=a(e),p=a(i),g=a(s),_=a(n),m=r;return(t&&m(new t(new ArrayBuffer(1)))!=u||e&&m(new e)!=o||i&&m(i.resolve())!=h||s&&m(new s)!=l||n&&m(new n)!=c)&&(m=function(t){var e=r(t),i="[object Object]"==e?t.constructor:void 0,s=i?a(i):"";if(s)switch(s){case d:return u;case f:return o;case p:return h;case g:return l;case _:return c}return e}),cn=m}function el(){if(gn)return pn;gn=1;var t=hi().Uint8Array;return pn=t}function il(){if(mn)return _n;mn=1;var t=el();return _n=function(e){var i=new e.constructor(e.byteLength);return new t(i).set(new t(e)),i}}function sl(){if(Cn)return Sn;Cn=1;var t=il();return Sn=function(e,i){var s=i?t(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}}function nl(){if(An)return En;An=1;var t=il(),e=function(){if(vn)return yn;vn=1;var t=il();return yn=function(e,i){var s=i?t(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}}(),i=function(){if(xn)return bn;xn=1;var t=/\w*$/;return bn=function(e){var i=new e.constructor(e.source,t.exec(e));return i.lastIndex=e.lastIndex,i}}(),s=function(){if(kn)return wn;kn=1;var t=li(),e=t?t.prototype:void 0,i=e?e.valueOf:void 0;return wn=function(t){return i?Object(i.call(t)):{}}}(),n=sl();return En=function(r,a,o){var h=r.constructor;switch(a){case"[object ArrayBuffer]":return t(r);case"[object Boolean]":case"[object Date]":return new h(+r);case"[object DataView]":return e(r,o);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return n(r,o);case"[object Map]":case"[object Set]":return new h;case"[object Number]":case"[object String]":return new h(r);case"[object RegExp]":return i(r);case"[object Symbol]":return s(r)}}}function rl(){if(In)return Tn;In=1;var t=ui(),e=Object.create,i=function(){function i(){}return function(s){if(!t(s))return{};if(e)return e(s);i.prototype=s;var n=new i;return i.prototype=void 0,n}}();return Tn=i}function al(){if(Rn)return On;Rn=1;var t=rl(),e=Xh(),i=ks();return On=function(s){return"function"!=typeof s.constructor||i(s)?{}:t(e(s))}}function ol(){if(Fn)return Bn;Fn=1;var t=function(){if(Nn)return Mn;Nn=1;var t=tl(),e=Ai();return Mn=function(i){return e(i)&&"[object Map]"==t(i)}}(),e=Ui(),i=bs(),s=i&&i.isMap,n=s?e(s):t;return Bn=n}function hl(){if(Ln)return jn;Ln=1;var t=function(){if(Vn)return Pn;Vn=1;var t=tl(),e=Ai();return Pn=function(i){return e(i)&&"[object Set]"==t(i)}}(),e=Ui(),i=bs(),s=i&&i.isSet,n=s?e(s):t;return jn=n}function ll(){if(zn)return Dn;zn=1;var t=xi(),e=wi(),i=Ci(),s=function(){if(cs)return ls;cs=1;var t=Ei(),e=As();return ls=function(i,s){return i&&t(s,e(s),i)}}(),n=function(){if(ys)return ms;ys=1;var t=Ei(),e=Is();return ms=function(i,s){return i&&t(s,e(s),i)}}(),r=Wh(),a=Yh(),o=function(){if(Ds)return Ls;Ds=1;var t=Ei(),e=Jh();return Ls=function(i,s){return t(i,e(i),s)}}(),h=function(){if(Hs)return Js;Hs=1;var t=Ei(),e=$h();return Js=function(i,s){return t(i,e(i),s)}}(),l=Kh(),c=function(){if(tn)return Qs;tn=1;var t=Zh(),e=$h(),i=Is();return Qs=function(s){return t(s,i,e)}}(),u=tl(),d=function(){if(fn)return dn;fn=1;var t=Object.prototype.hasOwnProperty;return dn=function(e){var i=e.length,s=new e.constructor(i);return i&&"string"==typeof e[0]&&t.call(e,"index")&&(s.index=e.index,s.input=e.input),s}}(),f=nl(),p=al(),g=Ii(),_=Gi(),m=ol(),y=ui(),v=hl(),b=As(),x=Is(),w="[object Arguments]",k="[object Function]",S="[object Object]",C={};return C[w]=C["[object Array]"]=C["[object ArrayBuffer]"]=C["[object DataView]"]=C["[object Boolean]"]=C["[object Date]"]=C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Map]"]=C["[object Number]"]=C[S]=C["[object RegExp]"]=C["[object Set]"]=C["[object String]"]=C["[object Symbol]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C["[object Error]"]=C[k]=C["[object WeakMap]"]=!1,Dn=function E(A,T,I,O,R,M){var N,B=1&T,F=2&T,P=4&T;if(I&&(N=R?I(A,O,R,M):I(A)),void 0!==N)return N;if(!y(A))return A;var V=g(A);if(V){if(N=d(A),!B)return a(A,N)}else{var j=u(A),L=j==k||"[object GeneratorFunction]"==j;if(_(A))return r(A,B);if(j==S||j==w||L&&!R){if(N=F||L?{}:p(A),!B)return F?h(A,n(N,A)):o(A,s(N,A))}else{if(!C[j])return R?A:{};N=f(A,j,B)}}M||(M=new t);var D=M.get(A);if(D)return D;M.set(A,N),v(A)?A.forEach((function(t){N.add(E(t,T,I,t,A,M))})):m(A)&&A.forEach((function(t,e){N.set(e,E(t,T,I,e,A,M))}));var z=V?void 0:(P?F?c:l:F?x:b)(A);return e(z||A,(function(t,e){z&&(t=A[e=t]),i(N,e,E(t,T,I,e,A,M))})),N},Dn}function cl(){if(Wn)return Gn;Wn=1;var t=ll();return Gn=function(e){return t(e,4)}}function ul(){if(Un)return Yn;return Un=1,Yn=function(t){return function(){return t}}}function dl(){if(Xn)return Hn;Xn=1;var t=(Jn?qn:(Jn=1,qn=function(t){return function(e,i,s){for(var n=-1,r=Object(e),a=s(e),o=a.length;o--;){var h=a[t?o:++n];if(!1===i(r[h],h,r))break}return e}}))();return Hn=t}function fl(){if(Zn)return $n;Zn=1;var t=dl(),e=As();return $n=function(i,s){return i&&t(i,s,e)}}function pl(){if(er)return tr;er=1;var t=fl(),e=function(){if(Qn)return Kn;Qn=1;var t=Es();return Kn=function(e,i){return function(s,n){if(null==s)return s;if(!t(s))return e(s,n);for(var r=s.length,a=i?r:-1,o=Object(s);(i?a--:++a<r)&&!1!==n(o[a],a,o););return s}}}()(t);return tr=e}function gl(){if(sr)return ir;return sr=1,ir=function(t){return t}}function _l(){if(rr)return nr;rr=1;var t=gl();return nr=function(e){return"function"==typeof e?e:t}}function ml(){if(or)return ar;or=1;var t=wi(),e=pl(),i=_l(),s=Ii();return ar=function(n,r){return(s(n)?t:e)(n,i(r))}}function yl(){return lr?hr:(lr=1,hr=ml())}function vl(){if(mr)return _r;mr=1;var t=bi(),e=fr?dr:(fr=1,dr=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this}),i=gr?pr:(gr=1,pr=function(t){return this.__data__.has(t)});function s(e){var i=-1,s=null==e?0:e.length;for(this.__data__=new t;++i<s;)this.add(e[i])}return s.prototype.add=s.prototype.push=e,s.prototype.has=i,_r=s}
/**
	 * A specialized version of `_.some` for arrays without support for iteratee
	 * shorthands.
	 *
	 * @private
	 * @param {Array} [array] The array to iterate over.
	 * @param {Function} predicate The function invoked per iteration.
	 * @returns {boolean} Returns `true` if any element passes the predicate check,
	 *  else `false`.
	 */function bl(){if(xr)return br;return xr=1,br=function(t,e){return t.has(e)}}function xl(){if(kr)return wr;kr=1;var t=vl(),e=vr?yr:(vr=1,yr=function(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}),i=bl();return wr=
/**
		 * A specialized version of `baseIsEqualDeep` for arrays with support for
		 * partial deep comparisons.
		 *
		 * @private
		 * @param {Array} array The array to compare.
		 * @param {Array} other The other array to compare.
		 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
		 * @param {Function} customizer The function to customize comparisons.
		 * @param {Function} equalFunc The function to determine equivalents of values.
		 * @param {Object} stack Tracks traversed `array` and `other` objects.
		 * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
		 */
function(s,n,r,a,o,h){var l=1&r,c=s.length,u=n.length;if(c!=u&&!(l&&u>c))return!1;var d=h.get(s),f=h.get(n);if(d&&f)return d==n&&f==s;var p=-1,g=!0,_=2&r?new t:void 0;for(h.set(s,n),h.set(n,s);++p<c;){var m=s[p],y=n[p];if(a)var v=l?a(y,m,p,n,s,h):a(m,y,p,s,n,h);if(void 0!==v){if(v)continue;g=!1;break}if(_){if(!e(n,(function(t,e){if(!i(_,e)&&(m===t||o(m,t,r,a,h)))return _.push(e)}))){g=!1;break}}else if(m!==y&&!o(m,y,r,a,h)){g=!1;break}}return h.delete(s),h.delete(n),g}}function wl(){if(Ar)return Er;return Ar=1,Er=function(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}}function kl(){if(Ir)return Tr;Ir=1;var t=li(),e=el(),i=ni(),s=xl(),n=Cr?Sr:(Cr=1,Sr=function(t){var e=-1,i=Array(t.size);return t.forEach((function(t,s){i[++e]=[s,t]})),i}),r=wl(),a=t?t.prototype:void 0,o=a?a.valueOf:void 0;return Tr=
/**
		 * A specialized version of `baseIsEqualDeep` for comparing objects of
		 * the same `toStringTag`.
		 *
		 * **Note:** This function only supports comparing values with tags of
		 * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
		 *
		 * @private
		 * @param {Object} object The object to compare.
		 * @param {Object} other The other object to compare.
		 * @param {string} tag The `toStringTag` of the objects to compare.
		 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
		 * @param {Function} customizer The function to customize comparisons.
		 * @param {Function} equalFunc The function to determine equivalents of values.
		 * @param {Object} stack Tracks traversed `object` and `other` objects.
		 * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
		 */
function(t,a,h,l,c,u,d){switch(h){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!u(new e(t),new e(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var f=n;case"[object Set]":var p=1&l;if(f||(f=r),t.size!=a.size&&!p)return!1;var g=d.get(t);if(g)return g==a;l|=2,d.set(t,a);var _=s(f(t),f(a),l,c,u,d);return d.delete(t),_;case"[object Symbol]":if(o)return o.call(t)==o.call(a)}return!1}}function Sl(){if(Nr)return Mr;Nr=1;var t=xi(),e=xl(),i=kl(),s=function(){if(Rr)return Or;Rr=1;var t=Kh(),e=Object.prototype.hasOwnProperty;return Or=
/**
		 * A specialized version of `baseIsEqualDeep` for objects with support for
		 * partial deep comparisons.
		 *
		 * @private
		 * @param {Object} object The object to compare.
		 * @param {Object} other The other object to compare.
		 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
		 * @param {Function} customizer The function to customize comparisons.
		 * @param {Function} equalFunc The function to determine equivalents of values.
		 * @param {Object} stack Tracks traversed `object` and `other` objects.
		 * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
		 */
function(i,s,n,r,a,o){var h=1&n,l=t(i),c=l.length;if(c!=t(s).length&&!h)return!1;for(var u=c;u--;){var d=l[u];if(!(h?d in s:e.call(s,d)))return!1}var f=o.get(i),p=o.get(s);if(f&&p)return f==s&&p==i;var g=!0;o.set(i,s),o.set(s,i);for(var _=h;++u<c;){var m=i[d=l[u]],y=s[d];if(r)var v=h?r(y,m,d,s,i,o):r(m,y,d,i,s,o);if(!(void 0===v?m===y||a(m,y,n,r,o):v)){g=!1;break}_||(_="constructor"==d)}if(g&&!_){var b=i.constructor,x=s.constructor;b==x||!("constructor"in i)||!("constructor"in s)||"function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x||(g=!1)}return o.delete(i),o.delete(s),g}}(),n=tl(),r=Ii(),a=Gi(),o=xs(),h="[object Arguments]",l="[object Array]",c="[object Object]",u=Object.prototype.hasOwnProperty;return Mr=
/**
		 * A specialized version of `baseIsEqual` for arrays and objects which performs
		 * deep comparisons and tracks traversed objects enabling objects with circular
		 * references to be compared.
		 *
		 * @private
		 * @param {Object} object The object to compare.
		 * @param {Object} other The other object to compare.
		 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
		 * @param {Function} customizer The function to customize comparisons.
		 * @param {Function} equalFunc The function to determine equivalents of values.
		 * @param {Object} [stack] Tracks traversed `object` and `other` objects.
		 * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
		 */
function(d,f,p,g,_,m){var y=r(d),v=r(f),b=y?l:n(d),x=v?l:n(f),w=(b=b==h?c:b)==c,k=(x=x==h?c:x)==c,S=b==x;if(S&&a(d)){if(!a(f))return!1;y=!0,w=!1}if(S&&!w)return m||(m=new t),y||o(d)?e(d,f,p,g,_,m):i(d,f,b,p,g,_,m);if(!(1&p)){var C=w&&u.call(d,"__wrapped__"),E=k&&u.call(f,"__wrapped__");if(C||E){var A=C?d.value():d,T=E?f.value():f;return m||(m=new t),_(A,T,p,g,m)}}return!!S&&(m||(m=new t),s(d,f,p,g,_,m))}}function Cl(){if(Fr)return Br;Fr=1;var t=Sl(),e=Ai();return Br=function i(s,n,r,a,o){return s===n||(null==s||null==n||!e(s)&&!e(n)?s!=s&&n!=n:t(s,n,r,a,i,o))},Br}function El(){if(Lr)return jr;Lr=1;var t=ui();return jr=function(e){return e==e&&!t(e)}}function Al(){if(Wr)return Gr;return Wr=1,Gr=function(t,e){return function(i){return null!=i&&(i[t]===e&&(void 0!==e||t in Object(i)))}}}function Tl(){if(Ur)return Yr;Ur=1;var t=function(){if(Vr)return Pr;Vr=1;var t=xi(),e=Cl();return Pr=function(i,s,n,r){var a=n.length,o=a,h=!r;if(null==i)return!o;for(i=Object(i);a--;){var l=n[a];if(h&&l[2]?l[1]!==i[l[0]]:!(l[0]in i))return!1}for(;++a<o;){var c=(l=n[a])[0],u=i[c],d=l[1];if(h&&l[2]){if(void 0===u&&!(c in i))return!1}else{var f=new t;if(r)var p=r(u,d,c,i,s,f);if(!(void 0===p?e(d,u,3,r,f):p))return!1}}return!0}}(),e=function(){if(zr)return Dr;zr=1;var t=El(),e=As();return Dr=function(i){for(var s=e(i),n=s.length;n--;){var r=s[n],a=i[r];s[n]=[r,a,t(a)]}return s}}
/**
	 * A specialized version of `matchesProperty` for source values suitable
	 * for strict equality comparisons, i.e. `===`.
	 *
	 * @private
	 * @param {string} key The key of the property to get.
	 * @param {*} srcValue The value to match.
	 * @returns {Function} Returns the new spec function.
	 */(),i=Al();return Yr=function(s){var n=e(s);return 1==n.length&&n[0][2]?i(n[0][0],n[0][1]):function(e){return e===s||t(e,s,n)}}}function Il(){if(Jr)return qr;Jr=1;var t=ci(),e=Ai();return qr=function(i){return"symbol"==typeof i||e(i)&&"[object Symbol]"==t(i)}}function Ol(){if(Xr)return Hr;Xr=1;var t=Ii(),e=Il(),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;return Hr=function(n,r){if(t(n))return!1;var a=typeof n;return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=n&&!e(n))||(s.test(n)||!i.test(n)||null!=r&&n in Object(r))}}function Rl(){if(Qr)return Kr;Qr=1;var t=function(){if(Zr)return $r;Zr=1;var t=bi();function e(i,s){if("function"!=typeof i||null!=s&&"function"!=typeof s)throw new TypeError("Expected a function");var n=function(){var t=arguments,e=s?s.apply(this,t):t[0],r=n.cache;if(r.has(e))return r.get(e);var a=i.apply(this,t);return n.cache=r.set(e,a)||r,a};return n.cache=new(e.Cache||t),n}return e.Cache=t,$r=e}();return Kr=
/**
		 * A specialized version of `_.memoize` which clears the memoized function's
		 * cache when it exceeds `MAX_MEMOIZE_SIZE`.
		 *
		 * @private
		 * @param {Function} func The function to have its output memoized.
		 * @returns {Function} Returns the new memoized function.
		 */
function(e){var i=t(e,(function(t){return 500===s.size&&s.clear(),t})),s=i.cache;return i}}function Ml(){if(sa)return ia;return sa=1,ia=function(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}}function Nl(){if(oa)return aa;oa=1;var t=function(){if(ra)return na;ra=1;var t=li(),e=Ml(),i=Ii(),s=Il(),n=t?t.prototype:void 0,r=n?n.toString:void 0;return na=function t(n){if("string"==typeof n)return n;if(i(n))return e(n,t)+"";if(s(n))return r?r.call(n):"";var a=n+"";return"0"==a&&1/n==-1/0?"-0":a},na}();return aa=function(e){return null==e?"":t(e)}}function Bl(){if(la)return ha;la=1;var t=Ii(),e=Ol(),i=function(){if(ea)return ta;ea=1;var t=Rl(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,s=t((function(t){var s=[];return 46===t.charCodeAt(0)&&s.push(""),t.replace(e,(function(t,e,n,r){s.push(n?r.replace(i,"$1"):e||t)})),s}));return ta=s}
/**
	 * A specialized version of `_.map` for arrays without support for iteratee
	 * shorthands.
	 *
	 * @private
	 * @param {Array} [array] The array to iterate over.
	 * @param {Function} iteratee The function invoked per iteration.
	 * @returns {Array} Returns the new mapped array.
	 */(),s=Nl();return ha=function(n,r){return t(n)?n:e(n,r)?[n]:i(s(n))}}function Fl(){if(ua)return ca;ua=1;var t=Il();return ca=function(e){if("string"==typeof e||t(e))return e;var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i}}function Pl(){if(fa)return da;fa=1;var t=Bl(),e=Fl();return da=function(i,s){for(var n=0,r=(s=t(s,i)).length;null!=i&&n<r;)i=i[e(s[n++])];return n&&n==r?i:void 0}}function Vl(){if(va)return ya;va=1;var t=Bl(),e=Ti(),i=Ii(),s=Wi(),n=Yi(),r=Fl();return ya=function(a,o,h){for(var l=-1,c=(o=t(o,a)).length,u=!1;++l<c;){var d=r(o[l]);if(!(u=null!=a&&h(a,d)))break;a=a[d]}return u||++l!=c?u:!!(c=null==a?0:a.length)&&n(c)&&s(d,c)&&(i(a)||e(a))}}function jl(){if(xa)return ba;xa=1;var t=ma?_a:(ma=1,_a=function(t,e){return null!=t&&e in Object(t)}),e=Vl();return ba=function(i,s){return null!=i&&e(i,s,t)}}function Ll(){if(ka)return wa;ka=1;var t=Cl(),e=function(){if(ga)return pa;ga=1;var t=Pl();return pa=function(e,i,s){var n=null==e?void 0:t(e,i);return void 0===n?s:n}}(),i=jl(),s=Ol(),n=El(),r=Al(),a=Fl();return wa=function(o,h){return s(o)&&n(h)?r(a(o),h):function(s){var n=e(s,o);return void 0===n&&n===h?i(s,o):t(h,n,3)}}}function Dl(){if(Ca)return Sa;return Ca=1,Sa=function(t){return function(e){return null==e?void 0:e[t]}}}function zl(){if(Ia)return Ta;Ia=1;var t=Dl(),e=function(){if(Aa)return Ea;Aa=1;var t=Pl();
/**
		 * A specialized version of `baseProperty` which supports deep paths.
		 *
		 * @private
		 * @param {Array|string} path The path of the property to get.
		 * @returns {Function} Returns the new accessor function.
		 */return Ea=function(e){return function(i){return t(i,e)}}}(),i=Ol(),s=Fl();return Ta=function(n){return i(n)?t(s(n)):e(n)}}function Gl(){if(Ra)return Oa;Ra=1;var t=Tl(),e=Ll(),i=gl(),s=Ii(),n=zl();return Oa=function(r){return"function"==typeof r?r:null==r?i:"object"==typeof r?s(r)?e(r[0],r[1]):t(r):n(r)}}function Wl(){if(Na)return Ma;Na=1;var t=Uh(),e=function(){if(ur)return cr;ur=1;var t=pl();return cr=function(e,i){var s=[];return t(e,(function(t,e,n){i(t,e,n)&&s.push(t)})),s}}(),i=Gl(),s=Ii();return Ma=function(n,r){return(s(n)?t:e)(n,i(r,3))}}function Yl(){if(Va)return Pa;Va=1;var t=function(){if(Fa)return Ba;Fa=1;var t=Object.prototype.hasOwnProperty;return Ba=function(e,i){return null!=e&&t.call(e,i)}}(),e=Vl();return Pa=function(i,s){return null!=i&&e(i,s,t)}}function Ul(){if(La)return ja;La=1;var t=Cs(),e=tl(),i=Ti(),s=Ii(),n=Es(),r=Gi(),a=ks(),o=xs(),h=Object.prototype.hasOwnProperty;return ja=function(l){if(null==l)return!0;if(n(l)&&(s(l)||"string"==typeof l||"function"==typeof l.splice||r(l)||o(l)||i(l)))return!l.length;var c=e(l);if("[object Map]"==c||"[object Set]"==c)return!l.size;if(a(l))return!t(l).length;for(var u in l)if(h.call(l,u))return!1;return!0}}function ql(){if(za)return Da;return za=1,Da=function(t){return void 0===t}}function Jl(){if(Wa)return Ga;Wa=1;var t=pl(),e=Es();return Ga=function(i,s){var n=-1,r=e(i)?Array(i.length):[];return t(i,(function(t,e,i){r[++n]=s(t,e,i)})),r}}function Hl(){if(Ua)return Ya;Ua=1;var t=Ml(),e=Gl(),i=Jl(),s=Ii();return Ya=function(n,r){return(s(n)?t:i)(n,e(r,3))}}
/**
	 * A specialized version of `_.reduce` for arrays without support for
	 * iteratee shorthands.
	 *
	 * @private
	 * @param {Array} [array] The array to iterate over.
	 * @param {Function} iteratee The function invoked per iteration.
	 * @param {*} [accumulator] The initial value.
	 * @param {boolean} [initAccum] Specify using the first element of `array` as
	 *  the initial value.
	 * @returns {*} Returns the accumulated value.
	 */function Xl(){if(Za)return $a;Za=1;var t=Ja?qa:(Ja=1,qa=function(t,e,i,s){var n=-1,r=null==t?0:t.length;for(s&&r&&(i=t[++n]);++n<r;)i=e(i,t[n],n,t);return i}),e=pl(),i=Gl(),s=Xa?Ha:(Xa=1,Ha=function(t,e,i,s,n){return n(t,(function(t,n,r){i=s?(s=!1,t):e(i,t,n,r)})),i}),n=Ii();return $a=function(r,a,o){var h=n(r)?t:s,l=arguments.length<3;return h(r,i(a,4),o,l,e)},$a}function $l(){if(oo)return ao;oo=1;var t=function(){if(eo)return to;eo=1;var t=Dl()("length");return to=t}(),e=function(){if(so)return io;so=1;var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");return io=function(e){return t.test(e)}}(),i=function(){if(ro)return no;ro=1;var t="\\ud800-\\udfff",e="["+t+"]",i="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",s="\\ud83c[\\udffb-\\udfff]",n="[^"+t+"]",r="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",o="(?:"+i+"|"+s+")?",h="[\\ufe0e\\ufe0f]?",l=h+o+"(?:\\u200d(?:"+[n,r,a].join("|")+")"+h+o+")*",c="(?:"+[n+i+"?",i,r,a,e].join("|")+")",u=RegExp(s+"(?="+s+")|"+c+l,"g");return no=function(t){for(var e=u.lastIndex=0;u.test(t);)++e;return e}}();return ao=function(s){return e(s)?i(s):t(s)}}function Zl(){if(lo)return ho;lo=1;var t=Cs(),e=tl(),i=Es(),s=function(){if(Qa)return Ka;Qa=1;var t=ci(),e=Ii(),i=Ai();return Ka=function(s){return"string"==typeof s||!e(s)&&i(s)&&"[object String]"==t(s)}}(),n=$l();return ho=function(r){if(null==r)return 0;if(i(r))return s(r)?n(r):r.length;var a=e(r);return"[object Map]"==a||"[object Set]"==a?r.size:t(r).length}}function Kl(){if(uo)return co;uo=1;var t=wi(),e=rl(),i=fl(),s=Gl(),n=Xh(),r=Ii(),a=Gi(),o=di(),h=ui(),l=xs();return co=function(c,u,d){var f=r(c),p=f||a(c)||l(c);if(u=s(u,4),null==d){var g=c&&c.constructor;d=p?f?new g:[]:h(c)&&o(g)?e(n(c)):{}}return(p?t:i)(c,(function(t,e,i){return u(d,t,e,i)})),d}}function Ql(){if(_o)return go;_o=1;var t=Hh(),e=function(){if(po)return fo;po=1;var t=li(),e=Ti(),i=Ii(),s=t?t.isConcatSpreadable:void 0;return fo=function(t){return i(t)||e(t)||!!(s&&t&&t[s])}}();return go=function i(s,n,r,a,o){var h=-1,l=s.length;for(r||(r=e),o||(o=[]);++h<l;){var c=s[h];n>0&&r(c)?n>1?i(c,n-1,r,a,o):t(o,c):a||(o[o.length]=c)}return o},go}function tc(){if(bo)return vo;bo=1;var t=yo?mo:(yo=1,mo=function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}),e=Math.max;return vo=
/**
		 * A specialized version of `baseRest` which transforms the rest array.
		 *
		 * @private
		 * @param {Function} func The function to apply a rest parameter to.
		 * @param {number} [start=func.length-1] The start position of the rest parameter.
		 * @param {Function} transform The rest array transform.
		 * @returns {Function} Returns the new function.
		 */
function(i,s,n){return s=e(void 0===s?i.length-1:s,0),function(){for(var r=arguments,a=-1,o=e(r.length-s,0),h=Array(o);++a<o;)h[a]=r[s+a];a=-1;for(var l=Array(s+1);++a<s;)l[a]=r[a];return l[s]=n(h),t(i,this,l)}},vo}function ec(){if(Eo)return Co;Eo=1;var t=function(){if(wo)return xo;wo=1;var t=ul(),e=ki(),i=gl();return xo=e?function(i,s){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(s),writable:!0})}:i}(),e=function(){if(So)return ko;So=1;var t=Date.now;return ko=function(e){var i=0,s=0;return function(){var n=t(),r=16-(n-s);if(s=n,r>0){if(++i>=800)return arguments[0]}else i=0;return e.apply(void 0,arguments)}},ko}(),i=e(t);return Co=i}function ic(){if(To)return Ao;To=1;var t=gl(),e=tc(),i=ec();return Ao=function(s,n){return i(e(s,n,t),s+"")}}function sc(){if(Oo)return Io;return Oo=1,Io=function(t,e,i,s){for(var n=t.length,r=i+(s?1:-1);s?r--:++r<n;)if(e(t[r],r,t))return r;return-1}}function nc(){if(Po)return Fo;Po=1;var t=sc(),e=Mo?Ro:(Mo=1,Ro=function(t){return t!=t}),i=Bo?No:(Bo=1,No=function(t,e,i){for(var s=i-1,n=t.length;++s<n;)if(t[s]===e)return s;return-1});return Fo=function(s,n,r){return n==n?i(s,n,r):t(s,e,r)}}function rc(){if(Yo)return Wo;Yo=1;var t=Qh(),e=Go?zo:(Go=1,zo=function(){}),i=wl(),s=t&&1/i(new t([,-0]))[1]==1/0?function(e){return new t(e)}:e;return Wo=s}function ac(){if(qo)return Uo;qo=1;var t=vl(),e=function(){if(jo)return Vo;jo=1;var t=nc();
/**
		 * A specialized version of `_.includes` for arrays without support for
		 * specifying an index to search from.
		 *
		 * @private
		 * @param {Array} [array] The array to inspect.
		 * @param {*} target The value to search for.
		 * @returns {boolean} Returns `true` if `target` is found, else `false`.
		 */return Vo=function(e,i){return!(null==e||!e.length)&&t(e,i,0)>-1}}(),i=Do?Lo:(Do=1,Lo=function(t,e,i){for(var s=-1,n=null==t?0:t.length;++s<n;)if(i(e,t[s]))return!0;return!1}),s=bl(),n=rc(),r=wl();return Uo=function(a,o,h){var l=-1,c=e,u=a.length,d=!0,f=[],p=f;if(h)d=!1,c=i;else if(u>=200){var g=o?null:n(a);if(g)return r(g);d=!1,c=s,p=new t}else p=o?[]:f;t:for(;++l<u;){var _=a[l],m=o?o(_):_;if(_=h||0!==_?_:0,d&&m==m){for(var y=p.length;y--;)if(p[y]===m)continue t;o&&p.push(m),f.push(_)}else c(p,m,h)||(p!==f&&p.push(m),f.push(_))}return f}}function oc(){if(Ho)return Jo;Ho=1;var t=Es(),e=Ai();return Jo=function(i){return e(i)&&t(i)}}function hc(){if($o)return Xo;$o=1;var t=Ql(),e=ic(),i=ac(),s=oc(),n=e((function(e){return i(t(e,1,s,!0))}));return Xo=n}function lc(){if(th)return Qo;th=1;var t=function(){if(Ko)return Zo;Ko=1;var t=Ml();return Zo=function(e,i){return t(i,(function(t){return e[t]}))}}(),e=As();return Qo=function(i){return null==i?[]:t(i,e(i))}}function cc(){if(ih)return eh;var t;ih=1;try{t={clone:cl(),constant:ul(),each:yl(),filter:Wl(),has:Yl(),isArray:Ii(),isEmpty:Ul(),isFunction:di(),isUndefined:ql(),keys:As(),map:Hl(),reduce:Xl(),size:Zl(),transform:Kl(),union:hc(),values:lc()}}catch(t){}return t||(t=window._),eh=t}function uc(){if(nh)return sh;nh=1;var t=cc();sh=n;var e="\0",i="\0",s="";function n(e){this._isDirected=!t.has(e,"directed")||e.directed,this._isMultigraph=!!t.has(e,"multigraph")&&e.multigraph,this._isCompound=!!t.has(e,"compound")&&e.compound,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[i]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function r(t,e){t[e]?t[e]++:t[e]=1}function a(t,e){--t[e]||delete t[e]}function o(i,n,r,a){var o=""+n,h=""+r;if(!i&&o>h){var l=o;o=h,h=l}return o+s+h+s+(t.isUndefined(a)?e:a)}function h(t,e){return o(t,e.v,e.w,e.name)}return n.prototype._nodeCount=0,n.prototype._edgeCount=0,n.prototype.isDirected=function(){return this._isDirected},n.prototype.isMultigraph=function(){return this._isMultigraph},n.prototype.isCompound=function(){return this._isCompound},n.prototype.setGraph=function(t){return this._label=t,this},n.prototype.graph=function(){return this._label},n.prototype.setDefaultNodeLabel=function(e){return t.isFunction(e)||(e=t.constant(e)),this._defaultNodeLabelFn=e,this},n.prototype.nodeCount=function(){return this._nodeCount},n.prototype.nodes=function(){return t.keys(this._nodes)},n.prototype.sources=function(){var e=this;return t.filter(this.nodes(),(function(i){return t.isEmpty(e._in[i])}))},n.prototype.sinks=function(){var e=this;return t.filter(this.nodes(),(function(i){return t.isEmpty(e._out[i])}))},n.prototype.setNodes=function(e,i){var s=arguments,n=this;return t.each(e,(function(t){s.length>1?n.setNode(t,i):n.setNode(t)})),this},n.prototype.setNode=function(e,s){return t.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=s),this):(this._nodes[e]=arguments.length>1?s:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=i,this._children[e]={},this._children[i][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},n.prototype.node=function(t){return this._nodes[t]},n.prototype.hasNode=function(e){return t.has(this._nodes,e)},n.prototype.removeNode=function(e){var i=this;if(t.has(this._nodes,e)){var s=function(t){i.removeEdge(i._edgeObjs[t])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],t.each(this.children(e),(function(t){i.setParent(t)})),delete this._children[e]),t.each(t.keys(this._in[e]),s),delete this._in[e],delete this._preds[e],t.each(t.keys(this._out[e]),s),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},n.prototype.setParent=function(e,s){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(s))s=i;else{for(var n=s+="";!t.isUndefined(n);n=this.parent(n))if(n===e)throw new Error("Setting "+s+" as parent of "+e+" would create a cycle");this.setNode(s)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=s,this._children[s][e]=!0,this},n.prototype._removeFromParentsChildList=function(t){delete this._children[this._parent[t]][t]},n.prototype.parent=function(t){if(this._isCompound){var e=this._parent[t];if(e!==i)return e}},n.prototype.children=function(e){if(t.isUndefined(e)&&(e=i),this._isCompound){var s=this._children[e];if(s)return t.keys(s)}else{if(e===i)return this.nodes();if(this.hasNode(e))return[]}},n.prototype.predecessors=function(e){var i=this._preds[e];if(i)return t.keys(i)},n.prototype.successors=function(e){var i=this._sucs[e];if(i)return t.keys(i)},n.prototype.neighbors=function(e){var i=this.predecessors(e);if(i)return t.union(i,this.successors(e))},n.prototype.isLeaf=function(t){return 0===(this.isDirected()?this.successors(t):this.neighbors(t)).length},n.prototype.filterNodes=function(e){var i=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});i.setGraph(this.graph());var s=this;t.each(this._nodes,(function(t,s){e(s)&&i.setNode(s,t)})),t.each(this._edgeObjs,(function(t){i.hasNode(t.v)&&i.hasNode(t.w)&&i.setEdge(t,s.edge(t))}));var n={};function r(t){var e=s.parent(t);return void 0===e||i.hasNode(e)?(n[t]=e,e):e in n?n[e]:r(e)}return this._isCompound&&t.each(i.nodes(),(function(t){i.setParent(t,r(t))})),i},n.prototype.setDefaultEdgeLabel=function(e){return t.isFunction(e)||(e=t.constant(e)),this._defaultEdgeLabelFn=e,this},n.prototype.edgeCount=function(){return this._edgeCount},n.prototype.edges=function(){return t.values(this._edgeObjs)},n.prototype.setPath=function(e,i){var s=this,n=arguments;return t.reduce(e,(function(t,e){return n.length>1?s.setEdge(t,e,i):s.setEdge(t,e),e})),this},n.prototype.setEdge=function(){var e,i,s,n,a=!1,h=arguments[0];"object"==typeof h&&null!==h&&"v"in h?(e=h.v,i=h.w,s=h.name,2===arguments.length&&(n=arguments[1],a=!0)):(e=h,i=arguments[1],s=arguments[3],arguments.length>2&&(n=arguments[2],a=!0)),e=""+e,i=""+i,t.isUndefined(s)||(s=""+s);var l=o(this._isDirected,e,i,s);if(t.has(this._edgeLabels,l))return a&&(this._edgeLabels[l]=n),this;if(!t.isUndefined(s)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(i),this._edgeLabels[l]=a?n:this._defaultEdgeLabelFn(e,i,s);var c=function(t,e,i,s){var n=""+e,r=""+i;if(!t&&n>r){var a=n;n=r,r=a}var o={v:n,w:r};s&&(o.name=s);return o}(this._isDirected,e,i,s);return e=c.v,i=c.w,Object.freeze(c),this._edgeObjs[l]=c,r(this._preds[i],e),r(this._sucs[e],i),this._in[i][l]=c,this._out[e][l]=c,this._edgeCount++,this},n.prototype.edge=function(t,e,i){var s=1===arguments.length?h(this._isDirected,arguments[0]):o(this._isDirected,t,e,i);return this._edgeLabels[s]},n.prototype.hasEdge=function(e,i,s){var n=1===arguments.length?h(this._isDirected,arguments[0]):o(this._isDirected,e,i,s);return t.has(this._edgeLabels,n)},n.prototype.removeEdge=function(t,e,i){var s=1===arguments.length?h(this._isDirected,arguments[0]):o(this._isDirected,t,e,i),n=this._edgeObjs[s];return n&&(t=n.v,e=n.w,delete this._edgeLabels[s],delete this._edgeObjs[s],a(this._preds[e],t),a(this._sucs[t],e),delete this._in[e][s],delete this._out[t][s],this._edgeCount--),this},n.prototype.inEdges=function(e,i){var s=this._in[e];if(s){var n=t.values(s);return i?t.filter(n,(function(t){return t.v===i})):n}},n.prototype.outEdges=function(e,i){var s=this._out[e];if(s){var n=t.values(s);return i?t.filter(n,(function(t){return t.w===i})):n}},n.prototype.nodeEdges=function(t,e){var i=this.inEdges(t,e);if(i)return i.concat(this.outEdges(t,e))},sh}function dc(){return hh?oh:(hh=1,oh={Graph:uc(),version:ah?rh:(ah=1,rh="2.1.8")})}function fc(){if(ch)return lh;ch=1;var t=cc(),e=uc();function i(e){return t.map(e.nodes(),(function(i){var s=e.node(i),n=e.parent(i),r={v:i};return t.isUndefined(s)||(r.value=s),t.isUndefined(n)||(r.parent=n),r}))}function s(e){return t.map(e.edges(),(function(i){var s=e.edge(i),n={v:i.v,w:i.w};return t.isUndefined(i.name)||(n.name=i.name),t.isUndefined(s)||(n.value=s),n}))}return lh={write:function(e){var n={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:i(e),edges:s(e)};t.isUndefined(e.graph())||(n.value=t.clone(e.graph()));return n},read:function(i){var s=new e(i.options).setGraph(i.value);return t.each(i.nodes,(function(t){s.setNode(t.v,t.value),t.parent&&s.setParent(t.v,t.parent)})),t.each(i.edges,(function(t){s.setEdge({v:t.v,w:t.w,name:t.name},t.value)})),s}}}function pc(){if(dh)return uh;dh=1;var t=cc();return uh=function(e){var i,s={},n=[];function r(n){t.has(s,n)||(s[n]=!0,i.push(n),t.each(e.successors(n),r),t.each(e.predecessors(n),r))}return t.each(e.nodes(),(function(t){i=[],r(t),i.length&&n.push(i)})),n},uh}function gc(){if(ph)return fh;ph=1;var t=cc();function e(){this._arr=[],this._keyIndices={}}return fh=e,e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map((function(t){return t.key}))},e.prototype.has=function(e){return t.has(this._keyIndices,e)},e.prototype.priority=function(t){var e=this._keyIndices[t];if(void 0!==e)return this._arr[e].priority},e.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(e,i){var s=this._keyIndices;if(e=String(e),!t.has(s,e)){var n=this._arr,r=n.length;return s[e]=r,n.push({key:e,priority:i}),this._decrease(r),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key},e.prototype.decrease=function(t,e){var i=this._keyIndices[t];if(e>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[i].priority+" New: "+e);this._arr[i].priority=e,this._decrease(i)},e.prototype._heapify=function(t){var e=this._arr,i=2*t,s=i+1,n=t;i<e.length&&(n=e[i].priority<e[n].priority?i:n,s<e.length&&(n=e[s].priority<e[n].priority?s:n),n!==t&&(this._swap(t,n),this._heapify(n)))},e.prototype._decrease=function(t){for(var e,i=this._arr,s=i[t].priority;0!==t&&!(i[e=t>>1].priority<s);)this._swap(t,e),t=e},e.prototype._swap=function(t,e){var i=this._arr,s=this._keyIndices,n=i[t],r=i[e];i[t]=r,i[e]=n,s[r.key]=t,s[n.key]=e},fh}function _c(){if(_h)return gh;_h=1;var t=cc(),e=gc();gh=function(t,s,n,r){return function(t,i,s,n){var r,a,o={},h=new e,l=function(t){var e=t.v!==r?t.v:t.w,i=o[e],n=s(t),l=a.distance+n;if(n<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+t+" Weight: "+n);l<i.distance&&(i.distance=l,i.predecessor=r,h.decrease(e,l))};t.nodes().forEach((function(t){var e=t===i?0:Number.POSITIVE_INFINITY;o[t]={distance:e},h.add(t,e)}));for(;h.size()>0&&(r=h.removeMin(),(a=o[r]).distance!==Number.POSITIVE_INFINITY);)n(r).forEach(l);return o}(t,String(s),n||i,r||function(e){return t.outEdges(e)})};var i=t.constant(1);return gh}function mc(){if(yh)return mh;yh=1;var t=_c(),e=cc();return mh=function(i,s,n){return e.transform(i.nodes(),(function(e,r){e[r]=t(i,r,s,n)}),{})}}function yc(){if(bh)return vh;bh=1;var t=cc();return vh=function(e){var i=0,s=[],n={},r=[];function a(o){var h=n[o]={onStack:!0,lowlink:i,index:i++};if(s.push(o),e.successors(o).forEach((function(e){t.has(n,e)?n[e].onStack&&(h.lowlink=Math.min(h.lowlink,n[e].index)):(a(e),h.lowlink=Math.min(h.lowlink,n[e].lowlink))})),h.lowlink===h.index){var l,c=[];do{l=s.pop(),n[l].onStack=!1,c.push(l)}while(o!==l);r.push(c)}}return e.nodes().forEach((function(e){t.has(n,e)||a(e)})),r},vh}function vc(){if(wh)return xh;wh=1;var t=cc(),e=yc();return xh=function(i){return t.filter(e(i),(function(t){return t.length>1||1===t.length&&i.hasEdge(t[0],t[0])}))}}function bc(){if(Sh)return kh;Sh=1;var t=cc();kh=function(t,i,s){return function(t,e,i){var s={},n=t.nodes();return n.forEach((function(t){s[t]={},s[t][t]={distance:0},n.forEach((function(e){t!==e&&(s[t][e]={distance:Number.POSITIVE_INFINITY})})),i(t).forEach((function(i){var n=i.v===t?i.w:i.v,r=e(i);s[t][n]={distance:r,predecessor:t}}))})),n.forEach((function(t){var e=s[t];n.forEach((function(i){var r=s[i];n.forEach((function(i){var s=r[t],n=e[i],a=r[i],o=s.distance+n.distance;o<a.distance&&(a.distance=o,a.predecessor=n.predecessor)}))}))})),s}(t,i||e,s||function(e){return t.outEdges(e)})};var e=t.constant(1);return kh}function xc(){if(Eh)return Ch;Eh=1;var t=cc();function e(e){var s={},n={},r=[];if(t.each(e.sinks(),(function a(o){if(t.has(n,o))throw new i;t.has(s,o)||(n[o]=!0,s[o]=!0,t.each(e.predecessors(o),a),delete n[o],r.push(o))})),t.size(s)!==e.nodeCount())throw new i;return r}function i(){}return Ch=e,e.CycleException=i,i.prototype=new Error,Ch}function wc(){if(Th)return Ah;Th=1;var t=xc();return Ah=function(e){try{t(e)}catch(e){if(e instanceof t.CycleException)return!1;throw e}return!0}}function kc(){if(Oh)return Ih;Oh=1;var t=cc();function e(i,s,n,r,a,o){t.has(r,s)||(r[s]=!0,n||o.push(s),t.each(a(s),(function(t){e(i,t,n,r,a,o)})),n&&o.push(s))}return Ih=function(i,s,n){t.isArray(s)||(s=[s]);var r=(i.isDirected()?i.successors:i.neighbors).bind(i),a=[],o={};return t.each(s,(function(t){if(!i.hasNode(t))throw new Error("Graph does not have node: "+t);e(i,t,"post"===n,o,r,a)})),a},Ih}function Sc(){if(Mh)return Rh;Mh=1;var t=kc();return Rh=function(e,i){return t(e,i,"post")}}function Cc(){if(Bh)return Nh;Bh=1;var t=kc();return Nh=function(e,i){return t(e,i,"pre")}}function Ec(){if(Ph)return Fh;Ph=1;var t=cc(),e=uc(),i=gc();return Fh=function(s,n){var r,a=new e,o={},h=new i;function l(t){var e=t.v===r?t.w:t.v,i=h.priority(e);if(void 0!==i){var s=n(t);s<i&&(o[e]=r,h.decrease(e,s))}}if(0===s.nodeCount())return a;t.each(s.nodes(),(function(t){h.add(t,Number.POSITIVE_INFINITY),a.setNode(t)})),h.decrease(s.nodes()[0],0);var c=!1;for(;h.size()>0;){if(r=h.removeMin(),t.has(o,r))a.setEdge(r,o[r]);else{if(c)throw new Error("Input graph is not connected: "+s);c=!0}s.nodeEdges(r).forEach(l)}return a}}Gh.exports;try{zh=function(){if(Dh)return Lh;Dh=1;var t=dc();return Lh={Graph:t.Graph,json:fc(),alg:jh?Vh:(jh=1,Vh={components:pc(),dijkstra:_c(),dijkstraAll:mc(),findCycles:vc(),floydWarshall:bc(),isAcyclic:wc(),postorder:Sc(),preorder:Cc(),prim:Ec(),tarjan:yc(),topsort:xc()}),version:t.version}}()}catch(t){}zh||(zh=window.graphlib);var Ac,Tc,Ic,Oc,Rc,Mc,Nc,Bc,Fc,Pc,Vc,jc,Lc,Dc,zc,Gc,Wc,Yc,Uc,qc,Jc,Hc,Xc,$c,Zc,Kc,Qc,tu,eu,iu,su,nu,ru,au,ou,hu,lu,cu,uu,du,fu,pu,gu,_u,mu,yu,vu,bu,xu,wu,ku,Su,Cu,Eu,Au,Tu,Iu,Ou,Ru,Mu,Nu,Bu,Fu,Pu,Vu,ju,Lu,Du,zu,Gu,Wu,Yu,Uu,qu,Ju,Hu,Xu,$u,Zu,Ku,Qu,td,ed,id,sd,nd,rd,ad,od,hd,ld,cd,ud,dd=zh;function fd(){if(Oc)return Ic;Oc=1;var t=ni(),e=Es(),i=Wi(),s=ui();return Ic=function(n,r,a){if(!s(a))return!1;var o=typeof r;return!!("number"==o?e(a)&&i(r,a.length):"string"==o&&r in a)&&t(a[r],n)}}function pd(){if(jc)return Vc;jc=1;var t=function(){if(Pc)return Fc;Pc=1;var t=/\s/;return Fc=function(e){for(var i=e.length;i--&&t.test(e.charAt(i)););return i}}(),e=/^\s+/;return Vc=function(i){return i?i.slice(0,t(i)+1).replace(e,""):i}}function gd(){if(Gc)return zc;Gc=1;var t=function(){if(Dc)return Lc;Dc=1;var t=pd(),e=ui(),i=Il(),s=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,r=/^0o[0-7]+$/i,a=parseInt;return Lc=function(o){if("number"==typeof o)return o;if(i(o))return NaN;if(e(o)){var h="function"==typeof o.valueOf?o.valueOf():o;o=e(h)?h+"":h}if("string"!=typeof o)return 0===o?o:+o;o=t(o);var l=n.test(o);return l||r.test(o)?a(o.slice(2),l?2:8):s.test(o)?NaN:+o}}(),e=1/0;return zc=function(i){return i?(i=t(i))===e||i===-1/0?17976931348623157e292*(i<0?-1:1):i==i?i:0:0===i?i:0}}function _d(){if(qc)return Uc;qc=1;var t=sc(),e=Gl(),i=function(){if(Yc)return Wc;Yc=1;var t=gd();return Wc=function(e){var i=t(e),s=i%1;return i==i?s?i-s:i:0}}(),s=Math.max;return Uc=function(n,r,a){var o=null==n?0:n.length;if(!o)return-1;var h=null==a?0:i(a);return h<0&&(h=s(o+h,0)),t(n,e(r,3),h)}}function md(){if($c)return Xc;$c=1;var t=Ql();return Xc=function(e){return(null==e?0:e.length)?t(e,1):[]}}function yd(){if(nu)return su;nu=1;var t=Il();return su=function(e,i,s){for(var n=-1,r=e.length;++n<r;){var a=e[n],o=i(a);if(null!=o&&(void 0===h?o==o&&!t(o):s(o,h)))var h=o,l=a}return l}}function vd(){if(cu)return lu;cu=1;var t=Si(),e=ni();return lu=function(i,s,n){(void 0!==n&&!e(i[s],n)||void 0===n&&!(s in i))&&t(i,s,n)}}function bd(){if(pu)return fu;return pu=1,fu=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}}function xd(){if(yu)return mu;yu=1;var t=vd(),e=Wh(),i=sl(),s=Yh(),n=al(),r=Ti(),a=Ii(),o=oc(),h=Gi(),l=di(),c=ui(),u=function(){if(du)return uu;du=1;var t=ci(),e=Xh(),i=Ai(),s=Function.prototype,n=Object.prototype,r=s.toString,a=n.hasOwnProperty,o=r.call(Object);return uu=function(s){if(!i(s)||"[object Object]"!=t(s))return!1;var n=e(s);if(null===n)return!0;var h=a.call(n,"constructor")&&n.constructor;return"function"==typeof h&&h instanceof h&&r.call(h)==o}}(),d=xs(),f=bd(),p=function(){if(_u)return gu;_u=1;var t=Ei(),e=Is();return gu=function(i){return t(i,e(i))}}();
/**
		 * A specialized version of `baseMerge` for arrays and objects which performs
		 * deep merges and tracks traversed objects enabling objects with circular
		 * references to be merged.
		 *
		 * @private
		 * @param {Object} object The destination object.
		 * @param {Object} source The source object.
		 * @param {string} key The key of the value to merge.
		 * @param {number} srcIndex The index of `source`.
		 * @param {Function} mergeFunc The function to merge values.
		 * @param {Function} [customizer] The function to customize assigned values.
		 * @param {Object} [stack] Tracks traversed source values and their merged
		 *  counterparts.
		 */return mu=function(g,_,m,y,v,b,x){var w=f(g,m),k=f(_,m),S=x.get(k);if(S)t(g,m,S);else{var C=b?b(w,k,m+"",g,_,x):void 0,E=void 0===C;if(E){var A=a(k),T=!A&&h(k),I=!A&&!T&&d(k);C=k,A||T||I?a(w)?C=w:o(w)?C=s(w):T?(E=!1,C=e(k,!0)):I?(E=!1,C=i(k,!0)):C=[]:u(k)||r(k)?(C=w,r(w)?C=p(w):c(w)&&!l(w)||(C=n(k))):E=!1}E&&(x.set(k,C),v(C,k,y,b,x),x.delete(k)),t(g,m,C)}}}function wd(){if(Eu)return Cu;return Eu=1,Cu=function(t,e){return t<e}}function kd(){if(Pu)return Fu;Pu=1;var t=Pl(),e=function(){if(Bu)return Nu;Bu=1;var t=Ci(),e=Bl(),i=Wi(),s=ui(),n=Fl();return Nu=function(r,a,o,h){if(!s(r))return r;for(var l=-1,c=(a=e(a,r)).length,u=c-1,d=r;null!=d&&++l<c;){var f=n(a[l]),p=o;if("__proto__"===f||"constructor"===f||"prototype"===f)return r;if(l!=u){var g=d[f];void 0===(p=h?h(g,f,d):void 0)&&(p=s(g)?g:i(a[l+1])?[]:{})}t(d,f,p),d=d[f]}return r}}(),i=Bl();return Fu=function(s,n,r){for(var a=-1,o=n.length,h={};++a<o;){var l=n[a],c=t(s,l);r(c,l)&&e(h,i(l,s),c)}return h}}function Sd(){if(qu)return Uu;qu=1;var t=function(){if(Yu)return Wu;Yu=1;var t=Math.ceil,e=Math.max;return Wu=function(i,s,n,r){for(var a=-1,o=e(t((s-i)/(n||1)),0),h=Array(o);o--;)h[r?o:++a]=i,i+=n;return h}}(),e=fd(),i=gd();return Uu=function(s){return function(n,r,a){return a&&"number"!=typeof a&&e(n,r,a)&&(r=a=void 0),n=i(n),void 0===r?(r=n,n=0):r=i(r),a=void 0===a?n<r?1:-1:i(a),t(n,r,a,s)}}}function Cd(){if(td)return Qu;td=1;var t=function(){if(Ku)return Zu;Ku=1;var t=Il();return Zu=function(e,i){if(e!==i){var s=void 0!==e,n=null===e,r=e==e,a=t(e),o=void 0!==i,h=null===i,l=i==i,c=t(i);if(!h&&!c&&!a&&e>i||a&&o&&l&&!h&&!c||n&&o&&l||!s&&l||!r)return 1;if(!n&&!a&&!c&&e<i||c&&s&&r&&!n&&!a||h&&s&&r||!o&&r||!l)return-1}return 0}}();return Qu=function(e,i,s){for(var n=-1,r=e.criteria,a=i.criteria,o=r.length,h=s.length;++n<o;){var l=t(r[n],a[n]);if(l)return n>=h?l:l*("desc"==s[n]?-1:1)}return e.index-i.index}}function Ed(){if(id)return ed;id=1;var t=Ml(),e=Pl(),i=Gl(),s=Jl(),n=$u?Xu:($u=1,Xu=function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}),r=Ui(),a=Cd(),o=gl(),h=Ii();return ed=function(l,c,u){c=c.length?t(c,(function(t){return h(t)?function(i){return e(i,1===t.length?t[0]:t)}:t})):[o];var d=-1;c=t(c,r(i));var f=s(l,(function(e,i,s){return{criteria:t(c,(function(t){return t(e)})),index:++d,value:e}}));return n(f,(function(t,e){return a(t,e,u)}))}}try{ud={cloneDeep:function(){if(Tc)return Ac;Tc=1;var t=ll();return Ac=function(e){return t(e,5)}}(),constant:ul(),defaults:function(){if(Mc)return Rc;Mc=1;var t=ic(),e=ni(),i=fd(),s=Is(),n=Object.prototype,r=n.hasOwnProperty,a=t((function(t,a){t=Object(t);var o=-1,h=a.length,l=h>2?a[2]:void 0;for(l&&i(a[0],a[1],l)&&(h=1);++o<h;)for(var c=a[o],u=s(c),d=-1,f=u.length;++d<f;){var p=u[d],g=t[p];(void 0===g||e(g,n[p])&&!r.call(t,p))&&(t[p]=c[p])}return t}));return Rc=a}(),each:yl(),filter:Wl(),find:function(){if(Hc)return Jc;Hc=1;var t=function(){if(Bc)return Nc;Bc=1;var t=Gl(),e=Es(),i=As();return Nc=function(s){return function(n,r,a){var o=Object(n);if(!e(n)){var h=t(r,3);n=i(n),r=function(t){return h(o[t],t,o)}}var l=s(n,r,a);return l>-1?o[h?n[l]:l]:void 0}}}()(_d());return Jc=t}(),flatten:md(),forEach:ml(),forIn:function(){if(Kc)return Zc;Kc=1;var t=dl(),e=_l(),i=Is();return Zc=function(s,n){return null==s?s:t(s,e(n),i)}}(),has:Yl(),isUndefined:ql(),last:tu?Qc:(tu=1,Qc=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}),map:Hl(),mapValues:function(){if(iu)return eu;iu=1;var t=Si(),e=fl(),i=Gl();return eu=function(s,n){var r={};return n=i(n,3),e(s,(function(e,i,s){t(r,i,n(e,i,s))})),r}}(),max:function(){if(hu)return ou;hu=1;var t=yd(),e=au?ru:(au=1,ru=function(t,e){return t>e}),i=gl();return ou=function(s){return s&&s.length?t(s,i,e):void 0}}(),merge:function(){if(Su)return ku;Su=1;var t=function(){if(bu)return vu;bu=1;var t=xi(),e=vd(),i=dl(),s=xd(),n=ui(),r=Is(),a=bd();return vu=function o(h,l,c,u,d){h!==l&&i(l,(function(i,r){if(d||(d=new t),n(i))s(h,l,r,c,o,u,d);else{var f=u?u(a(h,r),i,r+"",h,l,d):void 0;void 0===f&&(f=i),e(h,r,f)}}),r)},vu}(),e=function(){if(wu)return xu;wu=1;var t=ic(),e=fd();return xu=function(i){return t((function(t,s){var n=-1,r=s.length,a=r>1?s[r-1]:void 0,o=r>2?s[2]:void 0;for(a=i.length>3&&"function"==typeof a?(r--,a):void 0,o&&e(s[0],s[1],o)&&(a=r<3?void 0:a,r=1),t=Object(t);++n<r;){var h=s[n];h&&i(t,h,n,a)}return t}))}}()((function(e,i,s){t(e,i,s)}));return ku=e}(),min:function(){if(Tu)return Au;Tu=1;var t=yd(),e=wd(),i=gl();return Au=function(s){return s&&s.length?t(s,i,e):void 0}}(),minBy:function(){if(Ou)return Iu;Ou=1;var t=yd(),e=Gl(),i=wd();return Iu=function(s,n){return s&&s.length?t(s,e(n,2),i):void 0}}(),now:function(){if(Mu)return Ru;Mu=1;var t=hi();return Ru=function(){return t.Date.now()}}(),pick:function(){if(Gu)return zu;Gu=1;var t=function(){if(ju)return Vu;ju=1;var t=kd(),e=jl();return Vu=function(i,s){return t(i,s,(function(t,s){return e(i,s)}))}}(),e=function(){if(Du)return Lu;Du=1;var t=md(),e=tc(),i=ec();
/**
		 * A specialized version of `baseRest` which flattens the rest array.
		 *
		 * @private
		 * @param {Function} func The function to apply a rest parameter to.
		 * @returns {Function} Returns the new function.
		 */return Lu=function(s){return i(e(s,void 0,t),s+"")}}()((function(e,i){return null==e?{}:t(e,i)}));return zu=e}(),range:function(){if(Hu)return Ju;Hu=1;var t=Sd()();return Ju=t}(),reduce:Xl(),sortBy:function(){if(nd)return sd;nd=1;var t=Ql(),e=Ed(),i=ic(),s=fd(),n=i((function(i,n){if(null==i)return[];var r=n.length;return r>1&&s(i,n[0],n[1])?n=[]:r>2&&s(n[0],n[1],n[2])&&(n=[n[0]]),e(i,t(n,1),[])}));return sd=n}(),uniqueId:function(){if(ad)return rd;ad=1;var t=Nl(),e=0;return rd=function(i){var s=++e;return t(i)+s}}(),values:lc(),zipObject:function(){if(cd)return ld;cd=1;var t=Ci(),e=hd?od:(hd=1,od=function(t,e,i){for(var s=-1,n=t.length,r=e.length,a={};++s<n;){var o=s<r?e[s]:void 0;i(a,t[s],o)}return a});return ld=function(i,s){return e(i||[],s||[],t)}}()}}catch(t){}ud||(ud=window._);var Ad=ud,Td=Id;function Id(){var t={};t._next=t._prev=t,this._sentinel=t}function Od(t){t._prev._next=t._next,t._next._prev=t._prev,delete t._next,delete t._prev}function Rd(t,e){if("_next"!==t&&"_prev"!==t)return e}Id.prototype.dequeue=function(){var t=this._sentinel,e=t._prev;if(e!==t)return Od(e),e},Id.prototype.enqueue=function(t){var e=this._sentinel;t._prev&&t._next&&Od(t),t._next=e._next,e._next._prev=t,e._next=t,t._prev=e},Id.prototype.toString=function(){for(var t=[],e=this._sentinel,i=e._prev;i!==e;)t.push(JSON.stringify(i,Rd)),i=i._prev;return"["+t.join(", ")+"]"};var Md=Ad,Nd=dd.Graph,Bd=Td,Fd=function(t,e){if(t.nodeCount()<=1)return[];var i=function(t,e){var i=new Nd,s=0,n=0;Md.forEach(t.nodes(),(function(t){i.setNode(t,{v:t,in:0,out:0})})),Md.forEach(t.edges(),(function(t){var r=i.edge(t.v,t.w)||0,a=e(t),o=r+a;i.setEdge(t.v,t.w,o),n=Math.max(n,i.node(t.v).out+=a),s=Math.max(s,i.node(t.w).in+=a)}));var r=Md.range(n+s+3).map((function(){return new Bd})),a=s+1;return Md.forEach(i.nodes(),(function(t){jd(r,a,i.node(t))})),{graph:i,buckets:r,zeroIdx:a}}(t,e||Pd),s=function(t,e,i){var s,n=[],r=e[e.length-1],a=e[0];for(;t.nodeCount();){for(;s=a.dequeue();)Vd(t,e,i,s);for(;s=r.dequeue();)Vd(t,e,i,s);if(t.nodeCount())for(var o=e.length-2;o>0;--o)if(s=e[o].dequeue()){n=n.concat(Vd(t,e,i,s,!0));break}}return n}(i.graph,i.buckets,i.zeroIdx);return Md.flatten(Md.map(s,(function(e){return t.outEdges(e.v,e.w)})),!0)},Pd=Md.constant(1);function Vd(t,e,i,s,n){var r=n?[]:void 0;return Md.forEach(t.inEdges(s.v),(function(s){var a=t.edge(s),o=t.node(s.v);n&&r.push({v:s.v,w:s.w}),o.out-=a,jd(e,i,o)})),Md.forEach(t.outEdges(s.v),(function(s){var n=t.edge(s),r=s.w,a=t.node(r);a.in-=n,jd(e,i,a)})),t.removeNode(s.v),r}function jd(t,e,i){i.out?i.in?t[i.out-i.in+e].enqueue(i):t[t.length-1].enqueue(i):t[0].enqueue(i)}var Ld=Ad,Dd=Fd,zd={run:function(t){var e="greedy"===t.graph().acyclicer?Dd(t,function(t){return function(e){return t.edge(e).weight}}(t)):function(t){var e=[],i={},s={};function n(r){Ld.has(s,r)||(s[r]=!0,i[r]=!0,Ld.forEach(t.outEdges(r),(function(t){Ld.has(i,t.w)?e.push(t):n(t.w)})),delete i[r])}return Ld.forEach(t.nodes(),n),e}(t);Ld.forEach(e,(function(e){var i=t.edge(e);t.removeEdge(e),i.forwardName=e.name,i.reversed=!0,t.setEdge(e.w,e.v,i,Ld.uniqueId("rev"))}))},undo:function(t){Ld.forEach(t.edges(),(function(e){var i=t.edge(e);if(i.reversed){t.removeEdge(e);var s=i.forwardName;delete i.reversed,delete i.forwardName,t.setEdge(e.w,e.v,i,s)}}))}};var Gd=Ad,Wd=dd.Graph,Yd={addDummyNode:Ud,simplify:function(t){var e=(new Wd).setGraph(t.graph());return Gd.forEach(t.nodes(),(function(i){e.setNode(i,t.node(i))})),Gd.forEach(t.edges(),(function(i){var s=e.edge(i.v,i.w)||{weight:0,minlen:1},n=t.edge(i);e.setEdge(i.v,i.w,{weight:s.weight+n.weight,minlen:Math.max(s.minlen,n.minlen)})})),e},asNonCompoundGraph:function(t){var e=new Wd({multigraph:t.isMultigraph()}).setGraph(t.graph());return Gd.forEach(t.nodes(),(function(i){t.children(i).length||e.setNode(i,t.node(i))})),Gd.forEach(t.edges(),(function(i){e.setEdge(i,t.edge(i))})),e},successorWeights:function(t){var e=Gd.map(t.nodes(),(function(e){var i={};return Gd.forEach(t.outEdges(e),(function(e){i[e.w]=(i[e.w]||0)+t.edge(e).weight})),i}));return Gd.zipObject(t.nodes(),e)},predecessorWeights:function(t){var e=Gd.map(t.nodes(),(function(e){var i={};return Gd.forEach(t.inEdges(e),(function(e){i[e.v]=(i[e.v]||0)+t.edge(e).weight})),i}));return Gd.zipObject(t.nodes(),e)},intersectRect:function(t,e){var i,s,n=t.x,r=t.y,a=e.x-n,o=e.y-r,h=t.width/2,l=t.height/2;if(!a&&!o)throw new Error("Not possible to find intersection inside of the rectangle");Math.abs(o)*h>Math.abs(a)*l?(o<0&&(l=-l),i=l*a/o,s=l):(a<0&&(h=-h),i=h,s=h*o/a);return{x:n+i,y:r+s}},buildLayerMatrix:function(t){var e=Gd.map(Gd.range(qd(t)+1),(function(){return[]}));return Gd.forEach(t.nodes(),(function(i){var s=t.node(i),n=s.rank;Gd.isUndefined(n)||(e[n][s.order]=i)})),e},normalizeRanks:function(t){var e=Gd.min(Gd.map(t.nodes(),(function(e){return t.node(e).rank})));Gd.forEach(t.nodes(),(function(i){var s=t.node(i);Gd.has(s,"rank")&&(s.rank-=e)}))},removeEmptyRanks:function(t){var e=Gd.min(Gd.map(t.nodes(),(function(e){return t.node(e).rank}))),i=[];Gd.forEach(t.nodes(),(function(s){var n=t.node(s).rank-e;i[n]||(i[n]=[]),i[n].push(s)}));var s=0,n=t.graph().nodeRankFactor;Gd.forEach(i,(function(e,i){Gd.isUndefined(e)&&i%n!=0?--s:s&&Gd.forEach(e,(function(e){t.node(e).rank+=s}))}))},addBorderNode:function(t,e,i,s){var n={width:0,height:0};arguments.length>=4&&(n.rank=i,n.order=s);return Ud(t,"border",n,e)},maxRank:qd,partition:function(t,e){var i={lhs:[],rhs:[]};return Gd.forEach(t,(function(t){e(t)?i.lhs.push(t):i.rhs.push(t)})),i},time:function(t,e){var i=Gd.now();try{return e()}finally{console.log(t+" time: "+(Gd.now()-i)+"ms")}},notime:function(t,e){return e()}};function Ud(t,e,i,s){var n;do{n=Gd.uniqueId(s)}while(t.hasNode(n));return i.dummy=e,t.setNode(n,i),n}function qd(t){return Gd.max(Gd.map(t.nodes(),(function(e){var i=t.node(e).rank;if(!Gd.isUndefined(i))return i})))}var Jd=Ad,Hd=Yd,Xd={run:function(t){t.graph().dummyChains=[],Jd.forEach(t.edges(),(function(e){!function(t,e){var i,s,n,r=e.v,a=t.node(r).rank,o=e.w,h=t.node(o).rank,l=e.name,c=t.edge(e),u=c.labelRank;if(h===a+1)return;for(t.removeEdge(e),n=0,++a;a<h;++n,++a)c.points=[],s={width:0,height:0,edgeLabel:c,edgeObj:e,rank:a},i=Hd.addDummyNode(t,"edge",s,"_d"),a===u&&(s.width=c.width,s.height=c.height,s.dummy="edge-label",s.labelpos=c.labelpos),t.setEdge(r,i,{weight:c.weight},l),0===n&&t.graph().dummyChains.push(i),r=i;t.setEdge(r,o,{weight:c.weight},l)}(t,e)}))},undo:function(t){Jd.forEach(t.graph().dummyChains,(function(e){var i,s=t.node(e),n=s.edgeLabel;for(t.setEdge(s.edgeObj,n);s.dummy;)i=t.successors(e)[0],t.removeNode(e),n.points.push({x:s.x,y:s.y}),"edge-label"===s.dummy&&(n.x=s.x,n.y=s.y,n.width=s.width,n.height=s.height),e=i,s=t.node(e)}))}};var $d=Ad,Zd={longestPath:function(t){var e={};$d.forEach(t.sources(),(function i(s){var n=t.node(s);if($d.has(e,s))return n.rank;e[s]=!0;var r=$d.min($d.map(t.outEdges(s),(function(e){return i(e.w)-t.edge(e).minlen})));return r!==Number.POSITIVE_INFINITY&&null!=r||(r=0),n.rank=r}))},slack:function(t,e){return t.node(e.w).rank-t.node(e.v).rank-t.edge(e).minlen}};var Kd=Ad,Qd=dd.Graph,tf=Zd.slack,ef=function(t){var e,i,s=new Qd({directed:!1}),n=t.nodes()[0],r=t.nodeCount();s.setNode(n,{});for(;sf(s,t)<r;)e=nf(s,t),i=s.hasNode(e.v)?tf(t,e):-tf(t,e),rf(s,t,i);return s};function sf(t,e){return Kd.forEach(t.nodes(),(function i(s){Kd.forEach(e.nodeEdges(s),(function(n){var r=n.v,a=s===r?n.w:r;t.hasNode(a)||tf(e,n)||(t.setNode(a,{}),t.setEdge(s,a,{}),i(a))}))})),t.nodeCount()}function nf(t,e){return Kd.minBy(e.edges(),(function(i){if(t.hasNode(i.v)!==t.hasNode(i.w))return tf(e,i)}))}function rf(t,e,i){Kd.forEach(t.nodes(),(function(t){e.node(t).rank+=i}))}var af=Ad,of=ef,hf=Zd.slack,lf=Zd.longestPath,cf=dd.alg.preorder,uf=dd.alg.postorder,df=Yd.simplify,ff=pf;function pf(t){t=df(t),lf(t);var e,i=of(t);for(mf(i),gf(i,t);e=vf(i);)xf(i,t,e,bf(i,t,e))}function gf(t,e){var i=uf(t,t.nodes());i=i.slice(0,i.length-1),af.forEach(i,(function(i){!function(t,e,i){var s=t.node(i),n=s.parent;t.edge(i,n).cutvalue=_f(t,e,i)}(t,e,i)}))}function _f(t,e,i){var s=t.node(i).parent,n=!0,r=e.edge(i,s),a=0;return r||(n=!1,r=e.edge(s,i)),a=r.weight,af.forEach(e.nodeEdges(i),(function(r){var o,h,l=r.v===i,c=l?r.w:r.v;if(c!==s){var u=l===n,d=e.edge(r).weight;if(a+=u?d:-d,o=i,h=c,t.hasEdge(o,h)){var f=t.edge(i,c).cutvalue;a+=u?-f:f}}})),a}function mf(t,e){arguments.length<2&&(e=t.nodes()[0]),yf(t,{},1,e)}function yf(t,e,i,s,n){var r=i,a=t.node(s);return e[s]=!0,af.forEach(t.neighbors(s),(function(n){af.has(e,n)||(i=yf(t,e,i,n,s))})),a.low=r,a.lim=i++,n?a.parent=n:delete a.parent,i}function vf(t){return af.find(t.edges(),(function(e){return t.edge(e).cutvalue<0}))}function bf(t,e,i){var s=i.v,n=i.w;e.hasEdge(s,n)||(s=i.w,n=i.v);var r=t.node(s),a=t.node(n),o=r,h=!1;r.lim>a.lim&&(o=a,h=!0);var l=af.filter(e.edges(),(function(e){return h===wf(t,t.node(e.v),o)&&h!==wf(t,t.node(e.w),o)}));return af.minBy(l,(function(t){return hf(e,t)}))}function xf(t,e,i,s){var n=i.v,r=i.w;t.removeEdge(n,r),t.setEdge(s.v,s.w,{}),mf(t),gf(t,e),function(t,e){var i=af.find(t.nodes(),(function(t){return!e.node(t).parent})),s=cf(t,i);s=s.slice(1),af.forEach(s,(function(i){var s=t.node(i).parent,n=e.edge(i,s),r=!1;n||(n=e.edge(s,i),r=!0),e.node(i).rank=e.node(s).rank+(r?n.minlen:-n.minlen)}))}(t,e)}function wf(t,e,i){return i.low<=e.lim&&e.lim<=i.lim}pf.initLowLimValues=mf,pf.initCutValues=gf,pf.calcCutValue=_f,pf.leaveEdge=vf,pf.enterEdge=bf,pf.exchangeEdges=xf;var kf=Zd.longestPath,Sf=ef,Cf=ff,Ef=function(t){switch(t.graph().ranker){case"network-simplex":default:Tf(t);break;case"tight-tree":!function(t){kf(t),Sf(t)}(t);break;case"longest-path":Af(t)}};var Af=kf;function Tf(t){Cf(t)}var If=Ad,Of=function(t){var e=function(t){var e={},i=0;function s(n){var r=i;If.forEach(t.children(n),s),e[n]={low:r,lim:i++}}return If.forEach(t.children(),s),e}(t);If.forEach(t.graph().dummyChains,(function(i){for(var s=t.node(i),n=s.edgeObj,r=function(t,e,i,s){var n,r,a=[],o=[],h=Math.min(e[i].low,e[s].low),l=Math.max(e[i].lim,e[s].lim);n=i;do{n=t.parent(n),a.push(n)}while(n&&(e[n].low>h||l>e[n].lim));r=n,n=s;for(;(n=t.parent(n))!==r;)o.push(n);return{path:a.concat(o.reverse()),lca:r}}(t,e,n.v,n.w),a=r.path,o=r.lca,h=0,l=a[h],c=!0;i!==n.w;){if(s=t.node(i),c){for(;(l=a[h])!==o&&t.node(l).maxRank<s.rank;)h++;l===o&&(c=!1)}if(!c){for(;h<a.length-1&&t.node(l=a[h+1]).minRank<=s.rank;)h++;l=a[h]}t.setParent(i,l),i=t.successors(i)[0]}}))};var Rf=Ad,Mf=Yd,Nf={run:function(t){var e=Mf.addDummyNode(t,"root",{},"_root"),i=function(t){var e={};function i(s,n){var r=t.children(s);r&&r.length&&Rf.forEach(r,(function(t){i(t,n+1)})),e[s]=n}return Rf.forEach(t.children(),(function(t){i(t,1)})),e}(t),s=Rf.max(Rf.values(i))-1,n=2*s+1;t.graph().nestingRoot=e,Rf.forEach(t.edges(),(function(e){t.edge(e).minlen*=n}));var r=function(t){return Rf.reduce(t.edges(),(function(e,i){return e+t.edge(i).weight}),0)}(t)+1;Rf.forEach(t.children(),(function(a){Bf(t,e,n,r,s,i,a)})),t.graph().nodeRankFactor=n},cleanup:function(t){var e=t.graph();t.removeNode(e.nestingRoot),delete e.nestingRoot,Rf.forEach(t.edges(),(function(e){t.edge(e).nestingEdge&&t.removeEdge(e)}))}};function Bf(t,e,i,s,n,r,a){var o=t.children(a);if(o.length){var h=Mf.addBorderNode(t,"_bt"),l=Mf.addBorderNode(t,"_bb"),c=t.node(a);t.setParent(h,a),c.borderTop=h,t.setParent(l,a),c.borderBottom=l,Rf.forEach(o,(function(o){Bf(t,e,i,s,n,r,o);var c=t.node(o),u=c.borderTop?c.borderTop:o,d=c.borderBottom?c.borderBottom:o,f=c.borderTop?s:2*s,p=u!==d?1:n-r[a]+1;t.setEdge(h,u,{weight:f,minlen:p,nestingEdge:!0}),t.setEdge(d,l,{weight:f,minlen:p,nestingEdge:!0})})),t.parent(a)||t.setEdge(e,h,{weight:0,minlen:n+r[a]})}else a!==e&&t.setEdge(e,a,{weight:0,minlen:i})}var Ff=Ad,Pf=Yd,Vf=function(t){Ff.forEach(t.children(),(function e(i){var s=t.children(i),n=t.node(i);if(s.length&&Ff.forEach(s,e),Ff.has(n,"minRank")){n.borderLeft=[],n.borderRight=[];for(var r=n.minRank,a=n.maxRank+1;r<a;++r)jf(t,"borderLeft","_bl",i,n,r),jf(t,"borderRight","_br",i,n,r)}}))};function jf(t,e,i,s,n,r){var a={width:0,height:0,rank:r,borderType:e},o=n[e][r-1],h=Pf.addDummyNode(t,"border",a,i);n[e][r]=h,t.setParent(h,s),o&&t.setEdge(o,h,{weight:1})}var Lf=Ad,Df={adjust:function(t){var e=t.graph().rankdir.toLowerCase();"lr"!==e&&"rl"!==e||zf(t)},undo:function(t){var e=t.graph().rankdir.toLowerCase();"bt"!==e&&"rl"!==e||function(t){Lf.forEach(t.nodes(),(function(e){Wf(t.node(e))})),Lf.forEach(t.edges(),(function(e){var i=t.edge(e);Lf.forEach(i.points,Wf),Lf.has(i,"y")&&Wf(i)}))}(t);"lr"!==e&&"rl"!==e||(!function(t){Lf.forEach(t.nodes(),(function(e){Yf(t.node(e))})),Lf.forEach(t.edges(),(function(e){var i=t.edge(e);Lf.forEach(i.points,Yf),Lf.has(i,"x")&&Yf(i)}))}(t),zf(t))}};function zf(t){Lf.forEach(t.nodes(),(function(e){Gf(t.node(e))})),Lf.forEach(t.edges(),(function(e){Gf(t.edge(e))}))}function Gf(t){var e=t.width;t.width=t.height,t.height=e}function Wf(t){t.y=-t.y}function Yf(t){var e=t.x;t.x=t.y,t.y=e}var Uf=Ad,qf=function(t){var e={},i=Uf.filter(t.nodes(),(function(e){return!t.children(e).length})),s=Uf.max(Uf.map(i,(function(e){return t.node(e).rank}))),n=Uf.map(Uf.range(s+1),(function(){return[]}));function r(i){if(!Uf.has(e,i)){e[i]=!0;var s=t.node(i);n[s.rank].push(i),Uf.forEach(t.successors(i),r)}}var a=Uf.sortBy(i,(function(e){return t.node(e).rank}));return Uf.forEach(a,r),n};var Jf=Ad,Hf=function(t,e){for(var i=0,s=1;s<e.length;++s)i+=Xf(t,e[s-1],e[s]);return i};function Xf(t,e,i){for(var s=Jf.zipObject(i,Jf.map(i,(function(t,e){return e}))),n=Jf.flatten(Jf.map(e,(function(e){return Jf.sortBy(Jf.map(t.outEdges(e),(function(e){return{pos:s[e.w],weight:t.edge(e).weight}})),"pos")})),!0),r=1;r<i.length;)r<<=1;var a=2*r-1;r-=1;var o=Jf.map(new Array(a),(function(){return 0})),h=0;return Jf.forEach(n.forEach((function(t){var e=t.pos+r;o[e]+=t.weight;for(var i=0;e>0;)e%2&&(i+=o[e+1]),o[e=e-1>>1]+=t.weight;h+=t.weight*i}))),h}var $f=Ad;var Zf=Ad;var Kf=Ad,Qf=Yd;function tp(t,e,i){for(var s;e.length&&(s=Kf.last(e)).i<=i;)e.pop(),t.push(s.vs),i++;return i}var ep=Ad,ip=function(t,e){return $f.map(e,(function(e){var i=t.inEdges(e);if(i.length){var s=$f.reduce(i,(function(e,i){var s=t.edge(i),n=t.node(i.v);return{sum:e.sum+s.weight*n.order,weight:e.weight+s.weight}}),{sum:0,weight:0});return{v:e,barycenter:s.sum/s.weight,weight:s.weight}}return{v:e}}))},sp=function(t,e){var i={};return Zf.forEach(t,(function(t,e){var s=i[t.v]={indegree:0,in:[],out:[],vs:[t.v],i:e};Zf.isUndefined(t.barycenter)||(s.barycenter=t.barycenter,s.weight=t.weight)})),Zf.forEach(e.edges(),(function(t){var e=i[t.v],s=i[t.w];Zf.isUndefined(e)||Zf.isUndefined(s)||(s.indegree++,e.out.push(i[t.w]))})),function(t){var e=[];function i(t){return function(e){e.merged||(Zf.isUndefined(e.barycenter)||Zf.isUndefined(t.barycenter)||e.barycenter>=t.barycenter)&&function(t,e){var i=0,s=0;t.weight&&(i+=t.barycenter*t.weight,s+=t.weight);e.weight&&(i+=e.barycenter*e.weight,s+=e.weight);t.vs=e.vs.concat(t.vs),t.barycenter=i/s,t.weight=s,t.i=Math.min(e.i,t.i),e.merged=!0}(t,e)}}function s(e){return function(i){i.in.push(e),0==--i.indegree&&t.push(i)}}for(;t.length;){var n=t.pop();e.push(n),Zf.forEach(n.in.reverse(),i(n)),Zf.forEach(n.out,s(n))}return Zf.map(Zf.filter(e,(function(t){return!t.merged})),(function(t){return Zf.pick(t,["vs","i","barycenter","weight"])}))}(Zf.filter(i,(function(t){return!t.indegree})))},np=function(t,e){var i=Qf.partition(t,(function(t){return Kf.has(t,"barycenter")})),s=i.lhs,n=Kf.sortBy(i.rhs,(function(t){return-t.i})),r=[],a=0,o=0,h=0;s.sort((l=!!e,function(t,e){return t.barycenter<e.barycenter?-1:t.barycenter>e.barycenter?1:l?e.i-t.i:t.i-e.i})),h=tp(r,n,h),Kf.forEach(s,(function(t){h+=t.vs.length,r.push(t.vs),a+=t.barycenter*t.weight,o+=t.weight,h=tp(r,n,h)}));var l;var c={vs:Kf.flatten(r,!0)};o&&(c.barycenter=a/o,c.weight=o);return c},rp=function t(e,i,s,n){var r=e.children(i),a=e.node(i),o=a?a.borderLeft:void 0,h=a?a.borderRight:void 0,l={};o&&(r=ep.filter(r,(function(t){return t!==o&&t!==h})));var c=ip(e,r);ep.forEach(c,(function(i){if(e.children(i.v).length){var r=t(e,i.v,s,n);l[i.v]=r,ep.has(r,"barycenter")&&(a=i,o=r,ep.isUndefined(a.barycenter)?(a.barycenter=o.barycenter,a.weight=o.weight):(a.barycenter=(a.barycenter*a.weight+o.barycenter*o.weight)/(a.weight+o.weight),a.weight+=o.weight))}var a,o}));var u=sp(c,s);!function(t,e){ep.forEach(t,(function(t){t.vs=ep.flatten(t.vs.map((function(t){return e[t]?e[t].vs:t})),!0)}))}(u,l);var d=np(u,n);if(o&&(d.vs=ep.flatten([o,d.vs,h],!0),e.predecessors(o).length)){var f=e.node(e.predecessors(o)[0]),p=e.node(e.predecessors(h)[0]);ep.has(d,"barycenter")||(d.barycenter=0,d.weight=0),d.barycenter=(d.barycenter*d.weight+f.order+p.order)/(d.weight+2),d.weight+=2}return d};var ap=Ad,op=dd.Graph,hp=function(t,e,i){var s=function(t){var e;for(;t.hasNode(e=ap.uniqueId("_root")););return e}(t),n=new op({compound:!0}).setGraph({root:s}).setDefaultNodeLabel((function(e){return t.node(e)}));return ap.forEach(t.nodes(),(function(r){var a=t.node(r),o=t.parent(r);(a.rank===e||a.minRank<=e&&e<=a.maxRank)&&(n.setNode(r),n.setParent(r,o||s),ap.forEach(t[i](r),(function(e){var i=e.v===r?e.w:e.v,s=n.edge(i,r),a=ap.isUndefined(s)?0:s.weight;n.setEdge(i,r,{weight:t.edge(e).weight+a})})),ap.has(a,"minRank")&&n.setNode(r,{borderLeft:a.borderLeft[e],borderRight:a.borderRight[e]}))})),n};var lp=Ad;var cp=Ad,up=qf,dp=Hf,fp=rp,pp=hp,gp=function(t,e,i){var s,n={};lp.forEach(i,(function(i){for(var r,a,o=t.parent(i);o;){if((r=t.parent(o))?(a=n[r],n[r]=o):(a=s,s=o),a&&a!==o)return void e.setEdge(a,o);o=r}}))},_p=dd.Graph,mp=Yd,yp=function(t){var e=mp.maxRank(t),i=vp(t,cp.range(1,e+1),"inEdges"),s=vp(t,cp.range(e-1,-1,-1),"outEdges"),n=up(t);xp(t,n);for(var r,a=Number.POSITIVE_INFINITY,o=0,h=0;h<4;++o,++h){bp(o%2?i:s,o%4>=2),n=mp.buildLayerMatrix(t);var l=dp(t,n);l<a&&(h=0,r=cp.cloneDeep(n),a=l)}xp(t,r)};function vp(t,e,i){return cp.map(e,(function(e){return pp(t,e,i)}))}function bp(t,e){var i=new _p;cp.forEach(t,(function(t){var s=t.graph().root,n=fp(t,s,i,e);cp.forEach(n.vs,(function(e,i){t.node(e).order=i})),gp(t,i,n.vs)}))}function xp(t,e){cp.forEach(e,(function(e){cp.forEach(e,(function(e,i){t.node(e).order=i}))}))}var wp=Ad,kp=dd.Graph,Sp=Yd,Cp=function(t){var e,i=Sp.buildLayerMatrix(t),s=wp.merge(Ep(t,i),Ap(t,i)),n={};wp.forEach(["u","d"],(function(r){e="u"===r?i:wp.values(i).reverse(),wp.forEach(["l","r"],(function(i){"r"===i&&(e=wp.map(e,(function(t){return wp.values(t).reverse()})));var a=("u"===r?t.predecessors:t.successors).bind(t),o=Op(t,e,s,a),h=Rp(t,e,o.root,o.align,"r"===i);"r"===i&&(h=wp.mapValues(h,(function(t){return-t}))),n[r+i]=h}))}));var r=Mp(t,n);return Np(n,r),Bp(n,t.graph().align)};function Ep(t,e){var i={};return wp.reduce(e,(function(e,s){var n=0,r=0,a=e.length,o=wp.last(s);return wp.forEach(s,(function(e,h){var l=function(t,e){if(t.node(e).dummy)return wp.find(t.predecessors(e),(function(e){return t.node(e).dummy}))}(t,e),c=l?t.node(l).order:a;(l||e===o)&&(wp.forEach(s.slice(r,h+1),(function(e){wp.forEach(t.predecessors(e),(function(s){var r=t.node(s),a=r.order;!(a<n||c<a)||r.dummy&&t.node(e).dummy||Tp(i,s,e)}))})),r=h+1,n=c)})),s})),i}function Ap(t,e){var i={};function s(e,s,n,r,a){var o;wp.forEach(wp.range(s,n),(function(s){o=e[s],t.node(o).dummy&&wp.forEach(t.predecessors(o),(function(e){var s=t.node(e);s.dummy&&(s.order<r||s.order>a)&&Tp(i,e,o)}))}))}return wp.reduce(e,(function(e,i){var n,r=-1,a=0;return wp.forEach(i,(function(o,h){if("border"===t.node(o).dummy){var l=t.predecessors(o);l.length&&(n=t.node(l[0]).order,s(i,a,h,r,n),a=h,r=n)}s(i,a,i.length,n,e.length)})),i})),i}function Tp(t,e,i){if(e>i){var s=e;e=i,i=s}var n=t[e];n||(t[e]=n={}),n[i]=!0}function Ip(t,e,i){if(e>i){var s=e;e=i,i=s}return wp.has(t[e],i)}function Op(t,e,i,s){var n={},r={},a={};return wp.forEach(e,(function(t){wp.forEach(t,(function(t,e){n[t]=t,r[t]=t,a[t]=e}))})),wp.forEach(e,(function(t){var e=-1;wp.forEach(t,(function(t){var o=s(t);if(o.length){o=wp.sortBy(o,(function(t){return a[t]}));for(var h=(o.length-1)/2,l=Math.floor(h),c=Math.ceil(h);l<=c;++l){var u=o[l];r[t]===t&&e<a[u]&&!Ip(i,t,u)&&(r[u]=t,r[t]=n[t]=n[u],e=a[u])}}}))})),{root:n,align:r}}function Rp(t,e,i,s,n){var r={},a=function(t,e,i,s){var n=new kp,r=t.graph(),a=function(t,e,i){return function(s,n,r){var a,o=s.node(n),h=s.node(r),l=0;if(l+=o.width/2,wp.has(o,"labelpos"))switch(o.labelpos.toLowerCase()){case"l":a=-o.width/2;break;case"r":a=o.width/2}if(a&&(l+=i?a:-a),a=0,l+=(o.dummy?e:t)/2,l+=(h.dummy?e:t)/2,l+=h.width/2,wp.has(h,"labelpos"))switch(h.labelpos.toLowerCase()){case"l":a=h.width/2;break;case"r":a=-h.width/2}return a&&(l+=i?a:-a),a=0,l}}(r.nodesep,r.edgesep,s);return wp.forEach(e,(function(e){var s;wp.forEach(e,(function(e){var r=i[e];if(n.setNode(r),s){var o=i[s],h=n.edge(o,r);n.setEdge(o,r,Math.max(a(t,e,s),h||0))}s=e}))})),n}(t,e,i,n),o=n?"borderLeft":"borderRight";function h(t,e){for(var i=a.nodes(),s=i.pop(),n={};s;)n[s]?t(s):(n[s]=!0,i.push(s),i=i.concat(e(s))),s=i.pop()}return h((function(t){r[t]=a.inEdges(t).reduce((function(t,e){return Math.max(t,r[e.v]+a.edge(e))}),0)}),a.predecessors.bind(a)),h((function(e){var i=a.outEdges(e).reduce((function(t,e){return Math.min(t,r[e.w]-a.edge(e))}),Number.POSITIVE_INFINITY),s=t.node(e);i!==Number.POSITIVE_INFINITY&&s.borderType!==o&&(r[e]=Math.max(r[e],i))}),a.successors.bind(a)),wp.forEach(s,(function(t){r[t]=r[i[t]]})),r}function Mp(t,e){return wp.minBy(wp.values(e),(function(e){var i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;return wp.forIn(e,(function(e,n){var r=function(t,e){return t.node(e).width}(t,n)/2;i=Math.max(e+r,i),s=Math.min(e-r,s)})),i-s}))}function Np(t,e){var i=wp.values(e),s=wp.min(i),n=wp.max(i);wp.forEach(["u","d"],(function(i){wp.forEach(["l","r"],(function(r){var a,o=i+r,h=t[o];if(h!==e){var l=wp.values(h);(a="l"===r?s-wp.min(l):n-wp.max(l))&&(t[o]=wp.mapValues(h,(function(t){return t+a})))}}))}))}function Bp(t,e){return wp.mapValues(t.ul,(function(i,s){if(e)return t[e.toLowerCase()][s];var n=wp.sortBy(wp.map(t,s));return(n[1]+n[2])/2}))}var Fp=Ad,Pp=Yd,Vp=Cp;var jp=Ad,Lp=zd,Dp=Xd,zp=Ef,Gp=Yd.normalizeRanks,Wp=Of,Yp=Yd.removeEmptyRanks,Up=Nf,qp=Vf,Jp=Df,Hp=yp,Xp=function(t){(function(t){var e=Pp.buildLayerMatrix(t),i=t.graph().ranksep,s=0;Fp.forEach(e,(function(e){var n=Fp.max(Fp.map(e,(function(e){return t.node(e).height})));Fp.forEach(e,(function(e){t.node(e).y=s+n/2})),s+=n+i}))})(t=Pp.asNonCompoundGraph(t)),Fp.forEach(Vp(t),(function(e,i){t.node(i).x=e}))},$p=Yd,Zp=dd.Graph,Kp=function(t,e){var i=e&&e.debugTiming?$p.time:$p.notime;i("layout",(function(){var e=i("  buildLayoutGraph",(function(){return function(t){var e=new Zp({multigraph:!0,compound:!0}),i=hg(t.graph());return e.setGraph(jp.merge({},tg,og(i,Qp),jp.pick(i,eg))),jp.forEach(t.nodes(),(function(i){var s=hg(t.node(i));e.setNode(i,jp.defaults(og(s,ig),sg)),e.setParent(i,t.parent(i))})),jp.forEach(t.edges(),(function(i){var s=hg(t.edge(i));e.setEdge(i,jp.merge({},rg,og(s,ng),jp.pick(s,ag)))})),e}(t)}));i("  runLayout",(function(){!function(t,e){e("    makeSpaceForEdgeLabels",(function(){!function(t){var e=t.graph();e.ranksep/=2,jp.forEach(t.edges(),(function(i){var s=t.edge(i);s.minlen*=2,"c"!==s.labelpos.toLowerCase()&&("TB"===e.rankdir||"BT"===e.rankdir?s.width+=s.labeloffset:s.height+=s.labeloffset)}))}(t)})),e("    removeSelfEdges",(function(){!function(t){jp.forEach(t.edges(),(function(e){if(e.v===e.w){var i=t.node(e.v);i.selfEdges||(i.selfEdges=[]),i.selfEdges.push({e:e,label:t.edge(e)}),t.removeEdge(e)}}))}(t)})),e("    acyclic",(function(){Lp.run(t)})),e("    nestingGraph.run",(function(){Up.run(t)})),e("    rank",(function(){zp($p.asNonCompoundGraph(t))})),e("    injectEdgeLabelProxies",(function(){!function(t){jp.forEach(t.edges(),(function(e){var i=t.edge(e);if(i.width&&i.height){var s=t.node(e.v),n={rank:(t.node(e.w).rank-s.rank)/2+s.rank,e:e};$p.addDummyNode(t,"edge-proxy",n,"_ep")}}))}(t)})),e("    removeEmptyRanks",(function(){Yp(t)})),e("    nestingGraph.cleanup",(function(){Up.cleanup(t)})),e("    normalizeRanks",(function(){Gp(t)})),e("    assignRankMinMax",(function(){!function(t){var e=0;jp.forEach(t.nodes(),(function(i){var s=t.node(i);s.borderTop&&(s.minRank=t.node(s.borderTop).rank,s.maxRank=t.node(s.borderBottom).rank,e=jp.max(e,s.maxRank))})),t.graph().maxRank=e}(t)})),e("    removeEdgeLabelProxies",(function(){!function(t){jp.forEach(t.nodes(),(function(e){var i=t.node(e);"edge-proxy"===i.dummy&&(t.edge(i.e).labelRank=i.rank,t.removeNode(e))}))}(t)})),e("    normalize.run",(function(){Dp.run(t)})),e("    parentDummyChains",(function(){Wp(t)})),e("    addBorderSegments",(function(){qp(t)})),e("    order",(function(){Hp(t)})),e("    insertSelfEdges",(function(){!function(t){var e=$p.buildLayerMatrix(t);jp.forEach(e,(function(e){var i=0;jp.forEach(e,(function(e,s){var n=t.node(e);n.order=s+i,jp.forEach(n.selfEdges,(function(e){$p.addDummyNode(t,"selfedge",{width:e.label.width,height:e.label.height,rank:n.rank,order:s+ ++i,e:e.e,label:e.label},"_se")})),delete n.selfEdges}))}))}(t)})),e("    adjustCoordinateSystem",(function(){Jp.adjust(t)})),e("    position",(function(){Xp(t)})),e("    positionSelfEdges",(function(){!function(t){jp.forEach(t.nodes(),(function(e){var i=t.node(e);if("selfedge"===i.dummy){var s=t.node(i.e.v),n=s.x+s.width/2,r=s.y,a=i.x-n,o=s.height/2;t.setEdge(i.e,i.label),t.removeNode(e),i.label.points=[{x:n+2*a/3,y:r-o},{x:n+5*a/6,y:r-o},{x:n+a,y:r},{x:n+5*a/6,y:r+o},{x:n+2*a/3,y:r+o}],i.label.x=i.x,i.label.y=i.y}}))}(t)})),e("    removeBorderNodes",(function(){!function(t){jp.forEach(t.nodes(),(function(e){if(t.children(e).length){var i=t.node(e),s=t.node(i.borderTop),n=t.node(i.borderBottom),r=t.node(jp.last(i.borderLeft)),a=t.node(jp.last(i.borderRight));i.width=Math.abs(a.x-r.x),i.height=Math.abs(n.y-s.y),i.x=r.x+i.width/2,i.y=s.y+i.height/2}})),jp.forEach(t.nodes(),(function(e){"border"===t.node(e).dummy&&t.removeNode(e)}))}(t)})),e("    normalize.undo",(function(){Dp.undo(t)})),e("    fixupEdgeLabelCoords",(function(){!function(t){jp.forEach(t.edges(),(function(e){var i=t.edge(e);if(jp.has(i,"x"))switch("l"!==i.labelpos&&"r"!==i.labelpos||(i.width-=i.labeloffset),i.labelpos){case"l":i.x-=i.width/2+i.labeloffset;break;case"r":i.x+=i.width/2+i.labeloffset}}))}(t)})),e("    undoCoordinateSystem",(function(){Jp.undo(t)})),e("    translateGraph",(function(){!function(t){var e=Number.POSITIVE_INFINITY,i=0,s=Number.POSITIVE_INFINITY,n=0,r=t.graph(),a=r.marginx||0,o=r.marginy||0;function h(t){var r=t.x,a=t.y,o=t.width,h=t.height;e=Math.min(e,r-o/2),i=Math.max(i,r+o/2),s=Math.min(s,a-h/2),n=Math.max(n,a+h/2)}jp.forEach(t.nodes(),(function(e){h(t.node(e))})),jp.forEach(t.edges(),(function(e){var i=t.edge(e);jp.has(i,"x")&&h(i)})),e-=a,s-=o,jp.forEach(t.nodes(),(function(i){var n=t.node(i);n.x-=e,n.y-=s})),jp.forEach(t.edges(),(function(i){var n=t.edge(i);jp.forEach(n.points,(function(t){t.x-=e,t.y-=s})),jp.has(n,"x")&&(n.x-=e),jp.has(n,"y")&&(n.y-=s)})),r.width=i-e+a,r.height=n-s+o}(t)})),e("    assignNodeIntersects",(function(){!function(t){jp.forEach(t.edges(),(function(e){var i,s,n=t.edge(e),r=t.node(e.v),a=t.node(e.w);n.points?(i=n.points[0],s=n.points[n.points.length-1]):(n.points=[],i=a,s=r),n.points.unshift($p.intersectRect(r,i)),n.points.push($p.intersectRect(a,s))}))}(t)})),e("    reversePoints",(function(){!function(t){jp.forEach(t.edges(),(function(e){var i=t.edge(e);i.reversed&&i.points.reverse()}))}(t)})),e("    acyclic.undo",(function(){Lp.undo(t)}))}(e,i)})),i("  updateInputGraph",(function(){!function(t,e){jp.forEach(t.nodes(),(function(i){var s=t.node(i),n=e.node(i);s&&(s.x=n.x,s.y=n.y,e.children(i).length&&(s.width=n.width,s.height=n.height))})),jp.forEach(t.edges(),(function(i){var s=t.edge(i),n=e.edge(i);s.points=n.points,jp.has(n,"x")&&(s.x=n.x,s.y=n.y)})),t.graph().width=e.graph().width,t.graph().height=e.graph().height}(t,e)}))}))};var Qp=["nodesep","edgesep","ranksep","marginx","marginy"],tg={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},eg=["acyclicer","ranker","rankdir","align"],ig=["width","height"],sg={width:0,height:0},ng=["minlen","weight","width","height","labeloffset"],rg={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},ag=["labelpos"];function og(t,e){return jp.mapValues(jp.pick(t,e),Number)}function hg(t){var e={};return jp.forEach(t,(function(t,i){e[i.toLowerCase()]=t})),e}var lg=Ad,cg=Yd,ug=dd.Graph;var dg={graphlib:dd,layout:Kp,debug:{debugOrdering:function(t){var e=cg.buildLayerMatrix(t),i=new ug({compound:!0,multigraph:!0}).setGraph({});return lg.forEach(t.nodes(),(function(e){i.setNode(e,{label:e}),i.setParent(e,"layer"+t.node(e).rank)})),lg.forEach(t.edges(),(function(t){i.setEdge(t.v,t.w,{},t.name)})),lg.forEach(e,(function(t,e){var s="layer"+e;i.setNode(s,{rank:"same"}),lg.reduce(t,(function(t,e){return i.setEdge(t,e,{style:"invis"}),e}))})),i}},util:{time:Yd.time,notime:Yd.notime},version:"0.8.5"};class fg extends J{constructor(t){super(t),this.type=m.Sugiyama,this._width="width"in t?t.width:500,this._height="height"in t?t.height:300,this._top="top"in t?t.top:0,this._left="left"in t?t.left:0,this._edgeSep="edgeSep"in t?t.edgeSep:50}toJSON(){let t={args:{}};return t.type=this.type,t}run(){let t=this.group.children[0].dataScope._dt.graph;if(!t)return;var e=new dg.graphlib.Graph;e.setGraph({edgesep:this._edgeSep}),e.setDefaultEdgeLabel((function(){return{}}));let i=new Map;for(let t of this.group.children){let s=t.dataScope.getFieldValue(r);i.set(s,s+""),e.setNode(s,{label:t.text?t.text:"",width:t.bounds.width,height:t.bounds.height})}for(let i of t.links)e.setEdge(i.source,i.target);dg.layout(e);const s={};let n=Math.min(...e.nodes().map((t=>e.node(t).y))),a=Math.min(...e.nodes().map((t=>e.node(t).x))),o=this._left-a,h=this._top-n;for(const t of e.nodes())s[t]={x:e.node(t).x+o,y:e.node(t).y+h};for(let t of this.group.children){let e=t.dataScope.getFieldValue(r);t.x=s[i.get(e)].x,t.y=s[i.get(e)].y}this.group._updateBounds(),this.group.getScene()._updateAncestorBounds(this.group)}}class pg extends J{constructor(t){super(t),this.type=m.Strata,this._direction=t.direction,this._rootMark=t.rootMark,this._gap="gap"in t?t.gap:0}toJSON(){let t={args:{}};return t.type=this.type,t.args.direction=this._direction,t.args.rootMark=this._rootMark.id,t.args.gap=this._gap,t}clone(){}run(){if(null==this.group||!this.group.children||0===this.group.children.length)return;let t=this.group.firstChild.dataScope.dataTable.tree;if(!t)return;let e={};for(let t of this.group.children)e[t.dataScope.getFieldValue(r)]=t;this._rootMark.type===k.Rect?this._layoutRects(t.getRoot(),t,e):this._rootMark.type===k.Circle&&this._layoutArcs(t.getRoot(),t,e)}_layoutArcs(t,e,i){let s=e.getChildren(t);if(0===s.length)return;let n=i[t[r]],a=n.type==k.Arc||n.type==k.Pie?n.startAngle:90;for(let t=0;t<s.length;t++){let n=s[t],o=i[n[r]];if(o.type===k.Arc){let t=Q(a+o.angle);o.adjustAngle(a,t),a=t}this._layoutArcs(n,e,i)}}_layoutRects(t,e,i){let s=e.getChildren(t);if(0===s.length)return;let n,a,o=i[t[r]];this._direction,v.Down,n=o.left,a=o.bottom;for(let t=0;t<s.length;t++){let o=s[t],h=i[o[r]];h._doTranslate(n-h.left,a-h.top),n+=h.width,this._layoutRects(o,e,i)}}}function gg(t,e){if("field"in e){if(!t.dataScope)return!1;let i=e.field;if("value"in e)return t.dataScope.getFieldValue(i)===e.value;if("interval"in e){let s=t.dataScope.getFieldValue(i);return s>=e.interval[0]&&s<=e.interval[1]}return"values"in e?e.values.indexOf(t.dataScope.getFieldValue(i))>=0:t.dataScope.hasField(i)}if("channel"in e){let i=e.channel;if("value"in e)return t[i]===e.value;if("interval"in e)return t[i]>=e.interval[0]&&t[i]<=e.interval[1];if("values"in e)return e.values.indexOf(t[i])>=0}else{if("type"in e)return t.type===e.type;if("id"in e)return t.id===e.id;if("classId"in e)return t.classId===e.classId;if("fields"in e){if(!t.dataScope)return!1;let i=e.fields[0],s=e.fields[1],n=t.dataScope.getFieldValue(i),r=t.dataScope.getFieldValue(s);switch(e.operator){case"==":return n==r;case">":return n>r;case">=":return n>=r;case"<":return n<r;case"<=":return n<=r}}}return!1}function _g(t,e){let i=[];return mg(t,e,i),i}function mg(t,e,i){if(t&&"axis"!=t.type&&"legend"!=t.type&&"gridlines"!=t.type)if(yg(t,e)&&i.push(t),t.vertices)for(let s of t.vertices.concat(t.segments))yg(s,e)&&i.push(s);else if(t.children&&t.children.length>0)for(let s of t.children)mg(s,e,i)}function yg(t,e){for(let i of e)if(!gg(t,i))return!1;return!0}function vg(t,e){return"vertex"==t.type?function(t,e){if(!t.classId){if(t.dataScope){let i=t.parent;if(!i)throw new Error("vertex has no parent mark");let s=_g(e,[{classId:i.classId}]),n=[];if(i.type===k.Area){let e=i.vertices.indexOf(t)<i.vertices.length/2;for(let t of s){let i=e?t.vertices.slice(0,t.vertices.length/2):t.vertices.slice(t.vertices.length/2);n=n.concat(i.filter((t=>t.dataScope)))}}else for(let t of s)n=n.concat(t.vertices.filter((t=>t.dataScope)));return n}{let i=t.parent;if(!i)throw new Error("vertex has no parent mark");let s=i.vertices.indexOf(t),n=_g(e,[{classId:i.classId}]),r=[];for(let t of n)r.push(t.vertices[s]);return r}}}(t,e):"segment"==t.type?function(t,e){if(t.dataScope){let i=t.parent;if(!i)throw new Error("segment has no parent mark");let s=_g(e,[{classId:i.classId}]),n=[];for(let t of s)n=n.concat(t.segments);return n}{let i=t.parent;if(!i)throw new Error("segment has no parent mark");let s=i.segments.indexOf(t),n=_g(e,[{classId:i.classId}]),r=[];for(let t of n)r.push(t.segments[s]);return r}}(t,e):t.classId?_g(e,[{classId:t.classId}]):[]}function bg(t,e){let i=t.parent;for(;i&&i.type!=k.Scene;){if(i.layout&&(!e||e&&i.layout.type===e))return i.layout;i=i.parent}}function xg(t){let e=t,i=t.parent;for(;i&&i.type!=k.Scene;){if(i.layout){let t=i.children.findIndex((t=>t==e));return i.layout.cellBounds[t]}e=e.parent,i=e.parent}}function wg(t){let e=t,i=t.parent;for(;i&&i.type!=k.Scene;){if(i.layout)return i.children.findIndex((t=>t==e));e=e.parent,i=e.parent}}function kg(t){let e=t,i=t.parent;for(;i&&i.type!=k.Scene;){if(i.layout&&i.layout.type==m.Grid){let t=i.children.findIndex((t=>t==e));return i.layout.cellBounds[t]}e=e.parent,i=e.parent}}function Sg(t,e){let i,s=t.parent;for(;s&&s.type!==k.Scene;)s.layout&&(!e||e&&s.layout.type===e)&&(i=s.layout),s=s.parent;return i}function Cg(t){if(t.classId)return t.classId;if("vertex"==t.type&&t.dataScope){if(t.parent.type===k.Area){let e=t.parent.vertices.indexOf(t)<t.parent.vertices.length/2;return t.parent.classId+"_v_"+(e?0:t.parent.vertices.length-1)}return t.parent.classId+"_v"}return"vertex"==t.type?t.parent.classId+"_v_"+t.parent.vertices.indexOf(t):"segment"==t.type&&t.dataScope?t.parent.classId+"_s":"segment"==t.type?t.parent.classId+"_s_"+t.parent.segments.indexOf(t):null}function Eg(t,e){return Cg(t).split("_")[0]===Cg(e).split("_")[0]}function Ag(t){let e=[];for(let i of t)i.parent&&e.indexOf(i.parent)<0&&e.push(i.parent);return e}function Tg(t){let e=[];if(t.children&&t.children.length>0)for(let i of t.children)e.push(i),e=e.concat(Tg(i));return e}function Ig(t){let e=[];if(Mg(t))e.push(t);else if(t.children&&t.children.length>0&&!Rg(t))for(let i of t.children)e=e.concat(Ig(i));return e}function Og(t){let e=[];if(t.children&&t.children.length>0)for(let i of t.children)e=e.concat(Og(i));else e.push(t);return e}function Rg(t){return t.type===k.Axis||t.type===k.Legend||t.type===k.Gridlines}function Mg(t){return t instanceof z}function Ng(t){return t instanceof q}function Bg(t){return!(!Mg(t)&&t.type!=k.Glyph||t.dataScope)||t.type===k.Collection&&t.firstChild.dataScope.numTuples>1}const Fg={area:0,rect:0,circle:0,pie:0,line:0,path:0,ring:0,arc:0,image:0,pointText:0,collection:0,group:0,scene:0,axis:0,glyph:0,legend:0,polygon:0,gridlines:0,LinearGradient:0,link:0,scale:0,datatable:0};function Pg(t,e){if(e.getEncodingByItem(t,"x"))return!1;if(t.parent&&t.parent.layout){let e=t.parent.layout;if(e.type==m.Grid&&e.numCols>1)return!1}return!t.parent||t.parent.type==k.Scene||Pg(t.parent,e)}function Vg(t,e){if(e.getEncodingByItem(t,"y"))return!1;if(t.parent&&t.parent.layout){let e=t.parent.layout;if(e.type==m.Grid&&e.numRows>1)return!1}return!t.parent||t.parent.type==k.Scene||Vg(t.parent,e)}var jg={canvas:void 0,getCanvas:function(){return window?(void 0===this.canvas&&(this.canvas=document.createElement("canvas")),this.canvas):null},getContext:function(){var t=this.getCanvas();return t?t.getContext("2d"):null}},Lg={svg:void 0,getSVG:function(){return window?(void 0===this.svg&&(this.svg=document.createElement("svg")),this.svg):null}};function Dg(t){let e=t.parent;return e.type==k.Scene?t:Dg(e)}function zg(t){let e=t.parent;return t.type==k.Collection?e.type==k.Collection?zg(e):t:e.type!=k.Scene?zg(e):void 0}function Gg(t,e,i,s){return[i*Math.cos(Yg(s))+t,e-i*Math.sin(Yg(s))]}function Wg(t,e,i,s){let n=function(t){return 180*t/Math.PI}(Math.atan2(s-e,t-i));n=Math.round(10*n+Number.EPSILON)/10,n<0&&(n+=360);let r=Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2));return r=Math.round(10*r+Number.EPSILON)/10,[n,r]}function Yg(t){return t*Math.PI/180}function Ug(t){let e=t.vertices.length;for(let i=0;i<t.vertices.length/2;i++){let s=i,n=e-i-1,r=t.vertices[s],a=t.vertices[n];if(r.x!=a.x||r.y!=a.y)return r.x==a.x?"horizontal":"vertical"}}function qg(t,e){let i=e||{};switch(t.toLowerCase()){case"grid":return new H(i);case"packing":return new X(i);case"treemap":return new $(i);case"stack":return new tt(i);case"tidytree":return new et(i);case"force":return new it(i);case"sugiyama":return new fg(i);case"strata":return new pg(i)}}class Jg{constructor(){this.children=[],this._dataScope=void 0,this._layout=void 0,this.type=k.Group,this._id=this.type+Fg[this.type]++}get id(){return this._id}set id(t){this.type!==k.Scene&&this.getScene()?(delete this.getScene()._itemMap[this._id],this._id=t,this.getScene()._itemMap[t]=this):this._id=t}contains(t,e){return this._bounds||this._updateBounds(),this._bounds.contains(t,e)}toJSON(){let t={};if(t.type=this.type,t.id=this.id,this._dataScope&&(t.dataScope=this._dataScope.toJSON()),this.classId&&(t.classId=this.classId),this._layout&&(t.layout=this._layout.toJSON()),this._bounds&&(t.bounds=this._bounds.toJSON()),t.children=[],this.children.length>0)for(let e of this.children)t.children.push(e.toJSON());return this.childrenOrder&&(t.childrenOrder=this.childrenOrder),t}addChild(t){this.children.indexOf(t)>=0||(t.parent&&t.parent.removeChild(t),this.children.push(t),t.parent=this)}addChildAt(t,e){t.parent&&t.parent.removeChild(t),this.children.splice(e,0,t),t.parent=this}removeChild(t){let e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=null)}removeChildAt(t){this.children[t].parent=null,this.children.splice(t,1)}removeAll(){for(let t of this.children)t.parent=null;this.children=[]}getScene(){let t=this;for(;t;){if(t.type==k.Scene)return t;t=t.parent}}get dataScope(){return this._dataScope}set dataScope(t){if(this._dataScope=t,void 0===t)for(let e of this.children)e.dataScope=t;else for(let e of this.children)e.dataScope?e.dataScope=e.dataScope.merge(t):e.dataScope=t}_doTranslate(t,e){for(let i of this.children)i._doTranslate(t,e);this._updateBounds(),this._layout&&(void 0!==this._layout._left&&(this._layout._left+=t),void 0!==this._layout._top&&(this._layout._top+=e),void 0!==this._layout.x&&(this._layout.x+=t),void 0!==this._layout.y&&(this._layout.y+=e)),this._updateBounds()}getInternalEncodings(t){if(0==this.children.length)return[];let e=this.children[0],i=this.getScene(),s=Object.keys(i.encodings),n=[];for(;e;){if(e.classId&&n.indexOf(e.classId)<0&&n.push(e.classId),e.type===k.Glyph){e.children.forEach((t=>n.push(t.classId)));break}if(!e.children)break;e=e.children[0]}let r=[];for(let e of s){let s=e.split("_");for(let a of n)s[0]==a&&i.encodings[e][t]&&r.push(i.encodings[e][t])}return r}get firstChild(){return this.children[0]}get lastChild(){return this.children[this.children.length-1]}set layout(t){if(this._layout=t,t)t.group=this,this._layout.run();else{let t=this.getInternalEncodings("x"),e=this.getInternalEncodings("y");for(let e of t)e._map(),e._apply();for(let t of e)t._map(),t._apply()}}get layout(){return this._layout}get bounds(){return this._bounds||this._updateBounds(),this._bounds}get refBounds(){let t=this.children.map((t=>t.refBounds)),e=Math.min(...t.map((t=>t.left))),i=Math.min(...t.map((t=>t.top))),s=Math.max(...t.map((t=>t.right))),r=Math.max(...t.map((t=>t.bottom)));return new n(e,i,s-e,r-i)}get x(){return this.bounds.x}get y(){return this.bounds.y}_updateBounds(){if(this.children.length>0){this._bounds=this.children[0].bounds.clone();for(let t=1;t<this.children.length;t++)"hidden"!=this.children[t].visibility&&(this._bounds=this._bounds.union(this.children[t].bounds));if(this._layout&&"grid"==this._layout.type){let t=this._layout.cellBounds;for(let e=0;e<t.length;e++)this._bounds=this._bounds.union(t[e])}}else this._bounds=new n(0,0,0,0)}sortChildrenByData(t,e,i){let s;switch(this.children[0].dataScope.getFieldType(t)){case S.Date:break;case S.Number:case S.Integer:s=(e,i)=>e.dataScope.aggregateNumericalField(t)-i.dataScope.aggregateNumericalField(t);break;case S.String:s=i?(e,s)=>i.indexOf(e.dataScope.getFieldValue(t))-i.indexOf(s.dataScope.getFieldValue(t)):(e,i)=>e.dataScope.getFieldValue(t)<i.dataScope.getFieldValue(t)?-1:1}this.children.sort(s),e&&this.children.reverse(),this.layout&&this.layout.run(),this._childrenOrder={field:t,direction:e?"desc":"asc",ranking:i}}sortChildren(t,e){let i;switch(t){case"x":case"y":case"width":case"height":i=(e,i)=>e.bounds[t]-i.bounds[t];break;default:i=(e,i)=>e[t]-i[t]}this.children.sort(i),e&&this.children.reverse(),this.layout&&this.layout.run(),this.childrenOrder={channel:t,reverse:e}}set visibility(t){this._visibility="hidden"==t?t:"visible";for(let e of this.children)e.visibility=t}get visibility(){return this._visibility?this._visibility:"visible"}}class Hg{constructor(t){this._field2value={},this._dt=t,this._tuples=this._dt.data}toJSON(){let t={};return t.dt=this._dt.id,t.f2v=Object.assign({},this._field2value),t.tuples=this._tuples.map((t=>parseInt(t[a].substring(1)))),t}isFullTable(){return 0===Object.keys(this._field2value).length}isEmpty(){return 0==this._tuples.length}get numTuples(){return this._tuples.length}get fields(){return Object.keys(this._field2value)}get dataTable(){return this._dt}get filters(){return this._field2value}merge(t){let e=new Hg(this._dt);for(let i in t._field2value)e=e.cross(i,t._field2value[i]);for(let t in this._field2value)e=e.cross(t,this._field2value[t]);return e}cross(t,e){let i=this.clone();return i._field2value[t]=e,i._updateTuples(t,e),i}clone(){let t=new Hg(this._dt);return t._field2value=Object.assign({},this._field2value),t._tuples=this._tuples.map((t=>t)),t}getFieldValue(t){let e=this._tuples.map((e=>e[t]));return e=[...new Set(e)],e.length,e[0]}getUniqueFieldValues(t){let e=this._tuples.map((e=>e[t]));return[...new Set(e)]}hasField(t){return t in this._field2value}getFieldType(t){return this._dt.getFieldType(t)}aggregateNumericalField(t,e){let i=this._tuples.map((e=>e[t]));switch(e){case C:return Math.max(...i);case E:return Math.min(...i);case A:case O:return s.mean(i);case T:return s.median(i);case I:return i.length;case R:return s.quantile(i,.25);case M:return s.quantile(i,.75);default:return s.sum(i)}}_updateTuples(t,e){this._tuples=this._tuples.filter((i=>i[t]==e))}get tuples(){return this._tuples}}function Xg(t){if(Array.isArray(t)){if(1===t.length)return Bg(t[0]);for(let e of t)if(!Mg(e)||e.dataScope)return!1;return!0}return Bg(t)}function $g(t,e,i,s,n){let r=n?s.transformField(i,n):i,a=s.getFieldType(r);if(a!=S.String&&a!=S.Date&&a!=S.Integer)throw new Error(P.REPEAT_BY_NONCAT+": "+r+" is "+a);if(!Xg(e))throw new Error(P.COMPNT_NON_REPEATABLE);return function(t,e,i,s){let n=s.getFieldSummary(i).unique.map((t=>e.dataScope?e.dataScope.cross(i,t):new Hg(s).cross(i,t)));n=n.filter((t=>!t.isEmpty()));let r=t.collection();r.dataScope=e.dataScope?e.dataScope.clone():new Hg(s),r.addChild(e);for(let t=1;t<n.length;t++){let t=e.duplicate();r.addChild(t)}return r.children.forEach(((t,e)=>t.dataScope=n[e])),t._reapplySizeBindings(e),r}(t,e,r,s)}function Zg(t){if([k.Line,k.Circle,k.Rect,k.Area,k.Ring,k.Pie,k.Path].indexOf(t.type)<0)return!1;if(t.type===k.Path&&(t.closed||!t.firstVertex.dataScope))return!1;if(t.dataScope){let e=vg(t,t.getScene());for(let t of e)if(t.dataScope.numTuples>1)return!0;return!1}return!0}function Kg(t,e,i,s,n,r){let a=r?n.transformField(s,r):s,o=n.getFieldType(a);if(o!=S.String&&o!=S.Date)throw new Error(P.PARTITION_BY_NONCAT+": "+a+" is "+o);if(!Zg(e))throw new Error(P.COMPNT_NON_PARTITIONABLE);switch(e.type){case k.Line:return function(t,e,i,s){let n,r,a=vg(e,t),o=s.getFieldSummary(i).unique.map((t=>new Hg(s).cross(i,t))),h={},l=0;for(let t of a){let e=o;t.dataScope&&(e=o.map((e=>e.merge(t.dataScope))),e=e.filter((t=>!t.isEmpty()))),e.length>l&&(l=e.length),h[t.id]=e}for(let i of a){let s=t.collection();null==r&&(r=s.id),s.classId=r,s.dataScope=i.dataScope;let a=i.parent;a.addChild(s);let o=h[i.id],c=i.vertices[0].x,u=i.vertices[0].y,d=i.vertices[1].x,f=i.vertices[1].y;for(let t=0;t<o.length;t++){let n=i.duplicate();n.classId=e.id,n.vertices[0].x=c+(d-c)*t/l,n.vertices[0].y=u+(f-u)*t/l,n.vertices[1].x=c+(d-c)*(t+1)/l,n.vertices[1].y=u+(f-u)*(t+1)/l,n.dataScope=o[t],s.addChild(n)}a.removeChild(i),i==e&&(n=s)}return n}(t,e,a,n);case k.Path:return function(t,e,i,s){let n,r,a=vg(e,t),o=s.getFieldSummary(i).unique.map((t=>new Hg(s).cross(i,t))),h={},l=0;for(let t of a){let e=o;t.dataScope&&(e=o.map((e=>e.merge(t.dataScope))),e=e.filter((t=>!t.isEmpty()))),e.length>l&&(l=e.length),h[t.id]=e}for(let i of a){let s=t.collection();null==r&&(r=s.id),s.classId=r,s.dataScope=i.dataScope;let a=i.parent;a.addChild(s);let o=h[i.id],c=i.bounds.left,u=i.bounds.top,d=i.bounds.right,f=i.bounds.bottom;for(let i=0;i<o.length;i++){let n=t.mark("line",{x1:c+(d-c)*i/l,x2:c+(d-c)*(i+1)/l,y1:u+(f-u)*i/l,y2:u+(f-u)*(i+1)/l});n.classId=e.id,n.dataScope=o[i],s.addChild(n)}a.removeChild(i),i==e&&(n=s)}let c=e.firstVertex.dataScope.fields[0];return t.densify(n.firstChild,s,{field:c}),n}(t,e,a,n);case k.Circle:return function(t,e,i,s,n){let r,a,o=i||y.Angular,h=vg(e,t);if(o==y.Angular)h.forEach((i=>{let o=i.dataScope?i.dataScope:new Hg(n),h=n.getFieldSummary(s).unique.map((t=>o.cross(s,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,c=t.collection();c.dataScope=o,null==a&&(a=c.id),c.classId=a;let u=i.parent,d=360/l,f=90;for(let s=0;s<l;s++){let n=t.mark("pie",{innerRadius:0,outerRadius:i.radius,x:i.x,y:i.y,startAngle:Q(f-d*(s+1)),endAngle:Q(f-d*s),strokeColor:i.strokeColor,fillColor:i.styles.fillColor});n.dataScope=h[s],n.classId=e.id,c.addChild(n)}c.layout=new tt({orientation:y.Angular,direction:v.Clockwise}),u.removeChild(i),u.addChild(c),i==e&&(r=c)}));else{if(o!=y.Radial)throw P.UNKNOWN_Orientation+": "+o;h.forEach((i=>{let o=i.dataScope?i.dataScope:new Hg(n),h=n.getFieldSummary(s).unique.map((t=>o.cross(s,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,c=t.collection();c.dataScope=o,null==a&&(a=c.id),c.classId=a;let u=i.parent,d=i.radius/l;for(let s=0;s<l;s++){let n=t.mark("ring",{x:i.x,y:i.y,innerRadius:s*d,outerRadius:(s+1)*d,strokeColor:i.strokeColor,fillColor:i.styles.fillColor});n.dataScope=h[s],n.classId=e.id,c.addChild(n)}u.removeChild(i),u.addChild(c),i==e&&(r=c)}))}return r}(t,e,i,a,n);case k.Rect:return function(t,e,i,s,n){let r,a=vg(e,t),o=i||y.Horizontal;if(o!=y.Horizontal&&o!=y.Vertical)throw P.UNKNOWN_Orientation+": "+o;let h,l=n.getFieldSummary(s).unique.map((t=>new Hg(n).cross(s,t))),c={},u=0;for(let t of a){let e=l;t.dataScope&&(e=l.map((e=>e.merge(t.dataScope))),e=e.filter((t=>!t.isEmpty()))),e.length>u&&(u=e.length),c[t.id]=e}for(let i of a){let s=t.collection();null==h&&(h=s.id),s.classId=h,s.dataScope=i.dataScope?i.dataScope:new Hg(n);let a=i.parent;a.addChild(s);let l=c[i.id],u=i.bounds,d=u.left,f=u.top,p=o==y.Horizontal?u.width/l.length:u.width,g=o==y.Horizontal?u.height:u.height/l.length;for(let t=0;t<l.length;t++){let n=i.duplicate();n.classId=e.id,n.resize(p,g),n.dataScope=l[t],s.addChild(n)}s.layout=new tt({orientation:o,left:d,top:f}),a.removeChild(i),i==e&&(r=s)}return t._reapplySizeBindings(r),r}(t,e,i,a,n);case k.Area:return function(t,e,i,s,n){let r,a=vg(e,t),o=a[0];if(4==o.vertices.length&&i==y.Horizontal&&o.vertices[0].x!==o.vertices[1].x)for(let t of a){let e=t.vertices[1];t.vertices[1]=t.vertices[3],t.vertices[3]=e}let h,l=n.getFieldSummary(s).unique.map((t=>new Hg(n).cross(s,t)));for(let s of a){let a=t.collection();null==h&&(h=a.id),a.classId=h,a.dataScope=s.dataScope?s.dataScope:new Hg(n);let o=s.parent;o.addChild(a);let c=s.left,u=s.top,d=i==y.Horizontal?s.width/l.length:s.width,f=i==y.Horizontal?s.height:s.height/l.length;for(let t=0;t<l.length;t++){let t=s.duplicate();t.classId=e.id,t.resizeArea(d,f),a.addChild(t)}o.removeChild(s);for(let t=0;t<a.children.length;t++){let e=a.children[t];e.dataScope?e.dataScope=e.dataScope.merge(l[t]):e.dataScope=l[t];for(let t of e.vertices)t.dataScope?t.dataScope=e.dataScope.merge(t.dataScope):t.dataScope=e.dataScope}a.layout=new tt({orientation:i,left:c,top:u}),s==e&&(r=a)}return t._reapplySizeBindings(r),r}(t,e,i,a,n);case k.Ring:return function(t,e,i,s,n){let r,a,o=i||y.Angular,h=vg(e,t);if(o==y.Angular)return h.forEach((i=>{let o=i.dataScope?i.dataScope:new Hg(n),h=n.getFieldSummary(s).unique.map((t=>o.cross(s,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,c=t.collection();c.dataScope=o,null==a&&(a=c.id),c.classId=a;let u=i.parent,d=360/l,f=90;for(let s=0;s<l;s++){let n=t.mark("arc",{innerRadius:i.innerRadius,outerRadius:i.outerRadius,x:i.x,y:i.y,startAngle:Q(f-d*(s+1)),endAngle:Q(f-d*s),strokeColor:i.strokeColor,fillColor:i.fillColor,strokeWidth:i.strokeWidth,opacity:i.opacity});n.dataScope=h[s],n.classId=e.id,c.addChild(n)}c.layout=new tt({direction:v.Clockwise,orientation:y.Angular}),u.removeChild(i),u.addChild(c),i==e&&(r=c)})),r;throw P.UNKNOWN_Orientation+": "+o}(t,e,i,a,n);case k.Pie:case k.Arc:return function(t,e,i,s,n){let r,a,o=i||y.Radial,h=vg(e,t);if(o==y.Radial)return h.forEach((i=>{let o=i.dataScope?i.dataScope:new Hg(n),h=n.getFieldSummary(s).unique.map((t=>o.cross(s,t)));h=h.filter((t=>!t.isEmpty()));let l=h.length,c=t.collection();c.dataScope=o,null==a&&(a=c.id),c.classId=a;let u=i.parent;for(let s=0;s<l;s++){let n=t.mark("arc",{innerRadius:s*i.outerRadius/l,outerRadius:(s+1)*i.outerRadius/l,x:i.x,y:i.y,startAngle:i.startAngle,endAngle:i.endAngle,strokeColor:i.strokeColor,fillColor:i.fillColor,strokeWidth:i.strokeWidth,opacity:i.opacity});n.dataScope=h[s],n.classId=e.id,c.addChild(n)}c.layout=new tt({orientation:y.Radial}),u.removeChild(i),u.addChild(c),i==e&&(r=c)})),r;throw P.UNKNOWN_Orientation+": "+o}(t,e,i,a,n)}}function Qg(t){if([k.Line,k.Circle,k.Rect,k.Area].indexOf(t.type)<0)return!1;if(t.dataScope){let e=vg(t,t.getScene());for(let t of e)if(t.dataScope.numTuples>1)return!0;return!1}return!0}function t_(t,e,i,s,n,r,a,o){let h=r?n.transformField(s,r):s,l=n.getFieldType(h);if(l!=S.String&&l!=S.Date&&l!=S.Number)throw new Error(P.DENSIFY_BY_NONCAT+": "+h+" is "+l);if(!Qg(e))throw new Error(P.COMPNT_NON_DENSIFIABLE);switch(e.type){case k.Line:return function(t,e,i,s){let n,r=vg(e,t);for(let a of r){let r=a.dataScope?a.dataScope:new Hg(s),o=s.getFieldSummary(i).unique.map((t=>r.cross(i,t)));o=o.filter((t=>!t.isEmpty())),1===o.length&&o.push(o[0].clone());let h=Object.assign({},a.styles);for(let t of Y.styles)a[t]&&(h[t]=a[t]);let l=a.vertices[0].x,c=a.vertices[0].y,u=[],d=a.vertices[1].x-l,f=a.vertices[1].y-c;for(let t=0;t<o.length;t++)u.push([l+t*d/(o.length-1),c+t*f/(o.length-1)]);h.vertices=u;let p=t.mark("path",h);p.classId=e.id,p.dataScope=r;let g=a.parent;g.addChild(p),g.removeChild(a);for(let[t,e]of p.vertices.entries())e.dataScope?e.dataScope=e.dataScope.merge(o[t]):e.dataScope=o[t];a==e&&(n=p)}return n}(t,e,h,n);case k.Circle:return function(t,e,i,s,n,r){let a,o=vg(e,t);return o.forEach((o=>{let h=o.dataScope?o.dataScope:new Hg(s),l=s.getFieldSummary(i).unique.map((t=>h.cross(i,t)));l=l.filter((t=>!t.isEmpty()));let c=l.length;if(c<3)throw Error(P.INSUFFICIENT_DATA_SCOPES);let u=360/c,d=[],f=[],p="clockwise"==r?-1:1;for(let t=0;t<l.length;t++){let e=n+p*t*u;f[t]=e;let i=Gg(o.x,o.y,o.radius,f[t]);d.push(i)}let g=t.mark("polygon",{x:o.x,y:o.y,radius:o.radius,vertices:d});g.dataScope=h,g.styles=Object.assign({},o.styles);for(let t of Y.styles)o[t]&&(g[t]=o[t]);let _=o.parent;_.addChild(g),_.removeChild(o);for(let[t,e]of g.vertices.entries())e.polarAngle=f[t],e.dataScope?e.dataScope=e.dataScope.merge(l[t]):e.dataScope=l[t];o==e&&(a=g)})),a}(t,e,h,n,a,o);case k.Rect:case k.Area:return function(t,e,i,s,n){let r,a=vg(e,t);for(let o of a){let a=n.getFieldType(s),h=o.dataScope?o.dataScope:new Hg(n),l=n.getFieldSummary(s).unique.map((t=>h.cross(s,t)));l=a==S.Number?l:l.filter((t=>!t.isEmpty())),1===l.length&&l.push(l[0].clone()),a!=S.Number&&a!=S.Date||l.sort(((t,e)=>t._field2value[s]>e._field2value[s]?1:-1));let c=Object.assign({},o.styles),u=o.vertices[0].x,d=o.vertices[0].y,f=o.vertices[o.vertices.length-2].x,p=o.vertices[o.vertices.length-2].y,g=[],_=f-u,m=p-d;for(let t=0;t<l.length;t++)g.push(i==y.Vertical?[f,d+(l.length-1-t)*m/(l.length-1)]:[u+t*_/(l.length-1),d]);for(let t=0;t<l.length;t++)g.push(i==y.Vertical?[u,d+t*m/(l.length-1)]:[u+(l.length-1-t)*_/(l.length-1),p]);c.vertices=g;let v=t.mark("area",c);v.classId="area"==o.type?o.classId:"area"+o.classId.substring(9),v.dataScope=h,v.orientation=i,v.baseline=i===y.Horizontal?b.Bottom:b.Left;let x=o.parent;x.addChild(v),x.removeChild(o);for(let[t,e]of v.vertices.entries())t>=l.length?e.dataScope=h.merge(l[2*l.length-1-t]):e.dataScope=h.merge(l[t]);o==e&&(r=v)}return r}(t,e,i,h,n)}}class e_ extends q{constructor(t){super(t)}get width(){return this.vertices[1].x-this.vertices[0].x}get height(){return this.vertices[2].y-this.vertices[1].y}set height(t){this.resize(this.width,t)}set width(t){this.resize(t,this.height)}get left(){return this.vertices[0].x}get top(){return this.vertices[0].y}get right(){return this.vertices[1].x}get bottom(){return this.vertices[2].y}get area(){return this.width*this.height}resize(t,e,i,s){"right"===i?(this.vertices[0].x=this.vertices[1].x-t,this.vertices[3].x=this.vertices[0].x):(this.vertices[1].x=this.vertices[0].x+t,this.vertices[2].x=this.vertices[1].x),"top"===s?(this.vertices[3].y=this.vertices[0].y+e,this.vertices[2].y=this.vertices[3].y):(this.vertices[0].y=this.vertices[3].y-e,this.vertices[1].y=this.vertices[0].y),this._updateBounds()}get leftSegment(){return this.segments[3]}get rightSegment(){return this.segments[1]}get topSegment(){return this.segments[0]}get bottomSegment(){return this.segments[2]}}class i_ extends q{constructor(t){super(t),this.attrs.x="x"in t?t.x:0,this.attrs.y="y"in t?t.y:0,this.attrs.radius="radius"in t?t.radius:100}get radius(){return this.attrs.radius}get x(){return this.attrs.x}get y(){return this.attrs.y}get area(){return Math.PI*Math.pow(this.radius,2)}set x(t){this.attrs.x=t,this._updateBounds()}set y(t){this.attrs.y=t,this._updateBounds()}set radius(t){this.attrs.radius=t,this._updateBounds()}set area(t){this.attrs.radius=Math.sqrt(t),this._updateBounds()}resize(t,e,i,s){let n=Math.min(t,e)/2,r=n-this.attrs.radius;this.attrs.radius=n,"right"==i?this.attrs.x-=r:this.attrs.x+=r,"top"==s?this.attrs.y+=r:this.attrs.y-=r,this._updateBounds()}_doTranslate(t,e){this.attrs.x+=t,this.attrs.y+=e,this._updateBounds()}_updateBounds(){this._bounds=new n(this.attrs.x-this.attrs.radius,this.attrs.y-this.attrs.radius,2*this.attrs.radius,2*this.attrs.radius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t.attrs.x=this.attrs.x,t.attrs.y=this.attrs.y,t.attrs.radius=this.attrs.radius}getSVGPathData(){return["M",this.x,this.y,"m",-this.radius,", 0 a",this.radius,",",this.radius,"0 1,0",2*this.radius,",0 a",this.radius,",",this.radius,"0 1,0",-2*this.radius,",0"].join(" ")}}class s_ extends z{constructor(t){super(t),this.type=k.PointText,this.attrs.x=0,this.attrs.y=0,"fontSize"in this.styles||(this.styles.fontSize="12px"),"fontFamily"in this.styles||(this.styles.fontFamily="Arial, sans-serif"),"fontWeight"in this.styles||(this.styles.fontWeight="normal"),"fillColor"in this.styles||(this.styles.fillColor="black"),void 0!==t&&("x"in t&&(this.attrs.x=t.x),"y"in t&&(this.attrs.y=t.y),this.attrs.text="text"in t?t.text:"",this.attrs.anchor="anchor"in t?t.anchor:["center","middle"]),this._updateBounds()}copyPropertiesTo(t){t.styles=Object.assign({},this.styles),this._dataScope&&(t._dataScope=this._dataScope.clone()),t.x=this.attrs.x,t.y=this.attrs.y,t.text=this.text,t.anchor=[this.anchor[0],this.anchor[1]]}get bounds(){return this._bounds||this._updateBounds(),this._bounds}get refBounds(){return this.bounds}set text(t){this.attrs.text=t,this._updateBounds()}get text(){return this.attrs.text}_doTranslate(t,e){this.attrs.x+=t,this.attrs.y+=e,this._updateBounds()}_updateBounds(){let t,e,i=function(t,e,i){let s=jg.getContext();s.font=e;let n=s.measureText(t);return n.fontBoundingBoxAscent?{width:n.width,height:n.fontBoundingBoxAscent+n.fontBoundingBoxDescent}:n.actualBoundingBoxAscent?{width:n.width,height:n.actualBoundingBoxAscent+n.actualBoundingBoxDescent}:{width:n.width,height:i}}(this.attrs.text,[this.fontWeight,this.styles.fontSize,this.fontFamily].join(" "),parseFloat(this.fontSize)),s=i.width,r=i.height;switch(this.attrs.anchor[0]){case"left":default:t=this.attrs.x;break;case"right":t=this.attrs.x-s;break;case"center":t=this.attrs.x-s/2}switch(this.attrs.anchor[1]){case"top":e=this.attrs.y;break;case"bottom":e=this.attrs.y-r;break;case"middle":e=this.attrs.y-r/2}this._bounds=new n(t,e,s,r)}get center(){return{x:this.bounds.left+this.bounds.width/2,y:this.bounds.top+this.bounds.height/2}}get x(){return this.attrs.x}set x(t){this.attrs.x=t,this._updateBounds()}get y(){return this.attrs.y}set y(t){this.attrs.y=t,this._updateBounds()}get anchor(){return this.attrs.anchor}set anchor(t){this.attrs.anchor=t,this._updateBounds()}get horzAnchor(){return this.attrs.anchor[0]}get vertAnchor(){return this.attrs.anchor[1]}set horzAnchor(t){this.attrs.anchor[0]=t,this._updateBounds()}set vertAnchor(t){this.attrs.anchor[1]=t,this._updateBounds()}get fontSize(){return parseFloat(this.styles.fontSize)}set fontSize(t){this.styles.fontSize="number"==typeof t?t+"px":t,this._updateBounds()}get fontWeight(){return this.styles.fontWeight}set fontWeight(t){this.styles.fontWeight=t,this._updateBounds()}get fontFamily(){return this.styles.fontFamily}set fontFamily(t){this.styles.fontFamily=t,this._updateBounds()}get fillColor(){return this.styles.fillColor}set fillColor(t){this.styles.fillColor=t}}class n_ extends Jg{constructor(t){super(),this.type=k.Axis,this.id=this.type+Fg[this.type]++,this._strokeColor="strokeColor"in t?t.strokeColor:"#555",this._textColor="textColor"in t?t.textColor:"#555",this._fontSize="fontSize"in t?t.fontSize:"12px",this._tickOffset="tickOffset"in t?t.tickOffset:0,this._tickSize="tickSize"in t?t.tickSize:5,this._tickAnchor=t.tickAnchor?t.tickAnchor:"middle",this._tickVisible=!("tickVisible"in t)||t.tickVisible,this._pathVisible=!("pathVisible"in t)||t.pathVisible,this._labelOffset="labelOffset"in t?t.labelOffset:15,this._labelFormat="labelFormat"in t?t.labelFormat:"",this._titleOffset="titleOffset"in t?t.titleOffset:40,"titleAnchor"in t?this._titleAnchor=t.titleAnchor:"x"==this.channel||"width"==this.channel?this._titleAnchor="top"==this._orientation?["center","bottom"]:["center","top"]:this._titleAnchor="left"==this._orientation?["right","middle"]:["left","middle"],this._rotateYTitle=!("rotateTitle"in t&&!t.rotateTitle),this._titlePosition=t.titlePosition,this._labelRotation="labelRotation"in t?t.labelRotation:0}toJSON(){let t=super.toJSON();return t.type=this.type,t.id=this.id,t.field=this._field,t.channel=this._channel,"args"in t||(t.args={}),t.args.orientation=this._orientation,t.args.strokeColor=this._strokeColor,t.args.textColor=this._textColor,t.args.tickOffset=this._tickOffset,t.args.tickSize=this._tickSize,t.args.tickAnchor=this._tickAnchor,t.args.tickVisible=this._tickVisible,t.args.pathVisible=this._pathVisible,t.args.labelOffset=this._labelOffset,t.args.labelFormat=this._labelFormat,this._labelRotation&&(t.args.labelRotation=this._labelRotation),t.args.showTitle=this._showTitle,t.args.tickValues=this._tickValues,t.args.titleAnchor=this._titleAnchor,t.args.titleOffset=this._titleOffset,t.args.titlePosition=this._titlePosition,t.args.rotateTitle=this._rotateYTitle,t}get field(){return this._field}get channel(){return this._channel}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this.reposition()}get pathX(){if("y"==this.channel||"height"==this.channel){if(void 0!==this._position)return this._position;if(this._path)return this._path.vertices[0].x;if(this._rules&&this._rules.firstChild)return this._rules.firstChild.vertices[0].x}}set pathX(t){"y"!=this.channel&&"height"!=this.channel||(this._posArg=t),this.reposition()}get pathPosition(){return"x"==this.channel||"width"==this.channel?this.pathY:this.pathX}set pathPosition(t){"x"==this.channel||"width"==this.channel?this.pathY=t:"y"!=this.channel&&"height"!=this.channel||(this.pathX=t)}get pathY(){if("x"==this.channel||"width"==this.channel){if(void 0!==this._position)return this._position;if(this._path)return this._path.vertices[0].y;if(this._rules&&this._rules.firstChild)return this._rules.firstChild.vertices[0].y}}set pathY(t){"x"!=this.channel&&"width"!=this.channel||(this._posArg=t),this.reposition()}get tickOffset(){return this._tickOffset}set tickOffset(t){this._tickOffset=t,this._positionTicks()}get titleOffset(){return this._titleOffset}set titleOffset(t){this._titleOffset=t}get tickSize(){return this._tickSize}set tickSize(t){this._tickSize=t,this._positionTicks()}set tickValues(t){this._tickValues=t,this._generateTicks(),this._positionTicks()}get tickValues(){return this._tickValues}set labelValues(t){this._labelValues=t,this._generateLabels(),this._positionLabels()}get labelValues(){return this._labelValues}get tickAnchor(){return this._tickAnchor}set tickAnchor(t){this._tickAnchor=t}get tickVisible(){return this._tickVisible}set tickVisible(t){this._tickVisible=t;for(let e of this._ticks.children)e.visibility=t?"visible":"hidden"}get pathVisible(){return this._pathVisible}set pathVisible(t){this._pathVisible=t;let e=[];this._path&&e.push(this._path),this._rules&&this._rules.children.forEach((t=>e.push(t)));for(let i of e)i.visibility=t?"visible":"hidden"}get labelOffset(){return this._labelOffset}set labelOffset(t){this._labelOffset=t,this._positionLabels()}get labelFormat(){return this._labelFormat}set labelFormat(t){this._labelFormat=t,this._generateLabels(),this._positionLabels()}get labelRotation(){return this._labelRotation}set labelRotation(t){if(this._labelRotation=t,this._labels&&this._labels.children){let e="bottom"==this._orientation?["center","top"]:["center","bottom"];if(t)for(let t of this._labels.children)t._rotate=[this._labelRotation,t.x,t.y],t.anchor=["right",e[1]];else for(let t of this._labels.children)t._rotate=void 0}}get showTitle(){return this._showTitle}set showTitle(t){this._showTitle=t,this._title||(this._generateTitle(),this._positionTitle()),this._title.visibility=t?"visible":"hidden"}get titleAnchor(){return this._titleAnchor}set titleAnchor(t){this._titleAnchor=t}get titlePosition(){return this._titlePosition}set titlePosition(t){this._titlePosition=t}get rotateTitle(){return this._rotateYTitle}set rotateTitle(t){this._rotateYTitle=t}get title(){return this._titleText}set title(t){this._titleText=t}get includeZero(){return!!this.encoding&&this.encoding.scale.includeZero}set includeZero(t){this.encoding&&(this.encoding.scale.includeZero=t)}_generatePath(){}_generateTicks(){}_generateLabels(){}_generateTitle(){this._title=new s_({text:this._titleText,fillColor:this._textColor,fontWeight:"bold"}),this._title.id=this.id+"-title",this.addChild(this._title)}_positionPath(){}_positionTicks(){}_positionLabels(){}_positionTitle(){}matches(t){}reposition(){this.encoding&&this._determineAxisFlip(),this._positionPath(),this._positionTicks(),this._positionLabels(),this._showTitle&&this._positionTitle(),"radialDistance"===this._channel&&this._rotate&&(this._rotate=[this._rotate[0],this._item.parent.x,this._item.parent.y]),this._updateBounds()}}class r_ extends n_{constructor(t,e,i,s,n){super(n),this._channel=i,this._orientation="orientation"in n?n.orientation:"x"===this._channel||"width"==this._channel?"bottom":"left",this._posArg="x"==this._channel||"width"==this._channel?n.pathY:n.pathX,this._padding=[k.Line,k.Path].indexOf(t[0].type)>=0?10:0,this._item=t[0],this._items=t,this._mlayout=e,this._field=s,this._titleText="title"in n?n.title:this._field,this._showTitle="showTitle"in n&&n.showTitle,this._ticks=new Jg,this._ticks.id=this.id+"ticks",this.addChild(this._ticks),this._labels=new Jg,this._labels.id=this.id+"labels",this.addChild(this._labels),this._rules=new Jg,this._rules.id=this.id+"paths",this.addChild(this._rules),this._generatePath(),this._generateTicks(),this._generateLabels(),this._showTitle&&this._generateTitle(),this._positionPath(),this._positionTicks(),this._positionLabels(),this._showTitle&&this._positionTitle()}toJSON(){let t=super.toJSON();return t.args.item=this._item.id,"x"==this._channel||"width"==this._channel?t.args.pathY=this._posArg:t.args.pathX=this._posArg,this.classId&&(t.classId=this.classId),t}set strokeColor(t){this._strokeColor=t;for(let e of this._ticks.children)e.strokeColor=t;for(let e of this._rules.children)e.strokeColor=t}get strokeColor(){return this._strokeColor}set textColor(t){this._textColor=t;for(let e of this._labels.children)e.fillColor=t;this._title&&(this._title.fillColor=t)}get textColor(){return this._textColor}_updateBounds(){this._bounds=this._rules.bounds.clone(),this._bounds=this._bounds.union(this._ticks.bounds),this._bounds=this._bounds.union(this._labels.bounds),this._showTitle&&(this._bounds=this._bounds.union(this._title.bounds))}_generatePath(){if(this._rules.removeAll(),this._mlayout.type==m.Grid){let t="x"==this._channel?this._mlayout.numRows:this._mlayout.numCols;for(let e=0;e<t;e++){let t=new q({strokeColor:this._strokeColor});this._pathVisible||(t.visibility="hidden"),t.type=k.Line,t.id=this.id+"rule"+e,this._rules.addChild(t)}}else if(this._mlayout.type===m.Stack){let t=new q({strokeColor:this._strokeColor});this._pathVisible||(t.visibility="hidden"),t.type=k.Line,t.id=this.id+"rule",this._rules.addChild(t)}}_generateTicks(){this._ticks.removeAll();for(let t=0;t<this._mlayout.group.children.length;t++){let e=new q({strokeColor:this._strokeColor});this._tickVisible||(e.visibility="hidden"),e.type=k.Line,e.id=this.id+"tick"+t,this._ticks.addChild(e)}}_generateLabels(){let t;switch(this._labels.removeAll(),this._item.dataScope.getFieldType(this._field)){case S.Date:t=s.timeFormat(this._labelFormat);break;case S.String:t=function(t){return t};break;default:t=s.format(this._labelFormat)}let e=this._mlayout.cellBounds;for(let i=0;i<e.length&&!(i>=this._mlayout.group.children.length);i++){let e=this._mlayout.group.children[i],s=new s_({fillColor:this._textColor,fontSize:this._fontSize,text:t(e.dataScope.getFieldValue(this._field))});s.id=this.id+"label"+i,this._labels.addChild(s)}}_positionPath(){if(this._mlayout.type==m.Grid){let t=this._mlayout.cellBounds,e="x"==this._channel?this._mlayout.numRows:this._mlayout.numCols;if("x"==this._channel){let i=t[0].left,s=this._mlayout.numCols,n="bottom"===this._orientation?this._padding:-this._padding;for(let r=0;r<e;r++)this._rules.children[r]._setVertices([[i,this._posArg?t[r*s][this._orientation]+this._posArg-t[0][this._orientation]:t[r*s][this._orientation]+n],[i+t[0].width*s+this._mlayout.colGap*(s-1),this._posArg?t[r*s][this._orientation]+this._posArg-t[0][this._orientation]:t[r*s][this._orientation]+n]])}else{let i=t[0].top,s=this._mlayout.numRows,n="left"===this._orientation?this._padding:-this._padding;for(let r=0;r<e;r++)this._rules.children[r]._setVertices([[this._posArg?t[r*s][this._orientation]+this._posArg-t[0][this._orientation]:this._mlayout.group.bounds[this._orientation]-n,i],[this._posArg?t[r*s][this._orientation]+this._posArg-t[0][this._orientation]:this._mlayout.group.bounds[this._orientation]-n,i+t[0].height*s+this._mlayout.rowGap*(s-1)]])}}else if(this._mlayout.type===m.Stack){let t=this._mlayout.group.bounds;"x"==this._channel?this._rules.children[0]._setVertices([[t.left,this._posArg?this._posArg:t[this._orientation]],[t.right,this._posArg?this._posArg:t[this._orientation]]]):this._rules.children[0]._setVertices([[this._posArg?this._posArg:t[this._orientation],t.top],[this._posArg?this._posArg:t[this._orientation],t.bottom]])}this._rules.children.forEach((t=>t._updateBounds())),this._rules._updateBounds(),this._updateBounds()}_positionTicks(){let t=this._mlayout.cellBounds;if("x"==this._channel){let e="bottom"==this._orientation?1:-1,i="bottom"===this._orientation?this._padding:-this._padding;for(let[s,n]of this._ticks.children.entries()){let r=this._posArg?t[s][this._orientation]+this._posArg-t[0][this._orientation]+this._tickOffset*e:t[s][this._orientation]+this._tickOffset*e+i;n._setVertices([[t[s].x,r],[t[s].x,r+e*this._tickSize]]),n._updateBounds()}}else if("y"==this._channel){let e="left"==this._orientation?-1:1,i="left"===this._orientation?this._padding:-this._padding;for(let[s,n]of this._ticks.children.entries()){let r=this._posArg?t[s][this._orientation]+this._posArg-t[0][this._orientation]+this._tickOffset*e:this._mlayout.group.bounds[this._orientation]+this._tickOffset*e-i,a="middle"==this._tickAnchor?t[s].y:t[s][this._tickAnchor];n._setVertices([[r,a],[r+e*this._tickSize,a]]),n._updateBounds()}}this._ticks._updateBounds(),this._updateBounds()}_positionLabels(){let t=this._mlayout.cellBounds;if("x"==this._channel){let e="bottom"==this._orientation?["center","top"]:["center","bottom"],i="bottom"==this._orientation?this._labelOffset:-this._labelOffset,s="bottom"===this._orientation?this._padding:-this._padding;for(let[n,r]of this._labels.children.entries())r.x=t[n].x,r.y=this._posArg?t[n][this._orientation]+this._posArg-t[0][this._orientation]+i:t[n][this._orientation]+i+s,r.anchor=e,this._labelRotation&&(r._rotate=[this._labelRotation,r.x,r.y],r.anchor=["right",e[1]])}else if("y"==this._channel){let e="left"==this._orientation?["right","middle"]:["left","middle"],i="left"==this._orientation?-this._labelOffset:this._labelOffset,s="left"===this._orientation?this._padding:-this._padding;for(let[n,r]of this._labels.children.entries())r.x=this._posArg?t[n][this._orientation]+this._posArg-t[0][this._orientation]+i:this._mlayout.group.bounds[this._orientation]+i-s,r.y="middle"==this._tickAnchor?t[n].y:t[n][this._tickAnchor],r.anchor=e,this._labelRotation&&(r._rotate=[this._labelRotation,r.x,r.y])}this._labels._updateBounds(),this._updateBounds()}_positionTitle(){let t=this._rules.bounds;this._title.achor=this._titleAnchor,this._titlePosition?(this._title.x=this._titlePosition[0],this._title.y=this._titlePosition[1],"y"!=this._channel&&"height"!=this._channel||this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])):"x"==this._channel?(this._title.x=t.x,this._titleOffset=this._labels.bounds.height+this._labelOffset+15,this._title.y="top"==this._orientation?t.top-this._titleOffset:t.bottom+this._titleOffset):(this._titleOffset=this._labels.bounds.width+this._labelOffset+15,this._title.x="left"==this._orientation?t.left-this._titleOffset:t.right+this._titleOffset,this._title.y=t.y,this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])),this._title._updateBounds(),this._updateBounds()}matches(t){return Eg(this._item,t)}}const a_=function(t,e,i){let s=t.getScene();Rg(t)||s._reapplyConstraints(t),s.getRelatedAxes(t).forEach((t=>{t.encoding&&void 0!==t.encoding.scale.offset&&(t.encoding.scale.offset+="x"===t.channel||"width"===t.channel?e:i),0===i||"x"!==t.channel&&"width"!==t.channel||void 0===t._posArg||(t._posArg=t._posArg+i),0===e||"y"!==t.channel&&"height"!==t.channel||void 0===t._posArg||(t._posArg=t._posArg+e),t.reposition()})),s.getRelatedGridlines(t).forEach((t=>t.updateLinePositions()))},o_=function(t,e,i){let s=t.getScene();s._relayoutAncestors(t,e);let n=[t],r=t.firstChild;for(;r;)n.push(r),r=r.firstChild;for(let t of n)t.getScene()._reapplyConstraints(t);let a=!1;for(let t of i)if(["numRows","numCols","layout","childrenOrder"].indexOf(t)>=0){a=!0;break}let o,h=!1;if(t.layout&&(t.layout.type!==m.Grid||1!==t.layout.numRows&&1!==t.layout.numCols?t.layout.type===m.Stack&&i.indexOf("orientation")>=0&&(h=!0,o=t.layout.orientation===y.Horizontal?"x":"y"):(h=!0,o=1===t.layout.numRows?"x":"y")),h){let e=s.getRelatedAxes(t).filter((e=>e instanceof r_&&e._item.parent.classId===t.classId));for(let i of e){s.removeItem(i);let e=i.toJSON().args;delete e.orientation,e.item=t.firstChild,s.axis(o,i.field,e)}}if(a)s.reCreateRelatedAxes(t);else{s.getRelatedAxes(t).forEach((t=>t.reposition()))}s.getRelatedGridlines(t).forEach((t=>t.updateLinePositions()))},h_=function(t){for(let e of t.encodings)e._map(),e._apply();for(let e of t.encodings)e.scene._updateAncestorBounds(e.item,e.items);let e=t.encodings.map((t=>t.anyItem)),i={};for(let t of e)"vertex"===t.type||"segment"===t.type?i[t.parent.classId]=t.parent:i[t.classId]=t;for(let t of Object.values(i))t.getScene()._reapplyConstraints(t);for(let e of t.encodings){let i=e.anyItem,s=e.scene.getRelatedAxes(i);for(let i of s)i.encoding&&i.encoding.scale===t&&(i.tickValues=e._inferTickValues(e),i.labelValues=e._inferTickValues(e),i._positionPath(),i._showTitle&&i._positionTitle(),"radialDistance"===i._channel&&i._rotate&&(i._rotate=[i._rotate[0],i._item.parent.x,i._item.parent.y]),i._updateBounds());e.scene.getRelatedGridlines(i).forEach((t=>t.updateLinePositions()))}},l_=function(t){for(let e of t.encodings)e._apply();for(let e of t.encodings)e.scene._relayoutAncestors(e.item,e.items);let e=t.encodings.map((t=>t.anyItem)),i={};for(let t of e)"vertex"===t.type||"segment"===t.type?i[t.parent.classId]=t.parent:i[t.classId]=t;for(let t of Object.values(i))t.getScene()._reapplyConstraints(t);for(let e of t.encodings){let t=e.anyItem;e.scene.getRelatedAxes(t).forEach((t=>t.reposition())),e.scene.getRelatedGridlines(t).forEach((t=>t.updateLinePositions()))}},c_=function(t,e){let i=t.getScene();i._relayoutAncestors(t,e),i._reapplyConstraints(t),i.getRelatedAxes(t).forEach((t=>t.reposition())),i.getRelatedGridlines(t).forEach((t=>t.updateLinePositions()))},u_=function(t,e){let i=e.getScene(),s=i.getRelatedAxes(t);for(let n of s)n._item.classId===t.classId&&(n._item=e,n._items=vg(e,i));let n=i.encodings[Cg(t)];if(n){i.encodings[Cg(e)]={};for(let s of["x","y"]){const r=n[s];r&&(r.anyItem=e,r.items=vg(e,i),i.encodings[Cg(e)][s]=r,delete i.encodings[Cg(t)][s])}0===Object.keys(n).length&&delete i.encodings[Cg(t)]}},d_=function(t,e){let i=e.getScene(),s=i.encodings[Cg(t)];if(s){i.encodings[Cg(e)]={};for(let n of["x","y"]){const r=s[n];r&&(r.anyItem=e,r.items=vg(e,i),i.encodings[Cg(e)][n]=r,delete i.encodings[Cg(t)][n])}0===Object.keys(s)&&delete i.encodings[Cg(t)]}let n=i.getRelatedAxes(t);for(let s of n)s._item.classId===t.classId&&(s._item=e,s._items=vg(e,i))},f_=function(t){let e=t.getScene(),i=e.encodings[Cg(t)];for(let t in i)i[t]._apply();e.getRelatedAxes(t).forEach((t=>t.reposition())),e.getRelatedGridlines(t).forEach((t=>t.updateLinePositions()))};class p_{constructor(t,e){if(o.indexOf(t)<0)throw new Error(P.UNKOWNN_SCALE_TYPE+": "+t);switch(this._type=t,this._offset=void 0,this.id="scale"+Fg.scale++,this._flipped=!1,this._includeZero=!1,t){case"linear":if(e){let t=Object.keys(e).map((t=>parseFloat(t))).sort(((t,e)=>t-e)),i=t.map((t=>e[t]));this._scale=s.scaleLinear(t,i),"clamp"in e&&this._scale.clamp(e.clamp),this._mapping=e}else this._scale=s.scaleLinear();break;case"point":this._scale=s.scalePoint();break;case"ordinal":this._scale=s.scaleOrdinal();break;case"ordinalColor":this._scale=s.scaleOrdinal(e?e.size?s[e.scheme][e.size]:s[e.scheme]:s.schemeCategory10);break;case"power":this._scale=s.scalePow().exponent(2);break;case"sqrt":this._scale=s.scalePow().exponent(.5);break;case"log":this._scale=s.scaleLog();break;case"identity":case"time":this._scale=s.scaleTime();break;case"sequentialColor":case"divergingColor":e&&"string"==typeof e?(this._scale=s.scaleSequential(s[e]),this._scheme=e):this._scale=s.scaleSequential()}this.encodings=[]}set scheme(t){if(this._type.indexOf("Color")<0&&"linear"!==this._type)return;let e=s.scaleSequential(s[t]),i=this._scale.domain();if(Math.min(...i)*Math.max(...i)<0){let t=Math.max(Math.abs(Math.min(...i)),Math.abs(Math.max(...i)));i=[-t,t]}e.domain(i),this._scheme=t,this._scale=e,"linear"===this._type&&(this._type=this._scale.domain()[0]*this._scale.domain()[1]<0?"divergingColor":"sequentialColor",this._mapping&&(this._mapping=void 0));for(let e of this.encodings)e._mapping&&(e._mapping=void 0),e._scheme=t,e._apply()}get scheme(){return this._scheme}get type(){return this._type}set type(t){let e;switch(t){case"linear":e=s.scaleLinear();break;case"power":e=s.scalePow().exponent(2);break;case"sqrt":e=s.scalePow().exponent(.5);break;case"log":e=s.scaleLog()}if(e){this._type=t,e.domain(this._scale.domain()).range(this._scale.range()),this._scale=e;for(let t of this.encodings)t._apply();for(let t of this.encodings)t.scene._updateAncestorBounds(t.item,t.items)}else console.warn(F+t)}toJSON(){let t={};return t.type=this.type,t.id=this.id,t.offset=this._offset,this._scheme&&(t.scheme=this._scheme),t.domain=this._scale.domain(),t.range=this.range,t.clamp=this.clamp,t.isFlipped=this.isFlipped,t.includeZero=this.includeZero,this._mapping&&(t.mapping=this._mapping),this._baseItem&&(t.baseItem=this._baseItem.id),t}_merge(t){if(this.type!=t.type)throw P.DIFFERENT_SCALE_TYPE;let e,i;switch(this.type){case"linear":case"time":e=[Math.min(this.domain[0],t.domain[0]),Math.max(this.domain[1],t.domain[1])],i=[0,this.map(e[1])-this.map(e[0])];break;case"point":case"ordinalColor":e=[...new Set(this.domain.concat(t.domain))],i=[];break;default:console.log("TODO: merge scale type",this.type)}this._scale.domain(e),this._scale.range(i)}get domain(){if(this._includeZero){return[0,this._scale.domain()[1]]}return this._scale.domain()}set domain(t){this._scale.domain(t);for(let t of this.encodings)t._apply()}get range(){return this._scale.range()}
//to support this, the argument should be in real screen coordinates and need to do internal conversion
set range(t){this._scale.range(t);for(let t of this.encodings)t._apply();for(let t of this.encodings)t.scene._updateAncestorBounds(t.item,t.items)}_setRange(t){this._scale.range(t),l_(this)}get clamp(){return"linear"==this.type&&this._scale.clamp()}set clamp(t){"linear"==this.type&&this._scale.clamp(t)}set rangeExtent(t){let e=this._scale.range();this._setRange([e[0],e[0]+t])}get rangeExtent(){let t=this._scale.range();return Math.abs(t[1]-t[0])}_addEncoding(t){this.encodings.indexOf(t)<0&&this.encodings.push(t)}map(t){let e=this._scale.copy();return e.domain(this.domain),this._flipped?(e.range(this._scale.range().reverse()),e(t)):e(t)}invert(t){return this._scale.invert(t)}get offset(){return this._offset}set offset(t){this._offset=t;for(let t of this.encodings)t._apply()}get isFlipped(){return this._flipped}set isFlipped(t){this._flipped=t}get includeZero(){return this._includeZero}set includeZero(t){this._includeZero=t,h_(this)}get mapping(){return this._mapping}getEncodedChannels(){let t={};for(let e of this.encodings)t[e.channel]=!0;return Object.keys(t)}}function g_(t){return t._query=function(){this.data=[];let t=this.field,e=this.items,i=this.aggregator;switch(this.datatable.getFieldType(t)){case S.Boolean:break;case S.Date:this.data=e.map((e=>e.dataScope.getFieldValue(t)));break;case S.String:break;default:this.data=e.map((e=>e.dataScope.aggregateNumericalField(t,i)))}},t._map=function(){let t,e=this.items,i=this.data,s=this.channel;if(t=new p_(this.scaleType),null==this.data.find((t=>t<0))||"width"!=s&&"height"!=s||0!=e[0].type.indexOf("rect")){let n,r;t.domain=[0,Math.max(...i)],"radius"==s||"outerRadius"==s||"innerRadius"==s?(n=0,r=Math.max(...e.map((t=>t[s]))),r<20&&(r=20)):"area"==s?(n=0,r=Math.max(...e.map((t=>t.bounds.width*t.bounds.height))),r<400&&(r=400)):"fontSize"==s?(n=2,r=Math.max(...e.map((t=>parseFloat(t.styles.fontSize))))):"strokeWidth"==s?(n=1,r=Math.max(...e.map((t=>parseFloat(t.styles.strokeWidth)))),r==n&&(r=n+5)):(n=0,r=Math.max(...e.map((t=>t.bounds[s])))),this.rangeExtent&&(r=n+this.rangeExtent),this.range&&(n=this.range[0],r=this.range[1]),t._setRange([n,r])}else this._rectNegativeValues=!0,t.domain=[Math.min(...i),Math.max(...i)],"width"==s?t._setRange([0,this.rangeExtent?this.rangeExtent:Math.max(...e.map((t=>t.width)))]):t._setRange([0,this.rangeExtent?this.rangeExtent:Math.max(...e.map((t=>t.height)))]);this.scale||(this.scale=t),this.scale._addEncoding(this)},t._apply=function(){if("radius"==this.channel||"outerRadius"==this.channel||"innerRadius"==this.channel){for(let t=0;t<this.items.length;t++){this.items[t][this.channel]=this.scale.map(this.data[t])}this.scene._relayoutAncestors(this.anyItem,this.items)}else if(this._rectNegativeValues){let t=Math.max(...this.data),e=Math.min(...this.data),i="width"===this.channel?Math.min(...this.items.map((t=>t.bounds.left))):Math.min(...this.items.map((t=>t.bounds.top)))+this.scale.rangeExtent,s="width"===this.channel?"right":"top",n="width"===this.channel?"left":"bottom";for(let r=0;r<this.items.length;r++){let a,o=this.items[r];if(o.parent&&o.parent.type===k.Collection){let t=o.parent.parent;if(t.type===k.Collection&&t.layout&&t.layout.type===m.Grid){let e=t.children.indexOf(o.parent);a=t.layout.cellBounds[e][n]}else a=o.parent.refBounds[n]}else a=i;"width"===this.channel?(o.leftSegment._doTranslate(a+this.scale.map(0)-o.leftSegment.vertex1.x,0),o.rightSegment._doTranslate(a+this.scale.map(this.data[r])-o.rightSegment.vertex1.x,0)):(o.topSegment._doTranslate(0,a-this.scale.map(this.data[r])-o.topSegment.vertex1.y),o.bottomSegment._doTranslate(0,a-this.scale.map(0)-o.bottomSegment.vertex1.y)),o._updateBounds(),this.data[r]>0?(o.boundsOffsets[s]=this.scale.map(t)-this.scale.map(this.data[r]),o.boundsOffsets[n]=this.scale.map(0)-this.scale.map(e)):(o.boundsOffsets[n]=this.scale.map(this.data[r])-this.scale.map(e),o.boundsOffsets[s]=this.scale.map(t)-this.scale.map(0))}}else if("area"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=Math.sqrt(this.scale.map(this.data[t]));e.resize(i,i)}this.scene._relayoutAncestors(this.anyItem,this.items)}else if("fontSize"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);e.styles.fontSize=i+"px"}this.scene._relayoutAncestors(this.anyItem,this.items)}else if("strokeWidth"==this.channel){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);e.styles.strokeWidth=i}this.scene._relayoutAncestors(this.anyItem,this.items)}else{let t="left",e="bottom";if(this.anyItem.parent&&this.anyItem.parent.type==k.Glyph){let i=this.anyItem.parent.children;1==Z(i.map((t=>t.bounds.right))).length&&(t="right"),1==Z(i.map((t=>t.bounds.top))).length&&(e="top")}if(this.anyItem.type===k.Collection&&this.anyItem.layout&&this.anyItem.layout[this.channel])for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);e.layout[this.channel]=i}else for(let i=0;i<this.items.length;i++){let s=this.items[i],n=this.scale.map(this.data[i]),r="width"==this.channel?n:s.bounds.width,a="height"==this.channel?n:s.bounds.height;s.resize(r,a,t,e)}this.scene._relayoutAncestors(this.anyItem,this.items)}},t.run(),t}function __(t){return t._query=function(){this.data=[],this.areas=vg(this.items[0],this.scene);let t=this.areas.length;this.areaNum=t,this._vertices=[],this.indicator=[];for(let t of this.areas)for(let e=0;e<t.vertices.length;e++)this._vertices.push(t.vertices[e]),e<t.vertices.length/2?this.indicator.push(1):this.indicator.push(0);let e=this.field,i=this._vertices.map((t=>t.dataScope));switch(this.datatable.getFieldType(e)){case S.Boolean:break;case S.Date:this.data=i.map((t=>t.getFieldValue(e)));break;case S.String:this.data=i.map(((t,i)=>0==this.indicator[i]?0:t.aggregateNumericalField(e,this.aggregator)));break;default:"x"==this.channel||"y"==this.channel?this.data=i.map((t=>t._field2value[e])):this.data=i.map(((t,i)=>0==this.indicator[i]?0:t.aggregateNumericalField(e,this.aggregator)))}},t._map=function(){"fillGradient"===this.channel?this._mapToGradient():"width"!=this.channel&&"height"!=this.channel||this._mapToSize()},t._mapToGradient=function(){if(this.scale){if(!this._mapping){let t=this.scale.domain.concat(this.data);this.scale.domain=[Math.min(...t),Math.max(...t)]}}else if(this._mapping)this.scale=new p_("linear",this._mapping);else{let t,e=Math.min(...this.data),i=Math.max(...this.data),s=Math.max(Math.abs(e),Math.abs(i));e<0&&i>0?(t="interpolatePuOr",e=-s,i=s,this.scale=new p_("divergingColor",this._scheme?this._scheme:t)):(t="interpolateTurbo",this.scale=new p_("sequentialColor",this._scheme?this._scheme:t)),this.scale.domain=[e,i]}this.scale._addEncoding(this)},t._mapToSize=function(){let t,e,i;switch(this.datatable.getFieldType(this.field)){case S.Boolean:break;case S.Date:t=new p_("time"),e=Math.min(...this.data),i=Math.max(...this.data),t.domain=[e,i];break;case S.String:t=new p_("linear"),e=Math.min(...this.data),i=Math.max(...this.data),t.domain=this._includeZero||e<0?[0,i]:[e,i];break;default:t=new p_("linear"),e=Math.min(...this.data),i=Math.max(...this.data),t.domain=e<0?[0,i]:[e,i]}let s,n=Ug(this.areas[0]),r=bg(this.anyItem);if(r){let t=r.cellBounds;s="width"==this.channel||"height"==this.channel?n==y.Vertical?t[0].width:t[0].height:n==y.Vertical?t[0].height:t[0].width}else s="width"==this.channel?Math.max(...this.areas.map((t=>t.bounds.width))):Math.max(...this.areas.map((t=>t.bounds.height)));this.rangeExtent&&(s=this.rangeExtent),e<0?(t._scale.domain([e,i]),t._setRange([0,s])):t._setRange([0,s]),this.scale?this.scale._merge(t):this.scale=t,this.scale._addEncoding(this)},t._apply=function(){"fillGradient"===this.channel?this._applyToGradient():"width"!=this.channel&&"height"!=this.channel||this._applyToSize()},t._applyToGradient=function(){let t=0;for(let e of this.areas){let i=this.data.slice(t,t+e.vertices.length),s=Math.min(...i),n=Math.max(...i),r="horizontal"===e.orientation?new D({x1:0,y1:100,x2:0,y2:0}):new D({x1:0,y1:0,x2:100,y2:0});if(r.addStop(0,this.scale.map(s),1),this._mapping){let t=Object.keys(this._mapping).map((t=>parseFloat(t))).sort();for(let e of t)e>s&&e<n&&r.addStop(100*(e-s)/(n-s),this.scale.map(e),1)}else"divergingColor"===this.scale.type&&r.addStop(100*-s/(n-s),this.scale.map(0),1);r.addStop(100,this.scale.map(n),1),e.fillColor=r,t+=e.vertices.length}},t._applyToSize=function(){let t=[],e=this.channel;for(let e of this.scale.encodings)t=t.concat(e.items);let i=this.areas[0].orientation;if("width"===e||"height"===e){if(bg(this.areas[0])){let t=0,e=this.areas.map((t=>xg(t))),s=this.areas.map((t=>bg(t)));for(let[n,r]of this.areas.entries()){let a=e[n],o=s[n];for(let e=0;e<r.vertices.length;e++){let s,n,h=this._vertices[e+t];if(i===y.Horizontal)if(s=0,o.type===m.Stack)n=a.bottom-this.scale.map(this.data[e+t])-h.y;else if(o.type===m.Grid){switch(r.baseline){case"top":n=a.top+this.scale.map(this.data[e+t])-h.y;break;case"bottom":n=a.bottom-this.scale.map(this.data[e+t])-h.y;break;case"middle":{let i=r.vertices.length-1-e,s=Math.abs(this.scale.map(this.data[e+t])-this.scale.map(this.data[i+t]));n=this.indicator[e+t]?a.middle-s/2-h.y:a.middle+s/2-h.y;break}}}else n=0;else if(n=0,o.type===m.Stack)s=a.left+this.scale.map(this.data[e+t])-h.x;else if(o.type===m.Grid){switch(r.baseline){case"left":s=a.left+this.scale.map(this.data[e+t])-h.x;break;case"right":s=a.right-this.scale.map(this.data[e+t])-h.x;break;case"center":{let i=r.vertices.length-1-e,n=Math.abs(this.scale.map(this.data[e+t])-this.scale.map(this.data[i+t]));s=this.indicator[e+t]?a.center-n/2-h.x:a.center+n/2-h.x;break}}}else s=0;h._doTranslate(s,n)}t+=r.vertices.length}}else{let t="center"==this.areas[0].baseline||"middle"==this.areas[0].baseline,e=0,s=i==y.Vertical?"left":"bottom",n=i==i==y.Vertical?"right":"top";for(let t of this.areas){for(let s=e;s<e+t.vertices.length;s++){let e=this._vertices[s],n=i==y.Vertical?t.baseline!==b.Right?t.bounds.left-t.boundsOffsets.left:t.bounds.right+t.boundsOffsets.right:t.baseline!=b.Top?t.bounds.bottom+t.boundsOffsets.bottom:t.bounds.top-t.boundsOffsets.top,r=i==y.Vertical?t.baseline!==b.Right?n+this.scale.map(this.data[s])-e.x:n-this.scale.map(this.data[s])-e.x:0,a=i==y.Vertical?0:t.baseline!=b.Top?n-this.scale.map(this.data[s])-e.y:n+this.scale.map(this.data[s])-e.y;e._doTranslate(r,a)}let r=this.data.slice(e,e+t.vertices.length),a=Math.min(...r),o=Math.max(...r);t.boundsOffsets[n]=this.scale.map(Math.max(...this.data))-this.scale.map(o),t.boundsOffsets[s]=this.scale.map(a)-this.scale.map(Math.min(...this.data)),e+=t.vertices.length}if(1==t){let t=this._vertices.length/this.areaNum,e=Ag(this._vertices),s=i==y.Vertical?Math.min(...e.map((t=>t.bounds.x))):Math.max(...e.map((t=>t.bounds.y)));for(let e=0;e<this.areaNum;e++)for(let n=0;n<t/2;n++){let r=e*t+n,a=(e+1)*t-n-1,o=this._vertices[r],h=this._vertices[a],l=i==y.Vertical?o.x-h.x:h.y-o.y,c=i==y.Vertical?s+l/2-o.x:0,u=i==y.Vertical?0:s+l/2-o.y,d=i==y.Vertical?s-l/2-h.x:0,f=i==y.Vertical?0:s-l/2-h.y;o._doTranslate(c,u),h._doTranslate(d,f)}}}}for(let t of this.areas)t._updateBounds();"width"!=e&&"height"!=e||this.scene._relayoutAncestors(this.areas[0],this.areas)},t.run(),t}class m_{constructor(t,e,i,s,n){this.items=t,this.anyItem=this.items[0],this.scene=e,this.channel=i,this.field=s,this._aggregator=n.aggregator,this.datatable=n.datatable,this.scale=n.scale,this.scale?(this._flipScale=this.scale.isFlipped,this.scaleType=this.scale.type,this._includeZero=this.scale.includeZero):(this._flipScale=n.flipScale,this.scaleType=n.scaleType,this._includeZero=n.includeZero),this._mapping=n.mapping,this.rangeExtent=n.rangeExtent,this._scheme=n.scheme,this.range=n.range,"angle"==this.channel&&(this.startAngle="startAngle"in n?n.startAngle:90),this._query=void 0,this._map=void 0,this._apply=void 0}get id(){return["enc",Cg(this.anyItem),this.channel,this.field].join("-")}set aggregator(t){this._aggregator=t,this.run()}get aggregator(){return this._aggregator}toJSON(){let t={};return t.anyItem=this.anyItem.id,t.items=this.items.map((t=>t.id)),this.data&&(t.data=this.data),this._rectNegativeValues&&(t._rectNegativeValues=!0),t.args={},t.args.channel=this.channel,t.args.field=this.field,t.args.aggregator=this.aggregator,t.args.datatable=this.datatable.id,t.args.scale=this.scale.id,t.args.mapping=this._mapping,t.args.rangeExtent=this.rangeExtent,t.args.scheme=this._scheme,t.args.scaleType=this.scaleType,t.args.range=this.range,"angle"==this.channel&&(t.args.startAngle=this.startAngle),t}run(){this._query(),this._map(),this._apply()}get dataTable(){return this.datatable}_inferTickValues(){let t,e=this,i=e.scale.domain,n=e.scale.range;switch(e.scale.type){case"linear":case"log":{let r=Math.abs(n[0]-n[1]);if("width"==e.channel||"height"==e.channel){let t=Sg(e.anyItem,"stack");if(t){let s=vg(t.group,e.scene);r=Math.max(...s.map((t=>t.refBounds[e.channel]))),i[1]=e.scale.invert(r)}}t="width"==e.channel||"x"==e.channel?45:30;let a,o=Math.max(2,Math.floor(r/t));if("log"===e.scale.type){a=[];let t=e.scale._scale.ticks();for(let e of t){let i=Math.log(e)/Math.log(10)+1e-6;Math.abs(i-Math.floor(i))<o/t.length&&a.push(e)}}else a=s.ticks(i[0],i[1],o);return a}case"point":{t="width"==e.channel||"x"==e.channel?80:30;let s=Math.floor(e.scale.rangeExtent/i.length),n=Math.ceil(t/s);return"x"==e.channel?i.filter(((t,e)=>e%n==0)):i}case"time":{t="width"==e.channel||"x"==e.channel?80:30;let r,a,o=Math.floor((n[1]-n[0])/t),h=Math.ceil((i[1]-i[0])/o)/1e3,l=[1,60,3600,86400,2628003,31536e3],c=[s.timeSeconds,s.timeMinutes,s.timeHours,s.timeDays,s.timeMonths,s.timeYears];for(let t=0;t<l.length-1;t++)if(h>=l[t]&&h<l[t+1])return r=Math.floor(h/l[t]),a=c[t],a(i[0],i[1],r);return h>l[l.length-1]?(r=Math.floor(h/l[l.length-1]),a=c[l.length-1],a(i[0],i[1],r)):[]}default:return[]}}getScaleRange(t){let e=t||this.anyItem;if(e.type!=k.Area&&("vertex"!=e.type||e.parent.type!=k.Area)){if("x"==this.channel){let t=bg(e);if(t&&t.type==m.Grid){let i=t.cellBounds,s=e.parent.parent.children.findIndex((t=>e.parent==t||e.parent.parent==t));return[i[s].left,i[s].left+this.scale.rangeExtent]}if("vertex"==e.type||"segment"==e.type){let t=this.scale.offset;return[t,t+this.scale.rangeExtent]}{let t=this.scale.offset;return[t,t+this.scale.rangeExtent]}}if("y"==this.channel){let t=bg(e);if(t&&t.type==m.Grid){let i=t.cellBounds,s=e.parent.parent.children.findIndex((t=>e.parent==t||e.parent.parent==t));return[i[s].bottom,i[s].bottom-this.scale.rangeExtent]}if("vertex"==e.type||"segment"==e.type){let t=this.scale.offset;return[t+this.scale.rangeExtent,t]}{let t=this.scale.offset;return[t+this.scale.rangeExtent,t]}}if("width"==this.channel){let t=Sg(e);if("grid"===t.type){let i=t.cellBounds,s=e.parent.parent.children.findIndex((t=>e.parent==t||e.parent.parent==t));return[i[s].left,i[s].right]}if("stack"===t.type&&"horizontal"==t.orientation)return[t.group.bounds.left,t.group.bounds.right];{let t=vg(e,this.scene),i=Math.min(...t.map((t=>t.bounds.left)));return[i,i+this.scale.rangeExtent]}}if("height"==this.channel){let t=zg(e);if(t&&t.layout&&["grid","stack"].indexOf(t.layout.type)>=0){let i=t.layout.cellBounds,s=e.parent.parent.children.findIndex((t=>e.parent===t||e.parent.parent===t));return[i[s].bottom,i[s].bottom-i[s].height]}{let t=vg(e,this.scene),i=Math.max(...t.map((t=>t.refBounds.bottom)));return[i,i-this.scale.rangeExtent]}}if("radialDistance"==this.channel){let t=e.parent;return[t.x,t.x+this.scale.rangeExtent]}return this.scale.range}{let t,i=e.type==k.Area?e:e.parent,s=Ug(i),n=bg(i);t=n?s==y.Vertical?n.horzCellAlignment===b.Left:n.vertCellAlignment===b.Bottom:s==y.Vertical?i.baseline==b.Left:i.baseline==b.Bottom;let r=kg(i);if(r)switch(this.channel){case"x":return[r.left,r.left+this.scale.rangeExtent];case"width":return t?[r.left,r.left+this.scale.rangeExtent]:[r.right,r.right-this.scale.rangeExtent];case"y":return[r.bottom,r.bottom-this.scale.rangeExtent];case"height":return t?[r.bottom,r.bottom-this.scale.rangeExtent]:[r.top+this.scale.rangeExtent,r.top]}else if(n&&"stack"===n.type)switch(r=n.group.bounds,this.channel){case"x":return[r.left,r.left+this.scale.rangeExtent];case"width":return t?[r.left,r.left+this.scale.rangeExtent]:[r.right,r.right-this.scale.rangeExtent];case"y":return[r.bottom,r.bottom-this.scale.rangeExtent];case"height":return t?[r.bottom,r.bottom-this.scale.rangeExtent]:[r.top+this.scale.rangeExtent,r.top]}if(s==y.Horizontal)switch(this.channel){case"width":case"height":{let e=this._vertices,i=t?Math.max(...e.map((t=>t.y))):Math.min(...e.map((t=>t.y)));return t?[i,i-this.scale.rangeExtent]:[i+this.scale.rangeExtent,i]}case"x":case"y":{let t=vg(i.firstVertex,this.scene),e=Math.min(...t.map((t=>t.x)));return[e,e+this.scale.rangeExtent]}}else if(s==y.Vertical)switch(this.channel){case"x":case"y":{let t=vg(i.firstVertex,this.scene),e=Math.max(...t.map((t=>t.y)));return[e,e-this.scale.rangeExtent]}case"height":case"width":{let e=vg(i.firstVertex,this.scene),s=t?Math.min(...e.map((t=>t.x))):Math.max(...e.map((t=>t.x)));return t?[s,s+this.scale.rangeExtent]:[s-this.scale.rangeExtent,s]}}}}}function y_(t,e,i){return e.map((e=>[e,s.mean(i,(i=>t(e-i)))]))}function v_(t){return e=>Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}function b_(t,e){if("field"in e){let i=e.field;if("value"in e)return t[i]==e.value;if("range"in e)return t[i]>=e.range[0]&&t[i]<=e.range[1];if("values"in e)return e.values.indexOf(t[i])>=0}else if("fields"in e){let i=e.fields[0],s=e.fields[1],n=t[i],r=t[s];switch(e.operator){case"==":return n==r;case">":return n>r;case">=":return n>=r;case"<":return n<r;case"<=":return n<=r}return!1}}class x_{constructor(t,e,i){if(this.url=e,this.id=k.DataTable+Fg[k.DataTable]++,this.data=t,this.rawData=JSON.parse(JSON.stringify(t)),this._dateMap=new Map,this._fields=Object.keys(this.data[0]),this._newField=0,i)this._fieldTypes=i;else{this._fieldTypes={};for(let t of this._fields)this._fieldTypes[t]=S_(this.data.map((e=>e[t]))),"year"==t.toLowerCase()&&this._fieldTypes[t]==S.Integer&&(this._fieldTypes[t]=S.Date)}this._validate(this.data,this._fieldTypes),this._fieldSummaries={};for(let t of this._fields)this._fieldSummaries[t]=w_(this.data.map((e=>e[t])),this._fieldTypes[t]);this._fields.indexOf(a)<0&&this._addField(a,S.String,this.data.map(((t,e)=>"r"+e)))}get name(){return this.url?function(t){var e=t.indexOf("\\")>=0?t.lastIndexOf("\\"):t.lastIndexOf("/"),i=t.substring(e);0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1));return i}(this.url):this.id}set sourceDataTable(t){this._sourceDataTable=t}get sourceDataTable(){return this._sourceDataTable}getEncodableFields(t){switch(t){case"x":case"y":case"width":case"height":case"radius":case"fillColor":case"strokeColor":case"text":return this.numericFields.concat(this.nonNumericFields);default:return this.numericFields}}toJSON(){let t={};return t.data=this.rawData,t.fieldTypes=this._fieldTypes,t.url=this.url,t.id=this.id,t.sourceDataTable=this._sourceDataTable,t.transform=this._transform,t.dateMap={},t}transformField(t,e,i){let s=this.data.map((i=>e(i[t]))),n=S_(s),r=i||Date.now()+"_field"+this._newField++;return this._addField(r,n,s),r}setValueOrder(t,e){this._fieldSummaries[t].unique=e}_addField(t,e,i){this.data.forEach(((e,s)=>e[t]=i[s])),this._fieldTypes[t]=e,this._fields.push(t),this._fieldSummaries[t]=w_(i,e)}getFieldType(t){return this._fieldTypes[t]}get fields(){return this._fields}getFieldSummary(t){return this._fieldSummaries[t]}getFieldValues(t){return this.data.map((e=>e[t]))}getUniqueFieldValues(t){return this._fieldSummaries[t].unique}getRowCount(){return this.data.length}hasField(t){return this._fields.indexOf(t)>=0}parseFieldAsDate(t,e){let i=s.timeParse(e);for(let e of this.data){let s=e[t];null==s||null==s?(s="",e[t]=new Date(1899,11,31).getTime()):e[t]=i(s).getTime(),this._dateMap.set(e[t],s)}this._fieldTypes[t]=S.Date,this._fieldSummaries[t]=w_(this.data.map((e=>e[t])),S.Date)}getRawValue(t,e){return this.getFieldType(t)===S.Date?this._dateMap.get(e).toString():e}static get RowID(){return a}get nonNumericFields(){let t=[];for(let e in this._fieldTypes)this._fieldTypes[e]!=S.Number&&this._fieldTypes[e]!=S.Integer&&e!=x_.RowID&&t.push(e);return t.sort(((t,e)=>this.getUniqueFieldValues(t).length-this.getUniqueFieldValues(e).length)),t}get numericFields(){let t=[];for(let e in this._fieldTypes)this._fieldTypes[e]!==S.Number&&this._fieldTypes[e]!==S.Integer||e==x_.RowID||t.push(e);return t}getFieldsByType(t){let e=[];for(let i in this._fieldTypes)this._fieldTypes[i]===t&&i!=x_.RowID&&e.push(i);return e}transform(t,e,i){let n=i||{};switch(t){case"kde":return function(t,e,i){let s=e[0],n=t.nonNumericFields,r={};for(let e of t.data){let t=n.map((t=>String(e[t]))).join("_");t in r||(r[t]=n.map((t=>e[t])),r[t].push([])),r[t][r[t].length-1].push(e[s])}let a="min"in i?i.min:t.getFieldSummary(s).min,o="max"in i?i.max:t.getFieldSummary(s).max,h=a,l=[];for(;h<o;)l.push(h),h+=i.interval;l.push(h);let c=[];for(let t in r){let e=r[t].pop(),a=y_(v_(i.bandwidth),l,e);for(let e of a){let i={};r[t].forEach(((t,e)=>i[n[e]]=t)),i[s]=e[0],i[s+"_density"]=e[1],c.push(i)}}let u={};return n.forEach((e=>u[e]=t.getFieldType(e))),u[s]=S.Number,u[s+"_density"]=S.Number,new x_(c,t.url,u)}(this,e,n);case"bin":return function(t,e,i){let n=e[0],r=t.nonNumericFields,a={};for(let e of t.data){let t=r.map((t=>String(e[t]))).join("_");a.hasOwnProperty(t)||(a[t]=r.map((t=>e[t])),a[t].push([])),a[t][a[t].length-1].push(e[n])}let o=[];for(let t in a){let e=a[t].pop(),i=s.bin()(e);for(let e of i){let i={};a[t].forEach(((t,e)=>i[r[e]]=t)),i.x0=e.x0,i.x1=e.x1,i[n+"_count"]=e.length,o.push(i)}}let h={};r.forEach((e=>h[e]=t.getFieldType(e))),h.x0=S.Number,h.x1=S.Number,h[n+"_count"]=S.Number;let l=new x_(o,t.url,h);return l.sourceDataTable=t,l.transform={type:"bin",args:e},l}(this,e);case"sort":return function(t,e,i){t.data.sort(((t,i)=>function(t,e,i,s){for(let s of i){if(t[s]<e[s])return-1;if(t[s]>e[s])return 1}return 0}(t,i,e))),t.summarize()}(this,e);case"filter":return function(t,e){let i=[];for(let s of t.data){let t=!0;for(let i of e)if(!b_(s,i)){t=!1;break}t&&i.push(s)}let s=new x_(i,t.url);return s.sourceDataTable=t,s.transform={type:"filter",args:e},s}(this,e)}}summarize(){for(let t of this._fields)this._fieldSummaries[t]=w_(this.data.map((e=>e[t])),this._fieldTypes[t])}_validate(t,e){for(let i of t)for(let t in e){let s,n=e[t],r=i[t];if(null==i[t]||null==i[t])switch(n){case S.Boolean:s=!1;break;case S.Date:s=new Date(1899,11,31).getTime();break;case S.String:s="";break;default:s=0}else switch(n){case S.Boolean:s=r;break;case S.Date:s=Number.isInteger(r)?new Date(r,0).getTime():new Date(r+"").getTime(),this._dateMap.set(s,r);break;case S.String:s=r.toString();break;default:s=r}i[t]=s}}}function w_(t,e){var i={};switch(e){case S.Boolean:i.trueCount=t.filter((t=>t)).length,i.falseCount=t.filter((t=>!t)).length;break;case S.Date:i.min=s.min(t),i.max=s.max(t),i.extent=[i.min,i.max],i.unique=[...new Set(t)];break;case S.String:i.unique=[...new Set(t)];break;default:i.min=s.min(t),i.max=s.max(t),i.extent=[i.min,i.max],i.mean=s.mean(t),i.median=s.median(t),i.unique=[...new Set(t)]}return i}var k_={boolean:function(t){return"true"===t||"false"===t||!0===t||!1===t||"[object Boolean]"==toString.call(t)},integer:function(t){return k_.number(t)&&(t=+t)==~~t},number:function(t){return!isNaN(+t)&&"[object Date]"!=toString.call(t)},date:function(t){let e=new Date(t);return null!=e&&!isNaN(e)},string:function(t){return!0}};function S_(t){var e=Object.values(S);for(let i=0;i<t.length;i++){let s=t[i];if(null!=s){for(let t=0;t<e.length;t++)k_[e[t]](s)||(e.splice(t,1),t-=1);if(1==e.length)return e[0]}}return e[0]}class C_ extends n_{constructor(t,e,i){super(i),this.encoding=t,this._field=this.encoding.field,this._channel=this.encoding.channel,this._orientation="orientation"in i?i.orientation:"x"===this._channel||"width"==this._channel?"bottom":"left",this._posArg="x"==this._channel||"width"==this._channel?i.pathY:i.pathX,this._position=this._posArg,this._titleText="title"in i?i.title:this.encoding.field,this._item=e,this._ticks=new Jg,this._ticks.id=this.id+"ticks",this.addChild(this._ticks),this._labels=new Jg,this._labels.id=this.id+"labels",this.addChild(this._labels),"radialDistance"===this._channel&&"rotation"in i&&(this._rotate=[-i.rotation,this._item.parent.x,this._item.parent.y]),this._showTitle=!("showTitle"in i)||i.showTitle,this._determineAxisFlip(),this._generatePath(),this._positionPath(),this._showTitle&&this._generateTitle(),this._showTitle&&this._positionTitle()}autoUpdateTicks(){let t=this.encoding._inferTickValues();this.tickValues=t,this.labelValues=t}_updateBounds(){this._bounds=this._path.bounds,this._ticks.children.length>0&&(this._bounds=this._bounds.union(this._ticks.bounds)),this._labels.children.length>0&&(this._bounds=this._bounds.union(this._labels.bounds)),this._title&&(this._bounds=this._bounds.union(this._title.bounds))}toJSON(){let t=super.toJSON();return t.args.item=this._item.id,"time"===this.encoding.scale.type&&(t.args.isDate=!0),this._rotate&&(t.args.rotation=this._rotate[0]),"x"==this._channel||"width"==this._channel?t.args.pathY=this._posArg:t.args.pathX=this._posArg,t}get ticks(){return this._ticks}get labels(){return this._labels}get path(){return this._path}set strokeColor(t){this._strokeColor=t;for(let e of this._ticks.children)e.strokeColor=t;this._path.strokeColor=t}get strokeColor(){return this._strokeColor}set textColor(t){this._textColor=t;for(let e of this._labels.children)e.fillColor=t;this._title&&(this._title.fillColor=t)}get textColor(){return this._textColor}_generatePath(){this._path=new q({strokeColor:this._strokeColor}),this._pathVisible||(this._path.visibility="hidden"),this._path.type=k.Line,this._path.id=this.id+"path",this.addChild(this._path)}_generateTicks(){this._ticks.removeAll();for(let t=0;t<this._tickValues.length;t++){let e=new q({strokeColor:this._strokeColor});this._tickVisible||(e.visibility="hidden"),e.type=k.Line,e.id=this.id+"tick"+t,this._ticks.addChild(e)}}_generateLabels(){let t;switch(this._labels.removeAll(),this.encoding.datatable.getFieldType(this.encoding.field)){case S.Date:t=s.timeFormat(this._labelFormat);break;case S.String:t=function(t){return t};break;default:t=s.format(this._labelFormat)}for(let[e,i]of this._labelValues.entries()){let s=new s_({text:t(i),fontSize:this._fontSize,fillColor:this._textColor});s.id=this.id+"label"+e,this._labels.addChild(s)}}_positionPath(){this._range=this.encoding.getScaleRange(this._item),void 0===this._posArg?this._position=this._computePosition():this._position=this._posArg;let t=[];if("x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let e=this._ticks.children.map((t=>t.vertices[0].x));t.push([Math.min(...e.concat(this._range)),this._position]),t.push([Math.max(...e.concat(this._range)),this._position])}else if("y"==this._channel||"height"==this._channel){let e=this._ticks.children.map((t=>t.vertices[0].y));t.push([this._position,Math.min(...e.concat(this._range))]),t.push([this._position,Math.max(...e.concat(this._range))])}this._path._setVertices(t),this._path._updateBounds(),this._showTitle&&this._title&&this._positionTitle(),this._updateBounds()}_isAlignedLeft(t){switch(t.type){case m.Stack:case m.Grid:return t.horzCellAlignment===b.Left;default:return!0}}_isAlignedBottom(t){switch(t.type){case m.Stack:case m.Grid:return t.vertCellAlignment===b.Bottom;default:return!0}}_determineAxisFlip(){if("x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){if("width"==this._channel){let t=zg(this._item)?zg(this._item).layout:bg(this._item);if(t)this._flip=!this._isAlignedLeft(t);else if("area"==this._item.type){let t=this._item.baseline==b.Left||this._item.baseline==b.Center||this._item.baseline==b.Middle||null==this._item.baseline;this._flip=!t}}}else if(("y"==this._channel||"height"==this._channel)&&"height"==this._channel){let t=zg(this._item)?zg(this._item).layout:bg(this._item);if(t)this._flip=!this._isAlignedBottom(t);else if("area"==this._item.type){let t=this._item.baseline==b.Bottom||this._item.baseline==b.Center||this._item.baseline==b.Middle||null==this._item.baseline;this._flip=!t}}}_positionLabels(){if(void 0===this._posArg?this._position=this._computePosition():this._position=this._posArg,"x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let t="bottom"==this._orientation?this._tickSize:-this._tickSize,e="bottom"==this._orientation?["center","top"]:["center","bottom"];if(this._flip)for(let[i,s]of this._labels.children.entries())s.x=this._range[1]-this.encoding.scale.map(this._labelValues[i]),s.y=this._position+t,s.anchor=e,this._labelRotation&&(s._rotate=[this._labelRotation,s.x,s.y],s.anchor=["right",e[1]]);else if(this.encoding.scale.isFlipped)for(let[i,s]of this._labels.children.entries())s.x=this._range[0]+this.encoding.scale.map(this._labelValues[i]),s.y=this._position+t,s.anchor=e,this._labelRotation&&(s._rotate=[this._labelRotation,s.x,s.y],s.anchor=["right",e[1]]);else for(let[i,s]of this._labels.children.entries())s.x=this._range[0]+this.encoding.scale.map(this._labelValues[i])-this.encoding.scale.range[0],s.y=this._position+t,s.anchor=e,this._labelRotation&&(s._rotate=[this._labelRotation,s.x,s.y],s.anchor=["right",e[1]])}else if("y"==this._channel||"height"==this._channel){let t="left"==this._orientation?-this._tickSize:this._tickSize,e="left"==this._orientation?["right","middle"]:["left","middle"];if(this._flip)for(let[i,s]of this._labels.children.entries())s.x=this._position+t,s.y=this._range[1]+this.encoding.scale.map(this._labelValues[i]),s.anchor=e;else if(this.encoding.scale.isFlipped)for(let[i,s]of this._labels.children.entries())s.x=this._position+t,s.y=this._range[1]-this.encoding.scale.map(this._labelValues[i])+this.encoding.scale.range[1],s.anchor=e;else for(let[i,s]of this._labels.children.entries())s.x=this._position+t,s.y=this._range[0]-this.encoding.scale.map(this._labelValues[i])+this.encoding.scale.range[0],s.anchor=e}this._labels._updateBounds(),this._updateBounds()}_computePosition(){let t;if("vertex"===this._item.type&&!this._item.parent.closed){let t=vg(this._item,this._item.parent.getScene());if("x"===this._channel&&1==Z(t.map((t=>t.bounds.middle))).length)return this._item.bounds.middle;if("y"===this._channel&&1==Z(t.map((t=>t.bounds.center))).length)return this._item.bounds.center;if("radialDistance"===this._channel)return this._item.parent.y}if(this._item.type!==k.Area&&this._item.parent.type!==k.Area||(t=kg(this._item)),void 0===t){let e=zg(this._item);void 0===e&&(e=Dg(this._item)),t=e.bounds}return"x"===this._channel||"width"===this._channel?"top"==this._orientation?t.top-this._tickSize:t.bottom+this._tickSize:"y"===this._channel||"height"===this._channel?"left"==this._orientation?t.left-this._tickSize:t.right+this._tickSize:"radialDistance"===this._channel?this._item.parent.y:void 0}_positionTicks(){if(void 0===this._posArg?this._position=this._computePosition():this._position=this._posArg,this._range=this.encoding.getScaleRange(this._item),"x"==this._channel||"radialDistance"==this._channel||"width"==this._channel){let t="bottom"==this._orientation?this._tickSize:-this._tickSize;if(this._flip)for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._range[1]-this.encoding.scale.map(this._tickValues[e]),this._position],[this._range[1]-this.encoding.scale.map(this._tickValues[e]),this._position+t]]),i._updateBounds();else if(this.encoding.scale.isFlipped)for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._range[0]+this.encoding.scale.map(this._tickValues[e]),this._position],[this._range[0]+this.encoding.scale.map(this._tickValues[e]),this._position+t]]),i._updateBounds();else for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._range[0]+this.encoding.scale.map(this._tickValues[e])-this.encoding.scale.range[0],this._position],[this._range[0]+this.encoding.scale.map(this._tickValues[e])-this.encoding.scale.range[0],this._position+t]]),i._updateBounds()}else if("y"==this._channel||"height"==this._channel){let t="left"==this._orientation?-this._tickSize:this._tickSize;if(this._flip)for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._position+t,this._range[1]+this.encoding.scale.map(this._tickValues[e])],[this._position,this._range[1]+this.encoding.scale.map(this._tickValues[e])]]),i._updateBounds();else if(this.encoding.scale.isFlipped)for(let[e,i]of this._ticks.children.entries()){let s=this._range[1]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[1];i._setVertices([[this._position+t,s],[this._position,s]]),i._updateBounds()}else for(let[e,i]of this._ticks.children.entries())i._setVertices([[this._position+t,this._range[0]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0]],[this._position,this._range[0]-this.encoding.scale.map(this._tickValues[e])+this.encoding.scale.range[0]]]),i._updateBounds()}this._positionPath(),this._ticks._updateBounds(),this._updateBounds()}_positionTitle(){let t=this._path.bounds;this._title.achor=this._titleAnchor,this._titlePosition?(this._title.x=this._titlePosition[0],this._title.y=this._titlePosition[1],"y"!=this._channel&&"height"!=this._channel||this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])):"x"==this._channel||"width"==this._channel?(this._title.x=t.x,this._title.y="top"==this._orientation?t.top-this._titleOffset:t.bottom+this._titleOffset):(this._title.x="left"==this._orientation?t.left-this._titleOffset:t.right+this._titleOffset,this._title.y=t.y,this._rotateYTitle&&(this._title._rotate="left"==this._orientation?[-90,this._title.bounds.x,this._title.bounds.y]:[90,this._title.bounds.x,this._title.bounds.y])),this._title._updateBounds(),this._updateBounds()}matches(t){let e=Cg(t).split("_")[0],i=this.encoding.scale.encodings;for(let t of i){if(Cg(t.anyItem).split("_")[0]===e)return!0}return!1}get isFlipped(){return!!this._flip||!!this.encoding.scale.isFlipped}}class E_ extends Jg{constructor(t,e){super(),this.type=k.Legend,this.id=this.type+Fg[this.type]++,this.encoding=t,this._textColor="textColor"in e?e.textColor:"#555",this._strokeColor="strokeColor"in e?e.strokeColor:"#555",this._fontSize="fontSize"in e?e.fontSize:"12px",this._x="x"in e?e.x:0,this._y="y"in e?e.y:0,this._showTitle=!("showTitle"in e)||e.showTitle,this._orientation="orientation"in e?e.orientation:y.Vertical,"numCols"in e||"numRows"in e?(this._numCols=e.numCols,this._numRows=e.numRows):this._orientation===y.Vertical?this._numCols=1:this._numRows=1,this._initialize()}toJSON(){let t=super.toJSON();return"args"in t||(t.args={}),t.args.textColor=this._textColor,t.channel=this.encoding.channel,t.field=this.encoding.field,t.args.strokeColor=this._strokeColor,t.args.x=this._x,t.args.y=this._y,t.args.orientation=this._orientation,t}get field(){return this.encoding.field}get channel(){return this.encoding.channel}get fieldType(){return this.encoding.datatable.getFieldType(this.field)}_initialize(){let t=this.encoding.scene,e=this.encoding.field;switch(this.encoding.datatable.getFieldType(e)){case S.String:this._createCategoricalColorLegend(t,e);break;case S.Date:case S.Number:case S.Integer:this._createNumericalColorLegend(t,e)}this._updateBounds()}_createNumericalColorLegend(t,e){let i,s,n;if(this._orientation==y.Vertical?(i=15,s=300):(i=300,s=15),this._showTitle){let s=t.mark("text",{fillColor:this._textColor,text:e,x:this._x+i/2,y:this._y,anchor:["center","middle"]});this.addChild(s),n=20}else n=0;let r,a=t.mark("rect",{top:this._y+n,left:this._x,width:i,height:s,strokeWidth:0,opacity:this.encoding.anyItem.opacity}),o=[Math.min(...this.encoding.data),Math.max(...this.encoding.data)],h=this.encoding.scale.mapping,l=[],c=[];if(h){let e=Object.keys(h).map((t=>parseFloat(t))).sort(((t,e)=>t-e));this._orientation==y.Vertical?(r=new D({x1:0,y1:100,x2:0,y2:0}),e.forEach((e=>{let a=(e-o[0])/(o[1]-o[0]);r.addStop(100*a,h[e],1);let u=t.mark("line",{x1:this._x+i,x2:this._x+i+5,y1:this._y+s-a*s+n,y2:this._y+s-a*s+n,strokeColor:this._strokeColor});c.push(u);let d=t.mark("text",{fillColor:this._textColor,text:e.toFixed(0),x:this._x+i+5+5,y:this._y+s-a*s+n,anchor:["left","middle"]});l.push(d)}))):(r=new D({x1:0,y1:0,x2:100,y2:0}),e.forEach((e=>{let a=(e-o[0])/(o[1]-o[0]);r.addStop(100*a,h[e],1);let u=t.mark("line",{x1:this._x+a*i,x2:this._x+a*i,y1:this._y+20-5+n,y2:this._y+s+5+n,strokeColor:this._strokeColor});c.push(u);let d=t.mark("text",{fillColor:this._textColor,text:e.toFixed(0),x:this._x+a*i,y:this._y+s+5+n,anchor:["center","top"]});l.push(d)})))}else{let a=this.encoding.scale.domain,o=this.encoding.datatable,h=o.getFieldType(e),u=[],d=h===S.Date?o.getUniqueFieldValues(e):Z(this.encoding.data);if(d.length<=10)u=d,u.sort(((t,e)=>t-e));else if(h===S.Date){d.sort(((t,e)=>t-e));for(let t=0;t<d.length;t+=Math.ceil(d.length/10))u.push(d[t])}else{let t=(a[1]-a[0])/9;for(let e=0;e<10;e++)u.push(a[0]+e*t)}let f=0,p=(u[u.length-1]-u[0])/u.length;for(;p<1;)p*=10,f++;u=u.map((t=>t.toFixed(f))),this._orientation==y.Vertical?(r=new D({x1:0,y1:100,x2:0,y2:0}),u.forEach((u=>{let d=(u-a[0])/(a[1]-a[0]);r.addStop(100*d,this.encoding.scale.map(u),1);let f=t.mark("line",{x1:this._x+i,x2:this._x+i+5,y1:this._y+s-d*s+n,y2:this._y+s-d*s+n,strokeColor:this._strokeColor});c.push(f);let p=t.mark("text",{fillColor:this._textColor,text:h===S.Date?o.getRawValue(e,u):u,x:this._x+i+5+5,y:this._y+s-d*s+n,anchor:["left","middle"]});l.push(p)}))):(r=new D({x1:0,y1:0,x2:100,y2:0}),u.forEach((u=>{let d=(u-a[0])/(a[1]-a[0]);r.addStop(100*d,this.encoding.scale.map(u),1);let f=t.mark("line",{x1:this._x+d*i,x2:this._x+d*i,y1:this._y+s+n,y2:this._y+s+5+n,strokeColor:this._strokeColor});c.push(f);let p=t.mark("text",{fillColor:this._textColor,text:h===S.Date?o.getRawValue(e,u):u,x:this._x+d*i,y:this._y+s+5+n,anchor:["center","top"]});l.push(p)})))}a.styles.fillColor=r,this.addChild(a);for(let t of l)this.addChild(t);for(let t of c)this.addChild(t)}get textColor(){return this._textColor}set textColor(t){this._textColor=t,this.setTextColor(this)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this.removeAll(),this._initialize()}setTextColor(t){if(t.children&&0!==t.children.length)for(let e of t.children)e.type===k.PointText?e.fillColor=this._textColor:e.children&&e.children.length>0&&this.setTextColor(e)}_createCategoricalColorLegend(t,e){let i=this.encoding.scale,s=new x_(i.domain.map((t=>({category:t,value:i.map(t)})))),n=s.getUniqueFieldValues("category").sort(((t,e)=>e.length-t.length))[0],r=this.encoding.anyItem,a=Ng(r)&&r.closed?r.strokeWidth:0;if(this._orientation===y.Vertical){let o=0;this._showTitle&&(this.addChild(new s_({fillColor:this._textColor,fontSize:this._fontSize,text:e,x:this._x,y:this._y,anchor:["left","top"]})),o=parseFloat(this._fontSize)+5);let h=t.mark("rect",{top:this._y+2+o,left:this._x,width:10,height:10,strokeWidth:a,strokeColor:r.strokeColor,opacity:r.opacity}),l=t.mark("text",{text:n,fillColor:this._textColor,fontSize:this._fontSize,x:this._x+20,y:this._y+o+12+a,anchor:["left","bottom"]}),c=t.glyph(h,l),u=t.repeat(c,s);t.encode(l,{channel:"text",field:"category",_remember:!1}),t.encode(h,{channel:"fillColor",field:"category",_remember:!1,scale:i}),u.layout=new H({numCols:this._numCols,numRows:this._numRows}),this.addChild(u)}else{let e=t.mark("rect",{top:this._y,left:this._x,width:10,height:10,strokeWidth:a,strokeColor:r.strokeColor,opacity:this.encoding.anyItem.opacity}),o=t.mark("text",{text:n,fillColor:this._textColor,fontSize:this._fontSize,x:this._x+15,y:this._y,anchor:["left","top"]}),h=t.glyph(e,o),l=t.repeat(h,s);t.encode(o,{channel:"text",field:"category",_remember:!1}),t.encode(e,{channel:"fillColor",field:"category",_remember:!1,scale:i}),l.layout=new H({numCols:this._numCols,numRows:this._numRows,colGap:15}),this.addChild(l)}}pathHitTest(t,e){let i=Og(this);for(let s=i.length-1;s>=0;s--){let n=i[s];if(Ng(n)&&n.contains(t,e))return n}return null}matches(t){let e=Cg(t).split("_")[0],i=this.encoding.scale.encodings;for(let t of i){if(Cg(t.anyItem).split("_")[0]===e)return!0}return!1}_doTranslate(t,e){super._doTranslate(t,e),this._x+=t,this._y+=e}}class A_ extends Jg{constructor(t){if(super(),this.type=k.Glyph,this._id=this.type+Fg[this.type]++,t)for(let e of t)this.addChild(e)}duplicate(){let t=this.getScene().glyph();for(let e of this.children)t.addChild(e.duplicate());return t.classId=this.classId,this._dataScope&&(t.dataScope=this._dataScope.clone()),t}}class T_ extends q{constructor(t){super(t),this.type=k.Area,this.closed=!0,this._orientation="orientation"in t?t.orientation:void 0,this._baseline="baseline"in t?t.baseline:void 0,t&&"vertices"in t&&this.segments.push(new U(this.vertices[this.vertices.length-1],this.vertices[0],this,this.segmentCounter++))}get baseline(){return this._baseline}set baseline(t){this._baseline=t}get orientation(){return this._orientation}set orientation(t){this._orientation=t}get firstVertexPair(){return[this.vertices[0],this.vertices[this.vertices.length-1]]}get width(){return this.vertices[this.vertices.length/2].x-this.vertices[0].x}get height(){return this.vertices[this.vertices.length/2].y-this.vertices[0].y}get left(){return this.vertices[0].x}get top(){return this.vertices[0].y}copyPropertiesTo(t){super.copyPropertiesTo(t),t._baseline=this._baseline,t._orientation=this._orientation}resizeArea(t,e){let i=this.vertices[this.vertices.length/2].x,s=this.vertices[this.vertices.length/2].y,n=this.width,r=this.height;for(let a of this.vertices)a.x=i+t/n*(a.x-i),a.y=s+e/r*(a.y-s);this._updateBounds()}getSVGPathData(){return super.getSVGPathData()+" z"}}class I_ extends q{constructor(t){super(t),this.type=k.Ring,this.closed=!0,this._x="x"in t?t.x:0,this._y="y"in t?t.y:0,this._innerRadius="innerRadius"in t?t.innerRadius:100,this._outerRadius="outerRadius"in t?t.outerRadius:200}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t,this._updateBounds()}get x(){return this._x}get y(){return this._y}get center(){return new W(this._x,this._y)}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}get thickness(){return this._outerRadius-this._innerRadius}_doTranslate(t,e){this._x+=t,this._y+=e,this._updateBounds()}_updateBounds(){this._bounds=new n(this._x-this._outerRadius,this._y-this._outerRadius,2*this._outerRadius,2*this._outerRadius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._innerRadius=this._innerRadius,t._outerRadius=this._outerRadius}getSVGPathData(){return["M "+this._x+" "+this._y,"m 0, -"+this._outerRadius,"a "+this._outerRadius+","+this._outerRadius+", 0, 1, 0, 1, 0","Z","m 0 "+(this._outerRadius-this._innerRadius),"a "+this._innerRadius+", "+this._innerRadius+", 0, 1, 1, -1, 0","Z"].join(" ")}}class O_ extends q{constructor(t){super(t),this.type=k.Polygon,this.closed=!0,"x"in t&&(this._x=t.x),"y"in t&&(this._y=t.y),"radius"in t&&(this._radius=t.radius)}get radius(){return this._radius}get x(){return this._x}get y(){return this._y}get center(){return new W(this._x,this._y)}set x(t){this._x=t,this._updateBounds()}set y(t){this._y=t,this._updateBounds()}set radius(t){this._radius=t,this._updateBounds()}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._radius=this._radius}_doTranslate(t,e){this._x+=t,this._y+=e,super._doTranslate(t,e)}}class R_{constructor(t,e){this.direction=e,this.items=t,this.type=x,this._orientation=[b.Top,b.Middle,b.Bottom].indexOf(e)>=0?y.Vertical:y.Horizontal,this._itemIds=this.items.map((t=>t.classId)).sort().join("_"),this.id=this.type+"_"+this._itemIds+"_"+this._orientation}get orientation(){return this._orientation}apply(){let t,e=this.direction;this.direction==b.Top||this.direction==b.Left?t=Math.min(...this.items.map((t=>t.bounds[e]))):this.direction==b.Bottom||this.direction==b.Right?t=Math.max(...this.items.map((t=>t.bounds[e]))):this.direction!=b.Center&&this.direction!=b.Middle||(t=s.mean(this.items.map((t=>t.bounds[e]))));let i=this.items.map((i=>t-i.bounds[e])),n=e==b.Top||e==b.Middle||e==b.Bottom?"y":"x";this.items.forEach(((t,e)=>{if(t.parent&&t.parent.layout&&t.parent.layout.type==m.Stack){let s="x"==n?i[e]:0,r="y"==n?i[e]:0;t.parent._doTranslate(s,r)}else{let s="x"==n?i[e]:0,r="y"==n?i[e]:0;t._doTranslate(s,r)}}));let r={};this.items.forEach((t=>r[t.classId]=t)),Object.values(r).forEach((t=>t.getScene()._updateAncestorBounds(t)))}toJSON(){let t={};return t.items=this.items.map((t=>t.id)),t.direction=this.direction,t.type=this.type,t.id=this.id,t}}class M_{constructor(t,e,i,s,n,r,a){this.item=t,this.baseItem=e,this.scene=i,this.channel=s,this.itemAnchor=n,this.baseAnchor=r,this.offset=a,this.type=w,this.id=this.type+"_"+this.item.classId+"_"+this.baseItem.classId+"_"+s}apply(){let t=vg(this.item,this.scene),e=vg(this.baseItem,this.scene),i=this.itemAnchor,s=this.baseAnchor,n=this.item.type==k.PointText;if("radialDistance"==this.channel)for(let n=0;n<t.length;n++){let r,a=e[n],o=t[n];a.type==k.Arc||a.type==k.Ring?r="top"==s?a.outerRadius+this.offset:"bottom"==s?a.innerRadius+this.offset:(a.outerRadius+a.innerRadius)/2+this.offset:a.type==k.Circle&&(r="top"==s?a.radius+this.offset:"bottom"==s?this.offset:a.radius/2+this.offset),o._doTranslate(a.x-o.x,a.y-r-o.bounds[i]),o._rotate?o._rotate=[o._rotate[0],a.x,a.y]:o._rotate=[0,a.x,a.y]}else if("angle"==this.channel)for(let n=0;n<t.length;n++){let r,a=e[n],o=t[n];r=a.type==k.Arc?"left"==s?a.endAngle+this.offset:"center"==s?a.startAngle+a.angle/2+this.offset:a.startAngle+this.offset:90,o._rotate?o._rotate[0]=90-r:(o._doTranslate(a.x-o.bounds[i],a.y-t[n].y),o._rotate=[90-r,e[n].x,e[n].y])}else{let r;if(this.baseItem.type==k.Link)switch(s){case"left":case"top":r=0;break;case"center":case"middle":r=.5;break;case"right":case"bottom":r=1}for(let a=0;a<t.length;a++){let o=this.baseItem.type==k.Link?e[a].getPointAt(r)[this.channel]:e[a].bounds[s]+this.offset;n?(t[a].anchor["x"==this.channel?0:1]=this.itemAnchor,t[a][this.channel]=o):"x"==this.channel?t[a]._doTranslate(o-t[a].bounds[i],0):t[a]._doTranslate(0,o-t[a].bounds[i])}}this.item.getScene()._updateAncestorBounds(this.item),this.baseItem.getScene()._updateAncestorBounds(this.baseItem)}toJSON(){let t={};return t.item=this.item.id,t.baseItem=this.baseItem.id,t.channel=this.channel,t.itemAnchor=this.itemAnchor,t.baseAnchor=this.baseAnchor,t.offset=this.offset,t.type="affixation",t.id=this.id,t}}class N_ extends Jg{constructor(t,e,i){super(),this.type=k.Gridlines,this.id=this.type+Fg[this.type]++,this.encoding=t,this.channel=this.encoding.channel,this._item=e,this._strokeColor="strokeColor"in i?i.strokeColor:"#ddd",this._strokeWidth="strokeWidth"in i?i.strokeWidth:1,"radialDistance"==this.channel&&"angle"in i&&(this._rotate=[-i.angle,this.encoding.x,this.encoding.y])}toJSON(){let t=super.toJSON();return t.type=this.type,t.id=this.id,"args"in t||(t.args={}),t.args.item=this._item.id,t.args.strokeColor=this._strokeColor,t.args.strokeWidth=this._strokeWidth,t.args.values=this._values,"time"===this.encoding.scale.type&&(t.args.isDate=!0),t.channel=this.encoding.channel,t.field=this.encoding.field,this._rotate&&(t.args.angle=this._rotate[0]),t}get values(){return this._values}set values(t){this._values=t,this.updateLines(),this.updateLinePositions()}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t;for(let e of this.children)e.strokeColor=t}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._strokeWidth=t;for(let e of this.children)e.strokeWidth=t}matches(t){let e=Cg(t).split("_")[0],i=this.encoding.scale.encodings;for(let t of i){if(Cg(t.anyItem).split("_")[0]===e)return!0}return!1}updateLinePositions(){let t=zg(this._item)?zg(this._item):Dg(this._item);if("x"==this.channel||"width"==this.channel){let e=t.bounds,i=this.encoding.getScaleRange(this._item);for(let[t,s]of this.children.entries()){let n=i[0]+this.encoding.scale.map(this._values[t])-this.encoding.scale.range[0];s._setVertices([[n,e.top],[n,e.bottom]])}}else if("y"==this.channel||"height"==this.channel){let e=t.bounds,i=this.encoding.getScaleRange(this._item);if(this.encoding.flip)for(let[t,s]of this.children.entries()){let n=i[1]-this.encoding.scale.map(this._values[t])+this.encoding.scale.range[0];s._setVertices([[e.left,n],[e.right,n]])}else for(let[t,s]of this.children.entries()){let n=i[0]-this.encoding.scale.map(this._values[t])+this.encoding.scale.range[0];s._setVertices([[e.left,n],[e.right,n]])}}else if("radialDistance"==this.channel)for(let[t,e]of this.children.entries())e.x=this._item.parent.x,e.y=this._item.parent.y,e.radius=this.encoding.scale.map(this._values[t]);for(let t of this.children)t._updateBounds();this._updateBounds()}updateLines(){if(this.children=[],"x"==this.channel||"y"==this.channel||"width"==this.channel||"height"==this.channel)for(let t=0;t<this._values.length;t++){let e=new q({strokeColor:this._strokeColor,fillColor:"none",strokeWidth:this._strokeWidth});e.type=k.Line,e.id=this.id+"line"+t,this.addChild(e)}else if("radialDistance"==this.channel)for(let t=0;t<this._values.length;t++){let e=new i_({strokeColor:this._strokeColor,fillColor:"none",strokeWidth:this._strokeWidth});e.type=k.Circle,e.id=this.id+"line"+t,this.addChild(e)}}}class B_ extends Jg{constructor(){super(),this.type=k.Collection,this._id=this.type+Fg[this.type]++,this.classId=this.id,this._childrenOrder=void 0}get childrenOrder(){return this._childrenOrder?this._childrenOrder:{field:"atlas_rowId",direction:"asc"}}set childrenOrder(t){if(!("field"in t)&&!("direction"in t))return;let e,i=t.field;if(this.dataScope.dataTable.hasField(i)){if(this._childrenOrder=t,i===a)e=(t,e)=>parseInt(t.dataScope.getFieldValue(i).substring(1))-parseInt(e.dataScope.getFieldValue(i).substring(1));else{switch(this.children[0].dataScope.getFieldType(i)){case S.Date:break;case S.Number:case S.Integer:e=(t,e)=>t.dataScope.aggregateNumericalField(i)-e.dataScope.aggregateNumericalField(i);break;case S.String:e=t.ranking?(e,s)=>t.ranking.indexOf(e.dataScope.getFieldValue(i))-t.ranking.indexOf(s.dataScope.getFieldValue(i)):(t,e)=>t.dataScope.getFieldValue(i)<e.dataScope.getFieldValue(i)?-1:1}}this.children.sort(e),"desc"==t.direction&&this.children.reverse(),this.layout&&this.layout.run()}else console.warn("Cannot order collection children by an non-existent field",t.field)}duplicate(){let t=this.getScene().collection();for(let e=0;e<this.children.length;e++){let i=this.children[e];t.addChild(i.duplicate())}if(t.classId=this.classId,this.parent.addChild(t),this._layout){let e=this._layout.clone();t.layout=e}return t}contains(t,e){if([k.Arc,k.Pie,k.Polygon,k.Area].indexOf(this.firstChild.type)>=0){let i=this.getSVGPathData();if(""!==i){let s=jg.getContext(),n=new Path2D(i);return s.lineWidth=Math.max(this.strokeWidth,2.5),s.stroke(n),s.isPointInPath(n,t,e)}}return this._bounds||this._updateBounds(),this._bounds.contains(t,e)}getSVGPathData(){let t="";for(let e of this.children)if(e.getSVGPathData)t+=e.getSVGPathData();else if(e.bounds){let i=e.bounds;t+=["M",i.left,i.top].join(" "),t+=["L",i.right,i.top].join(" "),t+=["L",i.right,i.bottom].join(" "),t+=["L",i.left,i.bottom,"Z"].join(" ")}return t}}class F_ extends q{constructor(t){super(t),this._type=k.Arc,this.closed=!0,this._x="x"in t?t.x:0,this._y="y"in t?t.y:0,this._innerRadius="innerRadius"in t?t.innerRadius:100,this._outerRadius="outerRadius"in t?t.outerRadius:200,this._startAngle="startAngle"in t?t.startAngle:0,this._endAngle="endAngle"in t?t.endAngle:90,this._sr=Yg(this._startAngle),this._er=Yg(this._endAngle);let e=this._x+this._innerRadius*Math.cos(this._sr),i=this._y-this._innerRadius*Math.sin(this._sr),s=this._x+this._innerRadius*Math.cos(this._er),n=this._y-this._innerRadius*Math.sin(this._er),r=this._x+this._outerRadius*Math.cos(this._sr),a=this._y-this._outerRadius*Math.sin(this._sr),o=this._x+this._outerRadius*Math.cos(this._er),h=this._y-this._outerRadius*Math.sin(this._er);this._setVertices([[e,i],[r,a],[o,h],[s,n]])}get type(){return 0===this._innerRadius?k.Pie:k.Arc}set type(t){this._type=t}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}get outerRadius(){return this._outerRadius}get thickness(){return this._outerRadius-this._innerRadius}set outerRadius(t){this._outerRadius=t,this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this._updateBounds()}get x(){return this._x}get y(){return this._y}get center(){return new W(this._x,this._y)}set x(t){this._x=t,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this._updateBounds()}set y(t){this._y=t,this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}get startAngle(){return this._startAngle}get endAngle(){return this._endAngle}get angle(){return this._endAngle<this._startAngle?this._endAngle+360-this._startAngle:this._endAngle-this._startAngle}sweepOver(t){let e=this.startAngle,i=this.endAngle;i<e&&(i+=360);let s=t.startAngle,n=t.endAngle;return n<s&&(n+=360),s>=e&&s<=i&&n>=e&&n<=i}_doTranslate(t,e){this._x+=t,this._y+=e,this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er),this._updateBounds()}_updateBounds(){this._bounds=new n(this._x-this._outerRadius,this._y-this._outerRadius,2*this._outerRadius,2*this._outerRadius)}copyPropertiesTo(t){super.copyPropertiesTo(t),t._x=this._x,t._y=this._y,t._innerRadius=this._innerRadius,t._outerRadius=this._outerRadius,t._startAngle=this._startAngle,t._endAngle=this._endAngle,t._sr=this._sr,t._er=this._er}getSVGPathData(){let t=this._endAngle<this._startAngle?this._endAngle+360-this._startAngle:this._endAngle-this._startAngle,e=t>180?1:0;return["M "+this.vertices[0].x+", "+this.vertices[0].y,"L "+this.vertices[1].x+", "+this.vertices[1].y,"A "+[this._outerRadius,this._outerRadius,t,e,0,this.vertices[2].x,this.vertices[2].y].join(" "),"L "+this.vertices[3].x+", "+this.vertices[3].y,"A "+[this._innerRadius,this._innerRadius,t,e,1,this.vertices[0].x,this.vertices[0].y].join(" ")].join(" ")}adjustAngle(t,e){this._startAngle=t,this._endAngle=e,this._sr=Yg(this._startAngle),this._er=Yg(this._endAngle),this.vertices[0].x=this._x+this._innerRadius*Math.cos(this._sr),this.vertices[0].y=this._y-this._innerRadius*Math.sin(this._sr),this.vertices[1].x=this._x+this._outerRadius*Math.cos(this._sr),this.vertices[1].y=this._y-this._outerRadius*Math.sin(this._sr),this.vertices[2].x=this._x+this._outerRadius*Math.cos(this._er),this.vertices[2].y=this._y-this._outerRadius*Math.sin(this._er),this.vertices[3].x=this._x+this._innerRadius*Math.cos(this._er),this.vertices[3].y=this._y-this._innerRadius*Math.sin(this._er)}}class P_ extends z{constructor(t){super(t),this.type=k.Image,this._src=t.src,this._x="x"in t?t.x:0,this._y="y"in t?t.y:0,this._width="width"in t?t.width:100,this._height="height"in t?t.height:100}toJSON(){let t=super.toJSON();return t.src=this._src,t.x=this._x,t.y=this._y,t.width=this._width,t.height=this._height,t}get src(){return this._src}set src(t){this._src=t}get width(){return this._width}set width(t){this._width=t,this._updateBounds()}get height(){return this._height}set height(t){this._height=t,this._updateBounds()}get x(){return this._x}set x(t){this._x=t,this._updateBounds()}get y(){return this._y}set y(t){this._y=t,this._updateBounds()}get bounds(){return this._bounds||this._updateBounds(),this._bounds}_updateBounds(){this._bounds=new n(this._x,this._y,this._width,this._height)}copyPropertiesTo(t){t.attrs=Object.assign({},this.attrs),t.styles=Object.assign({},this.styles),this._dataScope&&(t._dataScope=this._dataScope.clone()),t.x=this._x,t.y=this._y,t.width=this._width,t.height=this._height,t.src=this._src}_doTranslate(t,e){this._x+=t,this._y+=e,this._updateBounds()}}class V_ extends q{constructor(t){super(t),this.type=k.Link,this.linkMode="linkMode"in t?t.linkMode:"linear",this.source=void 0,this.target=void 0,this.directed="directed"in t&&t.directed,this.sourceAnchor="sourceAnchor"in t?t.sourceAnchor:["center","middle"],this.targetAnchor="targetAnchor"in t?t.targetAnchor:["center","middle"],this.sourceOffset="sourceOffset"in t?t.sourceOffset:[0,0],this.targetOffset="targetOffset"in t?t.targetOffset:[0,0]}radialvalue(t,e){let i=t-Math.PI/2;return[t=e*Math.cos(i),e*=Math.sin(t)]}bezierCurveHorizontal(t,e,i,s){return`M ${t} ${e} C ${(t+i)/2} ${e} ${t} ${s} ${i} ${s}`}bezierCurveVertical(t,e,i,s){return`M ${t} ${e} C ${t} ${(e+s)/2} ${i} ${e} ${i} ${s}`}bezierCurveRadial(t,e,i,s){let n=this.radialvalue(t,e),r=this.radialvalue(t,(e+s)/2),a=this.radialvalue(i,e),o=this.radialvalue(i,s);return`M ${n[0]} ${n[1]} C ${r[0]} ${r[1]} ${a[0]} ${a[1]} ${o[0]} ${o[1]}`}arc(t,e,i,s,n){let r=t,a=i,o=e,h=s;!this.directed&&t>i&&(r=i,a=t,o=s,h=e);let l=Math.abs(r-a)/2,c=Math.abs(o-h)/2,u=Math.max(l,c);return`M ${r} ${o} A ${u} ${u} 0 0 ${n?1:0} ${a} ${h}`}_updateBounds(){if(null!=this.source&&null!=this.target){let t=this.source.bounds[this.sourceAnchor[0]]+this.sourceOffset[0],e=this.source.bounds[this.sourceAnchor[1]]+this.sourceOffset[1],i=this.target.bounds[this.targetAnchor[0]]+this.targetOffset[0],s=this.target.bounds[this.targetAnchor[1]]+this.targetOffset[1];this._bounds=new n(Math.min(t,i),Math.min(e,s),Math.abs(t-i),Math.abs(e-s))}else this._bounds=new n(0,0,0,0)}getSVGPathData(){if(void 0===this.source||void 0===this.target)return"";let t=this.source.bounds[this.sourceAnchor[0]]+this.sourceOffset[0],e=this.source.bounds[this.sourceAnchor[1]]+this.sourceOffset[1],i=this.target.bounds[this.targetAnchor[0]]+this.targetOffset[0],s=this.target.bounds[this.targetAnchor[1]]+this.targetOffset[1];switch(this.linkMode){case"curveHorizontal":return this.bezierCurveHorizontal(t,e,i,s);case"curveVertical":return this.bezierCurveVertical(t,e,i,s);case"arcClockwise":return this.arc(t,e,i,s,!0);case"arcAntiClockwise":return this.arc(t,e,i,s,!1);default:return`M ${t} ${e} L ${i} ${s}`}}copyPropertiesTo(t){super.copyPropertiesTo(t),t.sourceAnchor=this.sourceAnchor.slice(),t.targetAnchor=this.targetAnchor.slice(),t.sourceOffset=this.sourceOffset.slice(),t.targetOffset=this.targetOffset.slice(),t.linkMode=this.linkMode}getPointAt(t){const e=Lg.getSVG();let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",this.getSVGPathData()),e.appendChild(i);let s=i.getTotalLength();return i.getPointAtLength(s*t)}}function j_(t,e,i,s){let n=s.getFieldType(i);if(n!=S.String&&n!=S.Date&&n!=S.Integer)throw new Error(P.REPOPULATE_BY_NONCAT+": "+i+" is "+n);if(e.parent&&e.parent.dataScope&&!e.parent.dataScope.isFullTable()&&e.parent.dataScope.dataTable!=s)throw new Error(P.REPOPULATE_DT_MISMATCH);return function(t,e,i,s){let n=vg(e.parent,t);1===n.length&&(e.parent.dataScope=void 0);for(let t of n){let e=s.getFieldSummary(i).unique.map((e=>t.dataScope?t.dataScope.cross(i,e):new Hg(s).cross(i,e)));e=e.filter((t=>!t.isEmpty()));const n=e.length-t.children.length,r=t.children.length-e.length;for(let e=0;e<r;e++)t.removeChildAt(t.children.length-1);const a=t.children.length;for(let e=0;e<n;e++){let e=t.children[Math.floor(Math.random()*a)].duplicate();t.addChild(e)}t.children.forEach(((t,i)=>t.dataScope=e[i]))}t._relayoutAncestors(e)}(t,e,i,s)}function L_(t,e){let i=t.item;if(e.innerRadius===i.outerRadius&&i.sweepOver(e))t.children.push({item:e,children:[]});else if(t.children&&t.children.length>0&&e.innerRadius>i.outerRadius&&i.sweepOver(e))for(let i of t.children)L_(i,e)}function D_(t,e,i,s){let n=t.item;if(n.innerRadius=e,n.outerRadius=e+s.map(i[n.id]),t.children&&t.children.length>0)for(let e of t.children)D_(e,n.outerRadius,i,s)}const z_="_depth";class G_{constructor(t,e){this._type="tree";let i=[],s=[];this._nodeHash={},this._traverse(t,i,s),this._nodeTable=new x_(i,"nodes"),this._linkTable=new x_(s,"links"),this._nodeTable.tree=this,this._linkTable.tree=this,this._data=t}get type(){return this._type}_traverse(t,e,i,s=0){let n={};r in t||(t[r]="n"+e.length),e.push(n),t[z_]=s;for(let a in t)if("children"==a&&t[a]&&t[a].length>0)for(let n of t[a]){let a=this._traverse(n,e,i,s+1);i.push({parent:t[r],child:a})}else n[a]=t[a];return this._nodeHash[n[r]]=n,n[r]}getParent(t){let e,i=t[r],s=this._linkTable.data,n=this._nodeTable.data;for(let t in s)if(s[t].child==i){e=s[t].parent;let i=n.findIndex((t=>t[r]==e));return n[i]}}getChildren(t){let e=t[r],i=[],s=this._linkTable.data,n=this._nodeTable.data;for(let t in s)if(s[t].parent==e){let e=s[t].child,a=n.findIndex((t=>t[r]==e));i.push(n[a])}return i}getNodeDataScope(t){return new Hg(this._nodeTable).cross(a,t[a])}getMaxDepth(){return this._nodeTable._fieldSummaries[z_].max}getRoot(){return this._nodeTable.data[0]}get nodeTable(){return this._nodeTable}get linkTable(){return this._linkTable}getNode(t){return this._nodeTable.data.filter((e=>e[r]==t))[0]}sumLeaves(t,e){if(!t)return 0;let i=t[r],s=[];if(s=this.getChildren(t),s&&s.length>0){let t=0;for(let i of s)t+=this.sumLeaves(i,e);this.getNode(i)["sum"+e]=t}else this.getNode(i)["sum"+e]=t[e];return t["sum"+e]}countLeaves(t,e){if(!t)return 0;let i=t[r],s=[];s=this.getChildren(t);let n=0;if(s&&s.length>0)for(let t of s)n+=this.countLeaves(t,e);else n=1;return this.getNode(i)["count"+e]=n,t["count"+e]}averageLeaves(t,e){if(!t)return 0;let i=t[r],s=[];s=this.getChildren(t);let n=0;if(s&&s.length>0){for(let t of s)n+=this.averageLeaves(t,e);n/=s.length,this.getNode(i)["average"+e]=n}else this.getNode(i)["average"+e]=t[e];return t["average"+e]}medianLeaves(t,e){if(!t)return 0;let i=t[r],s=[];s=this.getChildren(t);let n=[];if(s&&s.length>0){for(let t of s)n.push(this.medianLeaves(t,e));n.sort((function(t,e){return t-e}));let t=Math.floor(n.length/2);n.length%2?this.getNode(i)["median"+e]=n[t]:this.getNode(i)["median"+e]=(n[t-1]+n[t])/2}else this.getNode(i)["median"+e]=t[e];return t["median"+e]}maxLeaves(t,e){if(!t)return 0;let i=t[r],s=[];s=this.getChildren(t);let n=[];if(s&&s.length>0){for(let t of s)n.push(this.maxLeaves(t,e));this.getNode(i)["max"+e]=Math.max(...n)}else this.getNode(i)["max"+e]=t[e];return t["max"+e]}minLeaves(t,e){if(!t)return 0;let i=t[r],s=[];s=this.getChildren(t);let n=[];if(s&&s.length>0){for(let t of s)n.push(this.minLeaves(t,e));this.getNode(i)["min"+e]=Math.min(...n)}else this.getNode(i)["min"+e]=t[e];return t["min"+e]}aggregateFromLeaves(t,e){let i=this.getRoot();switch(e){case"sum":this.sumLeaves(i,t);break;case"count":this.countLeaves(i,t);break;case"average":this.averageLeaves(i,t);break;case"median":this.medianLeaves(i,t);break;case"max":this.maxLeaves(i,t);break;case"min":this.minLeaves(i,t)}}}function W_(t,e,i,s,n){switch(e.type){case k.Circle:return function(t,e,i,s,n){let r,a=i||v.Outward,o=s||50;if(a!==v.Inward&&a!==v.Outward)throw P.UNKNOWN_DIRECTION+" "+a;let h,l=vg(e,t);return l.forEach((i=>{let s=t.collection();s.dataScope=void 0,null==h&&(h=s.id),s.classId=h;let l=i.parent;Y_(i,e.id,a,o,n,n.getRoot(),s,t,!0),s.layout=new pg({direction:a,rootMark:i}),l.addChild(s),i===e&&(r=s)})),r}(t,e,i,s,n);case k.Rect:return function(t,e,i,s,n){let r,a=i||v.Down,o=s||50;if([v.Up,v.Down,v.Left,v.Right].indexOf(a)<0)throw P.UNKNOWN_DIRECTION+" "+a;let h,l=vg(e,t);return l.forEach((i=>{let s=t.collection();s.dataScope=void 0,null==h&&(h=s.id),s.classId=h;let l=i.parent;U_(i,e.id,a,o,n,n.getRoot(),s,t,!0),s.layout=new pg({direction:a,rootMark:i}),l.addChild(s),i===e&&(r=s)})),r}(t,e,i,s,n)}}function Y_(t,e,i,s,n,r,a,o,h){h&&(t.dataScope=n.getNodeDataScope(r),t.classId=e,a.addChild(t));let l=n.getChildren(r);if(0===l.length)return;let c=t.type===k.Circle||t.type===k.Ring?90:t.startAngle,u=(t.type===k.Circle||t.type===k.Ring?360:t.angle)/l.length;for(let r=0;r<l.length;r++){let h,d=t.type===k.Circle?t.radius:t.outerRadius;h=360===u?o.mark("ring",{innerRadius:d,outerRadius:d+s,x:t.x,y:t.y,strokeColor:t.strokeColor,fillColor:t.fillColor,strokeWidth:t.strokeWidth,opacity:t.opacity}):o.mark("arc",{innerRadius:d,outerRadius:d+s,x:t.x,y:t.y,startAngle:Q(c+u*r),endAngle:Q(c+u*(r+1)),strokeColor:t.strokeColor,fillColor:t.fillColor,strokeWidth:t.strokeWidth,opacity:t.opacity}),h.dataScope=n.getNodeDataScope(l[r]),h.classId=e,a.addChild(h),Y_(h,e,i,s,n,l[r],a,o)}}function U_(t,e,i,s,n,r,a,o,h){h&&(t.dataScope=n.getNodeDataScope(r),t.classId=e,a.addChild(t));let l,c,u,d=n.getChildren(r);if(0!==d.length){switch(i){case v.Up:case v.Down:case v.Left:case v.Right:}l=t.left,c=t.bottom,u=t.width/d.length;for(let r=0;r<d.length;r++){let h=o.mark("rect",{left:l,top:c,width:u,height:s,strokeColor:t.strokeColor,fillColor:t.fillColor,strokeWidth:t.strokeWidth,opacity:t.opacity});l+=u,h.dataScope=n.getNodeDataScope(d[r]),h.classId=e,a.addChild(h),U_(h,e,i,s,n,d[r],a,o)}}}function q_(t){return t.type===k.Collection&&!(t.children.length<2)}class J_ extends Jg{constructor(t){super(),t&&t.fillColor&&(this.fillColor=t.fillColor),this.type=k.Scene,this._id=this.type+Fg[this.type]++,this.encodings={},this.constraints={},this._itemMap={},this._interactions=[],this._interactionsObj={}}clear(){this.removeAll(),this.encodings={},this.constraints={},this._itemMap={}}group(t){let e=new Jg;if(e.classId=e.id,this.addChild(e),t&&t.length>0)for(let i of t)e.addChild(i);return this._itemMap[e.id]=e,e}mark(t,e){let i=void 0===e?{}:e,s=null;switch(i.type=t,t){case k.Rect:{"top"in i||(i.top=0),"left"in i||(i.left=0),"width"in i||(i.width=100),"height"in i||(i.height=100);let t=i.top,e=i.left,n=i.width,r=i.height;i.vertices=[[e,t],[e+n,t],[e+n,t+r],[e,t+r]],delete i.top,delete i.left,delete i.width,delete i.height,"fillColor"in i||(i.fillColor="none"),s=new e_(i);break}case k.Area:if(void 0!==i&&"x1"in i&&"y1"in i&&"x2"in i&&"y2"in i){let t=i.x1,e=i.y1,s=i.x2,n=i.y2;i.vertices=[[t,e],[s,e],[s,n],[t,n]],delete i.x1,delete i.y1,delete i.x2,delete i.y2}s=new T_(i);break;case k.Line:if(void 0!==i&&"x1"in i&&"y1"in i&&"x2"in i&&"y2"in i){let t=i.x1,e=i.y1,s=i.x2,n=i.y2;i.vertices=[[t,e],[s,n]],delete i.x1,delete i.y1,delete i.x2,delete i.y2}s=new q(i),s.type=k.Line;break;case k.Path:s=new q(i);break;case k.Circle:s=new i_(i);break;case k.Ring:s=new I_(i);break;case k.Arc:case k.Pie:s=new F_(i);break;case k.Polygon:s=new O_(i);break;case"text":case k.PointText:"anchor"in i||(i.anchor=["center","middle"]),s=new s_(i);break;case k.Image:s=new P_(i);break;case k.Link:s=new V_(i)}return null!==s&&(s.id="id"in i?i.id:s.type+Fg[s.type]++,s.classId=s.id,this.addChild(s),this._itemMap[s.id]=s),s}glyph(...t){let e=new A_(t);return e.classId=e.id,this.addChild(e),this._itemMap[e.id]=e,e}collection(){let t=new B_;return this.addChild(t),this._itemMap[t.id]=t,t}attach(t,e){t.dataScope=new Hg(e)}repeat(t,e,i){if(!t||void 0===e)throw P.INCOMPLETE_REPEAT_INFO;if(e.nodeTable&&e.linkTable){if(!Array.isArray(t)||2!==t.length)throw P.REPEAT_NODE_LINK;return function(t,e,i,s){let n=s.nodeTable.getFieldSummary(r).unique.map((t=>e.dataScope?e.dataScope.cross(r,t):new Hg(s.nodeTable).cross(r,t))),o=t.collection(),h=t.collection(),l={};h.dataScope=e.dataScope?e.dataScope.clone():new Hg(s.nodeTable),h.addChild(e);for(let t=1;t<n.length;t++){let t=e.duplicate();h.addChild(t)}h.children.forEach(((t,e)=>{t.dataScope=n[e],l[t.dataScope.getFieldValue(r)]=t}));let c=s.linkTable.getFieldSummary(a).unique.map((t=>i.dataScope?i.dataScope.cross(a,t):new Hg(s.linkTable).cross(a,t)));o.dataScope=i.dataScope?i.dataScope.clone():new Hg(s.linkTable),o.addChild(i);for(let t=1;t<c.length;t++){let t=i.duplicate();o.addChild(t)}o.children.forEach(((t,e)=>t.dataScope=c[e]));let u="tree"===s.type?"parent":"source",d="tree"===s.type?"child":"target";for(let t of o.children){let e=t.dataScope.getFieldValue(u),i=t.dataScope.getFieldValue(d);t.source=l[e],t.target=l[i],t._updateBounds()}return[h,o]}(this,t[0],t[1],e)}{let s=i||{},n=s.field?s.field:x_.RowID,r=s.callback;K(n,e);let a=$g(this,t,n,e,r);return s.layout&&(a.layout=s.layout),a}}repopulate(t,e,i){if(!t||void 0===e)throw P.INCOMPLETE_REPEAT_INFO;let s=i||{},n=s.field?s.field:x_.RowID;K(n,e),j_(this,t,n,e)}densify(t,e,i){if(!t||void 0===e)throw P.INCOMPLETE_PARTITION_INFO;let s=i||{},n=s.orientation,r=s.field?s.field:x_.RowID,a="startAngle"in s?s.startAngle:90,o="direction"in s?s.direction:"clockwise",h=s.callback;K(r,e);let l=t_(this,t,n,r,e,h,a,o);return d_(t,l),l}stratify(t,e,i){if(!(e instanceof G_))throw P.STRATIFY_WITHOUT_TREE;if(t.type!==k.Circle&&t.type!==k.Rect)throw P.STRATIFY_WRONG_ITEM;let s=i||{};return W_(this,t,s.direction,s.size,e)}divide(t,e,i){if(!t||null==e)throw P.INCOMPLETE_PARTITION_INFO;let s=i||{},n=s.orientation,r=s.field?s.field:x_.RowID,a=s.callback;K(r,e);let o=Kg(this,t,n,r,e,a);return s.layout&&(o.layout=s.layout),u_(t,o),o}classify(t,e){if(!q_(t))throw P.CANNOT_CLASSIFY+t.type;let i=e||{},s=i.field?i.field:x_.RowID,n=t.firstChild.dataScope.dataTable,r=i.layout;return K(s,n),function(t,e,i,s){let n=vg(e,t);for(let e of n){let s,n={},r=e.children;for(let t of r){let e=t.dataScope.getFieldValue(i);e in n||(n[e]=[]),n[e].push(t)}let a=r[0].dataScope._dt;for(let r in n){let o=t.collection();e.addChild(o),void 0===s&&(s=o.id),o.classId=s,o.dataScope=e.dataScope?e.dataScope.cross(i,r):new Hg(a).cross(i,r);for(let t of n[r])o.addChild(t)}}s&&t.setProperties(e.firstChild,{layout:s})}(this,t,s,r),t}_validateEncodeArgs(t,e){if(!t||!("channel"in e)||!("field"in e))throw P.INCOMPLETE_BINDING_INFO;let i=e.field;if("vertex"==t.type||"segment"==t.type){if(!t.parent.dataScope&&!t.dataScope)throw P.BIND_WITHOUT_DATASCOPE}else if(!t.dataScope)throw P.BIND_WITHOUT_DATASCOPE;let s=e.table?e.table:t.dataScope?t.dataScope._dt:t.parent.dataScope._dt,n=s.getFieldType(i);if("fillGradient"===e.channel&&[S.String,S.Boolean,S.Date].indexOf(n)>=0)throw P.UNSUPPORTED_FIELDTYPE+e.channel+": "+n;K(i,s)}encode(t,e){let i,s=Array.isArray(t)?t:[t],n=[];for(let r of s){let s;if([k.Pie,k.Arc].indexOf(t.type)>=0&&"angle"===e.channel){let i=t.parent;if(i.type===k.Collection&&i.layout&&i.layout.orientation===y.Angular){n.push(this._encodeWithinCollection(r,e));continue}}if(this._validateEncodeArgs(r,e),"vertex"==r.type&&r.parent.type==k.Area){let t=vg(r.parent,this);s=[];let e=r.parent.vertices.indexOf(r)<r.parent.vertices.length/2;for(let i of t)s=e?s.concat(i.vertices.slice(0,i.vertices.length/2)):s.concat(i.vertices.slice(i.vertices.length/2))}else s=vg(r,this);if(1===s.length&&s[0].type===k.Area&&("x"===e.channel||"y"===e.channel))return void console.warn("Only 1 "+r.type+" found, cannot encode "+e.field);!e.scale&&i&&(e.scale=i);let a=this._doEncode(s,e);i||(i=a.scale),n.push(a)}return n.length>1?n:n[0]}_doEncode(t,e){let i=t[0],s=e.channel,n=e.field;"datatable"in e||(e.datatable=i.dataScope?i.dataScope.dataTable:i.parent.dataScope.dataTable),"aggregator"in e||(e.aggregator="mean"),"flipScale"in e||(e.flipScale=!1),"includeZero"in e||(e.includeZero=!1),"scaleType"in e||(e.scaleType="linear");let a=new m_(t,this,s,n,e);switch(s){case"width":case"height":case"radius":case"outerRadius":case"innerRadius":case"area":case"fontSize":i.type==k.Area?__(a):g_(a);break;case"strokeWidth":i.type==k.Link?function(t){t._query=function(){let t=this.field,e=this.channel,i=this.items.map((t=>t.dataScope));if("strokeWidth"==e)if(this.datatable.hasField(t))this.data=i.map((e=>e.getFieldValue(t)));else if(t.startsWith("parent.")||t.startsWith("child.")){let e=this.datatable.tree.nodeTable,s=t.split(".")[0],n=t.split(".")[1],a=i.map((t=>t.getFieldValue(s)));this.data=a.map((t=>new Hg(e).cross(r,t).getFieldValue(n)))}},t._map=function(){let t,e=this.channel,i=this.items;if("strokeWidth"==e){let e,s;t=new p_(this.scaleType),t.domain=[0,Math.max(...this.data)],e=1,s=Math.max(...i.map((t=>parseFloat(t.styles.strokeWidth)))),s==e&&(s=e+5),this.rangeExtent&&(s=e+this.rangeExtent),this.range&&(e=this.range[0],s=this.range[1]),t._setRange([e,s]),this.scale||(this.scale=t),this.scale._addEncoding(this)}},t._apply=function(){if("strokeWidth"==this.channel)for(let t=0;t<this.data.length;t++)this.items[t].styles.strokeWidth=this.scale.map(this.data[t])},t.run()}(a):g_(a);break;case"x":case"y":!function(t){t._query=function(){this.data=[];let t=this.field,e=this.items,i="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case S.Boolean:break;case S.Date:this.data=i.map((e=>e.getFieldValue(t)));break;case S.String:try{this.data=i.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=i.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){let t,e,i,s,n,r=this.channel,a=this.datatable.getFieldType(this.field),o=bg(this.anyItem);if(o&&o.type==m.Grid){let e=o.cellBounds;t="x"==r?e[0].width:e[0].height}else if("vertex"===this.anyItem.type&&this.anyItem.parent.type===k.Area)t="x"==r?this.anyItem.parent.bounds.width:this.anyItem.parent.bounds.height;else{let e=this.items.map((t=>t[r]));t=Math.max(...e)-Math.min(...e),t<100?t=100:t>500&&(t=500)}switch(a){case S.Boolean:break;case S.Date:if(e=Math.min(...this.data),i=Math.max(...this.data),s=[e,i],this.scale){let t=this.data;for(let e of this.scale.encodings)t=t.concat(e.data);s=[Math.min(...t),Math.max(...t)],n=this.scale.range}else this.scale=new p_("time"),this.scale.isFlipped=this._flipScale,n=[0,t],this.scale._baseItem=this.anyItem;break;case S.String:if(s=Array.from(new Set(this.data)),n=[0,t],this.scale){let t=this.scale.domain;for(let e of s)t.indexOf(e)<0&&t.push(e);s=t,n=this.scale.range}else this.scale=new p_("point"),this.scale.isFlipped=this._flipScale,n=[0,t],this.scale._baseItem=this.anyItem;break;default:if(e=Math.min(...this.data),i=Math.max(...this.data),s=[e,i],this.scale){let t=this.data;for(let e of this.scale.encodings)t=t.concat(e.data);s=[Math.min(...t),Math.max(...t)],n=this.scale.range}else this.scale=new p_(this.scaleType),this.scale.isFlipped=this._flipScale,this.scale.includeZero=this._includeZero,n=[0,t],this.scale._baseItem=this.anyItem;s[0]==s[1]&&(s[1]=1.1*s[0])}this.scale._scale.domain(s),this.scale._setRange(n),this.scale._addEncoding(this)},t._apply=function(){let t=[],e=this.channel;for(let e of this.scale.encodings)t=t.concat(e.items);if("x"==e){let i=bg(this.anyItem,"grid"),s=this.scale._baseItem?bg(this.scale._baseItem,"grid"):void 0;if(this.scale._baseItem&&!Eg(this.anyItem,this.scale._baseItem)&&i&&s&&i.numRows===s.numRows&&i.numCols===s.numCols){let t=s.group.bounds.left-i.group.bounds.left,n=0;i.group.getScene().translate(i.group,t,n),i._colGap=s.colGap;let r=this.items.map((t=>wg(t))),a=s.cellBounds;for(let t=0;t<this.items.length;t++){let i=this.items[t],s=a[r[t]].left+this.scale.map(this.data[t])-i[e],n=0;i._doTranslate(s,n),"vertex"!=i.type&&"segment"!=i.type||i.parent._updateBounds()}this.anyItem.parent.getScene()._updateAncestorBounds(this.anyItem,this.items)}else if(i&&i.type==m.Grid)for(let t=0;t<this.items.length;t++){let i=this.items[t],s=xg(i).left+this.scale.map(this.data[t])-i[e],n=0;i._doTranslate(s,n),"vertex"!=i.type&&"segment"!=i.type||i.parent._updateBounds()}else if("vertex"===this.anyItem.type&&this.anyItem.parent.type===k.Area){let t=Ag(this.items);void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t.bounds.left))));for(let t=0;t<this.items.length;t++){let i=this.items[t],s=i.parent.bounds.left+this.scale.map(this.data[t])-i[e],n=0;i._doTranslate(s,n),i.parent._updateBounds()}}else if("vertex"==this.anyItem.type||"segment"==this.anyItem.type){let t=Ag(this.items);void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t.bounds.left))));for(let t=0;t<this.items.length;t++){let i=this.items[t],s=this.scale.offset+this.scale.map(this.data[t])-i[e],n=0;i._doTranslate(s,n),i.parent._updateBounds()}}else{void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t[e])))),this.items[0].type===k.PointText&&this.items.forEach((t=>t.horzAnchor="center"));for(let t=0;t<this.items.length;t++){let i=this.items[t],s=this.scale.offset+this.scale.map(this.data[t])-i[e],n=0;i._doTranslate(s,n)}}}else{let i=bg(this.anyItem,"grid"),s=this.scale._baseItem?bg(this.scale._baseItem,"grid"):void 0;if(this.scale._baseItem&&!Eg(this.anyItem,this.scale._baseItem)&&i&&s&&i.numRows===s.numRows&&i.numCols===s.numCols){let t=0,n=s.group.bounds.top-i.group.bounds.top;i.group.getScene().translate(i.group,t,n),i._rowGap=s.rowGap;let r=this.items.map((t=>wg(t))),a=s.cellBounds;for(let t=0;t<this.items.length;t++){let i=this.items[t],s=0,n=a[r[t]].bottom-this.scale.map(this.data[t])-i[e];i._doTranslate(s,n),"vertex"!=i.type&&"segment"!=i.type||i.parent._updateBounds()}this.anyItem.parent.getScene()._updateAncestorBounds(this.anyItem,this.items)}else if(i&&i.type==m.Grid){let t=this.items.map((t=>xg(t)));for(let i=0;i<this.items.length;i++){let s=this.items[i],n=0,r=t[i].bottom-this.scale.map(this.data[i])-s[e];s._doTranslate(n,r),"vertex"!=s.type&&"segment"!=s.type||s.parent._updateBounds()}}else if("vertex"===this.anyItem.type&&this.anyItem.parent.type===k.Area){void 0===this.scale.offset&&(this.scale.offset=Math.min(...this.items.map((t=>t.y))));for(let t=0;t<this.items.length;t++){let i=this.items[t],s=0,n=i.parent.bounds.top+this.scale.rangeExtent-this.scale.map(this.data[t])-i[e];i._doTranslate(s,n),i.parent._updateBounds()}}else if("vertex"==this.anyItem.type||"segment"==this.anyItem.type){void 0===this.scale.offset&&(this.scale.offset=Math.min(...this.items.map((t=>t.y))));for(let t=0;t<this.items.length;t++){let i=this.items[t],s=0,n=this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-i[e];i._doTranslate(s,n),i.parent._updateBounds()}}else{void 0===this.scale.offset&&(this.scale.offset=Math.min(...t.map((t=>t.bounds.y)))),this.items[0].type===k.PointText&&this.items.forEach((t=>t.vertAnchor="middle"));for(let t=0;t<this.items.length;t++){let i=this.items[t],s=0,n=this.scale.offset+this.scale.rangeExtent-this.scale.map(this.data[t])-i.refBounds[e];i._doTranslate(s,n)}}}},t.run(),t.rangeExtent&&(t.scale.rangeExtent=t.rangeExtent)}(a);break;case"fillColor":case"strokeColor":!function(t){t._query=function(){this.data=[];let t=this.field,e=this.items,i="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case S.Boolean:this.data=[!0,!1];break;case S.Date:this.data=i.map((e=>e.getFieldValue(t)));break;case S.String:try{this.data=i.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=i.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){switch(this.datatable.getFieldType(this.field)){case S.Boolean:if(!this.scale&&(this.scale=new p_("ordinalColor"),this.scale.domain=this.data,this._mapping)){let t=this.scale.domain.map((t=>t in this._mapping?this._mapping[t]:"black"));this.scale._scale.range(t)}break;case S.String:if(this.scale)this.scale.domain=Array.from(new Set(this.scale.domain.concat(this.data)));else{let t={scheme:"schemeCategory10"};if(this._scheme&&(V.indexOf(this._scheme)>=0?t.scheme=this._scheme:(j.indexOf(this._scheme)>=0||L.indexOf(this._scheme)>=0)&&(t.scheme=this._scheme,t.size=this.data.length)),this.scale=new p_("ordinalColor",t),this.scale.domain=this.data,this._mapping){let t=this.scale.domain.map((t=>t in this._mapping?this._mapping[t]:"black"));this.scale._scale.range(t)}}break;default:if(this.scale){if(!this._mapping){let t=this.scale.domain.concat(this.data);this.scale.domain=[Math.min(...t),Math.max(...t)]}}else if(this._mapping)this.scale=new p_("linear",this._mapping);else{let t,e=Math.min(...this.data),i=Math.max(...this.data),s=Math.max(Math.abs(e),Math.abs(i));e<0&&i>0?(t="interpolatePuOr",e=-s,i=s,this.scale=new p_("divergingColor",this._scheme?this._scheme:t)):(t="interpolateTurbo",this.scale=new p_("sequentialColor",this._scheme?this._scheme:t)),this.scale.domain=[e,i]}}this.scale._addEncoding(this)},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);"vertex"==e.type||"segment"==e.type?e[this.channel]=i:e.styles[this.channel]=i,e.vertices&&"strokeColor"==this.channel&&e.vertices.forEach((t=>t.fillColor=i))}},t.run()}(a);break;case"fillGradient":i.type===k.Area&&__(a);break;case"angle":!function(t){t._query=function(){this.data=[],this.id2data={};let t=this.field,e=this.items;switch(this.datatable.getFieldType(t)){case S.Boolean:break;case S.Date:this.data=e.map((e=>e.dataScope.getFieldValue(t)));break;case S.String:break;default:this.data=e.map((e=>e.dataScope.aggregateNumericalField(t,this.aggregator)))}for(let t=0;t<this.data.length;t++)this.id2data[e[t].id]=this.data[t]},t._map=function(){this.scale||(this.scale=new p_("linear"),this.scale.domain=this.datatable.tree?[0,Math.max(...this.data)]:[0,this.data.reduce(((t,e)=>t+e),0)],this.scale._setRange([0,360]),this.scale._addEncoding(this))},t._apply=function(){let t;for(let e=0;e<this.items.length;e++)t=this.items[e],t.type!==k.Arc&&t.type!==k.Pie||t.adjustAngle(t.startAngle,Q(t.startAngle+this.scale.map(this.data[e])));this.scene._relayoutAncestors(this.anyItem,this.items)},t.run()}(a);break;case"text":!function(t){t._query=function(){this.data=[];let t,e,i=this.items;if(this.field.startsWith("parent.")||this.field.startsWith("child.")){e=this.datatable.tree.nodeTable,t=this.field.split(".")[1];let s=this.field.split(".")[0],n=i.map((t=>t.dataScope)).map((t=>t.getFieldValue(s)));e.getFieldType(t)==S.Integer||e.getFieldType(t)==S.Number?this.data=n.map((i=>new Hg(e).cross(r,i).aggregateNumericalField(t))):this.data=n.map((i=>new Hg(e).cross(r,i).getFieldValue(t)))}else e=this.datatable,t=this.field,e.getFieldType(t)==S.Integer||e.getFieldType(t)==S.Number?this.data=i.map((e=>e.dataScope.aggregateNumericalField(t,this.aggregator))):this.data=i.map((e=>e.dataScope.getFieldValue(t)))},t._map=function(){if(this.scale);else switch(this.datatable.getFieldType(this.field)){case S.Boolean:case S.Date:break;case S.String:default:this.scale=new p_("ordinal"),this.scale.domain=[...new Set(this.data)],this.scale._scale.range(this.scale.domain.map((t=>t+"")))}},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]);e.text=i}},t.run()}(a);break;case"radialDistance":!function(t){t._query=function(){this.data=[];let t=this.field,e=this.items,i="vertex"!=this.anyItem.type&&"segment"!=this.anyItem.type||this.anyItem.dataScope?e.map((t=>t.dataScope)):e.map((t=>t.parent.dataScope));switch(this.datatable.getFieldType(t)){case S.Boolean:break;case S.Date:this.data=i.map((e=>e.getFieldValue(t)));break;case S.String:try{this.data=i.map((e=>e.getFieldValue(t)))}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:this.data=i.map((e=>e.aggregateNumericalField(t,this.aggregator)))}},t._map=function(){let t=this.data;this.scale||(this.scale=new p_("linear"),this.scale.domain=[0,Math.max(...t)],this.scale._setRange([0,this.anyItem.parent.radius])),this.scale._addEncoding(this)},t._apply=function(){for(let t=0;t<this.items.length;t++){let e=this.items[t],i=this.scale.map(this.data[t]),s=Gg(this.anyItem.parent.x,this.anyItem.parent.y,i,e.polarAngle);e.x=s[0],e.y=s[1]}this.scene._relayoutAncestors(this.anyItem,this.items)},t.run()}(a);break;case"thickness":!function(t){t._query=function(){this.data={};let t=this.field,e=this.items,i=e.map((t=>t.dataScope));switch(this.datatable.getFieldType(t)){case S.Boolean:break;case S.Date:for(let s=0;s<e.length;s++)this.data[e[s].id]=i[s].getFieldValue(t);break;case S.String:try{for(let s=0;s<e.length;s++)this.data[e[s].id]=i[s].getFieldValue(t)}catch(e){throw new Error("Cannot bind "+this.channel+" to "+t+" : "+e)}break;default:for(let s=0;s<e.length;s++)this.data[e[s].id]=i[s].aggregateNumericalField(t,this.aggregator)}},t._map=function(){let t=this.data;if(!this.scale){this.scale=new p_(this.scaleType),this.scale.domain=[0,Math.max(...Object.values(t))];let e=1,i=this.rangeExtent?e+this.rangeExtent:Math.max(...this.items.map((t=>t.outerRadius)));this.scale._setRange([e,i])}this.scale._addEncoding(this)},t._apply=function(){this.items.sort(((t,e)=>(t.innerRadius+t.outerRadius)/2-(e.innerRadius+e.outerRadius)/2));let t=Math.min(...this.items.map((t=>t.innerRadius))),e={item:new F_({outerRadius:t,startAngle:0,endAngle:360}),children:[]};for(let t of this.items)L_(e,t);for(let t of e.children)D_(t,t.item.innerRadius,this.data,this.scale)},t.run()}(a)}return"_remember"in e&&1!=e._remember||this._registerBinding(a),s.indexOf("Color")<0&&this._updateAncestorBounds(i,a.items),a}_encodeWithinCollection(t,e){this._validateEncodeArgs(t,e);let i=function(t,e){let i={},s=vg(t,e);for(let t of s){let e=t.parent.id;e in i||(i[e]=[]),i[e].push(t)}return Object.keys(i).map((t=>i[t]))}(t,this),s=[];for(let t of i){let i=this._doEncode(t,e);s.push(i)}return s}getPeers(t){return vg(t,this)}find(t){return _g(this,t)}align(t,e){if(!function(t,e,i){if(e==b.Top||e==b.Bottom||e==b.Middle){for(let e of t)if(!Vg(e,i))return!1;return!0}if(e==b.Left||e==b.Right||e==b.Center){for(let e of t)if(!Pg(e,i))return!1;return!0}}(t,e,this))return!1;let i=new R_(t,e);if(i.id in this.constraints)return console.warn("constraint has been added"),!1;this.constraints[i.id]=i,i.apply(),this._updateAncestorBounds(t[0])}removeAllConstraints(){this.constraints={}}removeConstraint(t){delete this.constraints[t.id]}getRelatedConstraints(t){let e=[];for(let i in this.constraints){let s=this.constraints[i];if(s.type===x)s._itemIds===t.map((t=>t.classId)).sort().join("_")&&e.push(s)}return e}affix(t,e,i,s){let n=s||{},r="offset"in n?n.offset:0,a="itemAnchor"in n?n.itemAnchor:"x"==i||"angle"==i?"center":"middle",o="baseAnchor"in n?n.baseAnchor:"x"==i||"angle"==i?"center":"middle",h=new M_(t,e,this,i,a,o,r);h.id,this.constraints,this.constraints[h.id]=h,h.apply()}axis(t,e,i){let s=i||{},n=s.item?this.getEncodingByItem(s.item,t):this.getEncodingByField(e,t);if(n&&n.field===e){if(n.datatable.getFieldType(e)!==S.Date||"labelFormat"in s||(s.labelFormat="%m/%d/%y"),"width"===n.channel){let t=this.children.filter((t=>t.type===k.Axis)).map((t=>t.channel));"orientation"in s||(s.orientation=t.indexOf("x")>=0?"top":"bottom")}else if("height"===n.channel){let t=this.children.filter((t=>t.type===k.Axis)).map((t=>t.channel));"orientation"in s||(s.orientation=t.indexOf("y")>=0?"right":"left")}let t=new C_(n,s.item?s.item:n.anyItem,s);return"tickValues"in s?(t.tickValues=s.tickValues,t.labelValues=s.tickValues):(t.tickValues=n._inferTickValues(),t.labelValues=n._inferTickValues()),this.addChildAt(t,0),this._itemMap[t.id]=t,this._updateBounds(),t}let r=s.item?s.item:_g(this,[{field:e}])[0];if(void 0===r)return void console.warn(B+e);let a=bg(r);if(a&&(a.type===m.Grid||a.type===m.Stack)){if(a&&("x"==t||"y"==t)){let i,n,r=vg(a.group,this);for(let a of r){let r=_g(a,[{field:e}])[0],o=vg(r,a);r.dataScope.dataTable.getFieldType(e)!==S.Date||"labelFormat"in s||(s.labelFormat="%m/%d/%y"),i=new r_(o,a.layout,t,e,s),null==n&&(n=i.id),i.classId=n,this.addChildAt(i,0),this._itemMap[i.id]=i}return this._updateBounds(),i}console.warn(B+e)}}getRelatedAxes(t){let e=[];if(Rg(t))return e;for(let i of this.children){if(i.type!==k.Axis)continue;if(i.matches(t)){e.push(i);continue}let s=i._item,n=!1;for(;s.children&&s.children.length>0;){for(let r of s.children)if(r.classId===Cg(t).split("_")[0]){n=!0,e.push(i);break}if(n)break;s=s.children[0]}let r=Tg(t),a={};for(let t of r)t.classId in a||(a[t.classId]=t);let o=Object.values(a);for(let t of o)if(i.matches(t)){e.push(i);break}}return e}removeItem(t){if(!Rg(t)){let e=this.getRelatedEncodings(t);for(let t of e)this.removeEncoding(t);let i=this.getRelatedAxes(t);for(let t of i)this.removeItem(t);for(let e of this.getRelatedGridlines(t))this.removeItem(e)}delete this._itemMap[t.id],this.removeChild(t),this._updateBounds()}getRelatedEncodings(t){let e=[],i=t;for(;i;)if(e.push(Cg(i)),i.type==k.Collection)i=i.firstChild;else if(i.type==k.Glyph){for(let t of i.children)e.push(Cg(t));i=void 0}else i=void 0;let s=Object.keys(this.encodings),n=[];for(let t of s){let i=t.split("_")[0];if(e.indexOf(i)>=0)for(let e in this.encodings[t])n.push(this.encodings[t][e])}return n}removeAllEncodings(){this.encodings={},this.removeAllItemsByType(k.Axis),this.removeAllItemsByType(k.Legend),this.removeAllItemsByType(k.Gridlines)}removeEncoding(t){let e=Cg(t.anyItem);delete this.encodings[e][t.channel],0===Object.keys(this.encodings[e]).length&&delete this.encodings[e];let i=[];for(let e of this.children)Rg(e)&&e.encoding&&e.encoding===t&&i.push(e);for(let t of i)this.removeItem(t);this._updateBounds()}removeAllItemsByType(t){let e=[];for(let i of this.children)i.type===t&&e.push(i);for(let t of e)this.removeItem(t);this._updateBounds()}reCreateRelatedAxes(t){let e=this.getRelatedAxes(t),i=[];e.forEach((t=>{let e=t.toJSON().args;e.item&&(e.item=this.getItem(e.item)),delete e.tickValues,delete e.labelValues,this.removeItem(t),t instanceof r_?i.indexOf(t.classId)<0&&(this.axis(t.channel,t.field,e),i.push(t.classId)):this.axis(t.channel,t.field,e)})),this._updateBounds()}reCreateRelatedLegends(t){this.getRelatedLegends(t).forEach((t=>{let e=t.toJSON().args;e.item&&(e.item=this.getItem(e.item)),this.removeItem(t),this.legend(t.channel,t.field,e)})),this._updateBounds()}legend(t,e,i){let s=i||{},n=this.getEncodingByField(e,t);if(!n)throw P.INCORRECT_LEGEND_INFO+e;"x"in s||(s.x=100),"y"in s||(s.y=100);let r=new E_(n,s);return this.addChild(r),this._itemMap[r.id]=r,this._updateBounds(),r}gridlines(t,e,i){let s=this.getEncodingByField(e,t),n=i||{};if(!s)return!1;let r=new N_(s,n.item?n.item:s.anyItem,n);return r.values="values"in n?n.values:s._inferTickValues(),this.addChildAt(r,0),this._itemMap[r.id]=r,this._updateBounds(),r}getRelatedLegends(t){let e=[];if(Rg(t))return e;for(let i of this.children)i.type===k.Legend&&i.matches(t)&&e.push(i);return e}getRelatedGridlines(t){let e=[];if(Rg(t))return e;for(let i of this.children){if(i.type!==k.Gridlines)continue;if(i.matches(t)){e.push(i);continue}let s=i._item,n=!1;for(;s.children&&s.children.length>0;){for(let r of s.children)if(r.classId===t.classId){n=!0,e.push(i);break}if(n)break;s=s.children[0]}let r=Tg(t),a={};for(let t of r)t.classId in a||(a[t.classId]=t);let o=Object.values(a);for(let t of o)if(i.matches(t)){e.push(i);break}}return e}propagate(t,e,...i){let s=vg(t,this);for(let t of s)t[e](...i)}getEncodingByItem(t,e){let i=this.encodings[Cg(t)];return i&&i[e]?i[e]:null}getEncodingByField(t,e){for(let i in this.encodings){let s=this.encodings[i];if(s[e]&&s[e].field==t)return s[e]}return null}positionBound(t,e){let i=this.getEncodingByItem(t,e);if(i)return i;if(!Ng(t))return null;for(let i in this.encodings){if(i.split("_")[0]===t.classId&&e in this.encodings[i])return this.encodings[i][e]}}sizeBound(t,e){let i=this.getEncodingByItem(t,e);if(i)return i;if(Ng(t)){let i="width"===e||"height"===e||"radius"===e?["area"]:["width","height"],s="width"===e?["x"]:"height"===e?["y"]:["x","y"];for(let e in this.encodings){let n=e.split("_")[0];if(e.indexOf("_")<0){for(let s of i)if(n===t.classId&&s in this.encodings[e])return this.encodings[e][s]}else for(let i of s)if(n===t.classId&&i in this.encodings[e])return this.encodings[e][i]}}return null}setProperties(t,e){let i,s={};for(let t in e)s[t]=!0;if(Object.values(m).indexOf(t.type)>-1&&t.group){i=vg(t.group,this);for(let t of i)for(let i in e)t.layout[i]=e[i]}else if(i=vg(t,this),"vertex"===t.type)for(let t of i)for(let i in e)t[i]=e[i];else if(t instanceof z)for(let n in e)if("x"!==n&&"y"!==n||!this.positionBound(t,n))if("width"!==n&&"height"!==n&&"radius"!==n||!this.sizeBound(t,n))t.type!==k.Rect&&t.type!==k.Line||"width"!==n&&"height"!==n?t.type==k.Circle&&"radius"==n?i.forEach((t=>t.resize(2*e[n],2*e[n],e.xRef,e.yRef))):i.forEach((t=>t[n]=e[n])):"width"===n?i.forEach((t=>t.resize(e[n],t.bounds.height,e.xRef))):i.forEach((t=>t.resize(t.bounds.width,e[n],void 0,e.yRef)));else{let i=this.getEncodingByItem(t,n);i||"radius"!=n||(i=this.getEncodingByItem(t,"area"));let s=i.scale.rangeExtent*e[n]/t[n];i.scale.rangeExtent=s}else s[n]=!1;else if("collection"==t.type||"group"==t.type)for(let t of i)for(let i in e)t[i]="layout"===i&&void 0!==e[i]?e[i].clone():e[i];let n=Object.keys(s).filter((t=>s[t])),r=["width","height","fontSize","area","radius"];for(let e of r)if(n.indexOf(e)>=0&&Mg(t)){c_(t,i);break}n.indexOf("baseline")>=0&&t.type===k.Area&&f_(t,i);let a=["layout","rowGap","colGap","numRows","numCols","orientation","vertCellAlignment","horzCellAlignment","direction","childrenOrder"],o=n.filter((t=>a.indexOf(t)>=0));return o.length>0&&o_(i[0],i,o),s}_canTranslate(t){let e={x:!0,y:!0};return t.type==k.Axis?("x"===t.channel||"width"===t.channel?e.x=!1:"y"!==t.channel&&"height"!==t.channel||(e.y=!1),e):(t.parent.type===k.Collection&&t.parent.layout&&(e.x=!1,e.y=!1),this.positionBound(t,"x")&&(e.x=!1),this.positionBound(t,"y")&&(e.y=!1),e)}translate(t,e,i){let s=this._canTranslate(t);if(!s.x&&!s.y)return s;const n=s.x?e:0,r=s.y?i:0;return t._doTranslate(n,r),this._updateAncestorBounds(t),a_(t,n,r),s}_updateAncestorBounds(t,e){let i=Ag(e||vg(t,this));for(;i.length>0;){for(let t of i)(t.children&&t.children.length>0||t.vertices)&&t._updateBounds();i=Ag(i)}}_reapplyConstraints(t){let e=t,i=[t];for(;e.children;)e.type==k.Collection?i.push(e.firstChild):i=i.concat(e.children),e=e.firstChild;for(e=t.parent;e&&e.type!==k.Scene;)i.push(e),e=e.parent;const s=i.map((t=>t.classId));for(let t in this.constraints){const e=this.constraints[t];switch(e.type){case w:(s.indexOf(e.item.classId)>=0||s.indexOf(e.baseItem.classId)>=0)&&e.apply();break;case x:for(let t of e.items)if(s.indexOf(t.classId)>=0){e.apply();break}}}}_relayoutAncestors(t,e){let i=Ag(e||vg(t,this));for(;i.length>0;){for(let t of i)t.layout&&t.layout.run(),t.children&&t.children.length>0&&t._updateBounds(),t.vertices&&t._updateBounds();i=Ag(i)}}_reapplySizeBindings(t){let e=["width","height"];for(let i in this.encodings){if(t.classId!=i)continue;let s=this.encodings[i],n=_g(this,[{classId:i}]);for(let t of e){let e=s[t];e&&e.run()}this._relayoutAncestors(n[0],n)}}_registerBinding(t){let e=this.encodings,i=Cg(t.anyItem);return i in e||(e[i]={}),e[i][t.channel]=t,!0}toJSON(){let t=super.toJSON();this.fillColor&&(t.fillColor=this.fillColor);let e={};t.encodings=[],t.itemCounter=Fg;for(let i in this.encodings)for(let s in this.encodings[i]){let n=this.encodings[i][s];t.encodings.push(n.toJSON()),n.scale&&!(n.scale.id in e)&&(e[n.scale.id]=n.scale.toJSON())}t.scales=e,t.constraints={};for(let e in this.constraints)t.constraints[e]=this.constraints[e].toJSON();t.tables={};let i=this.getDataTables();for(let e in i)t.tables[e]=i[e].toJSON();return t}getDataTables(){let t={};for(let e in this.encodings)for(let i in this.encodings[e]){let s=this.encodings[e][i];s.datatable.id in t||(t[s.datatable.id]=s.datatable)}for(let e of this.children)if(!Rg(e)){if(e.dataScope){t[e.dataScope.dataTable.id]=e.dataScope.dataTable;break}if(e.children&&e.children.length>0){let i=e.firstChild;for(;i;){if(i.dataScope){t[i.dataScope.dataTable.id]=i.dataScope.dataTable;break}i=i.children&&i.children.length>0?i.firstChild:void 0}}}return t}getItem(t){let e=t.split("_")[0];if(t.indexOf("_v_")>0){let i=parseInt(t.split("_v_")[1]);return this._itemMap[e].vertices.find((t=>t._id===i))}if(t.indexOf("_s_")>0){let i=parseInt(t.split("_s_")[1]);return this._itemMap[e].segments.find((t=>t._id===i))}return this._itemMap[t]}addInteraction(t){this._interactions.push(t),this._interactionsObj[t.event]=t}}const H_="N",X_="S",$_="E",Z_="W",K_="NE",Q_="NW",tm="SE",em="SW",im="M";class sm{SVG=null;drag=!1;selection=[];mouseDown=!1;rectSvg=null;bounds=null;brushColor="#9c3131";dir=null;bb=[];mouseDownEvent=null;constructor(t,e,i=null){this.SVG=d3.select("#"+t).style("cursor","crosshair"),this.brushColor=e,i&&(this.bounds=i)}brush(){return document.addEventListener("mousedown",(t=>{if(this.mouseDownEvent=t,this.rectSvg||this.appendRectangles(this.brushColor),this.bounds&&!(t.layerX>=this.bounds.left&&t.layerX<=this.bounds.left+this.bounds.width&&t.layerY>=this.bounds.top&&t.layerY<=this.bounds.top+this.bounds.height))return;this.drag=!1,this.mouseDown=!0,this.selection=[t.layerX,t.layerY];let e=this.bb[0],i=this.bb[1],s=this.bb[2],n=this.bb[3];this.selection[0]>e+3&&this.selection[0]<e+n-3&&this.selection[1]>=i+s-3&&this.selection[1]<=i+s+3?this.dir=X_:this.selection[0]>e+3&&this.selection[0]<e+n-3&&this.selection[1]>=i-3&&this.selection[1]<=i+3?this.dir=H_:this.selection[1]>i+3&&this.selection[1]<i+s-3&&this.selection[0]>=e+n-3&&this.selection[0]<=e+n+3?this.dir=$_:this.selection[1]>i+3&&this.selection[1]<i+s-3&&this.selection[0]>=e-3&&this.selection[0]<=e+3?this.dir=Z_:this.selection[0]>=e-3&&this.selection[0]<=e+3&&this.selection[1]>=i-3&&this.selection[1]<=i+3?this.dir=Q_:this.selection[0]>=e-3&&this.selection[0]<=e+3&&this.selection[1]>=i+s-3&&this.selection[1]<=i+s+3?this.dir=em:this.selection[0]>=e+n-3&&this.selection[0]<=e+n+3&&this.selection[1]>=i-3&&this.selection[1]<=i+3?this.dir=K_:this.selection[0]>=e+n-3&&this.selection[0]<=e+n+3&&this.selection[1]>=i+s-3&&this.selection[1]<=i+s+3?this.dir=tm:this.selection[0]>e+3&&this.selection[0]<e+n-3&&this.selection[1]>i+3&&this.selection[1]<i+s-3?this.dir=im:(this.dir=null,this.updateRectangles(null,t.layerX,t.layerY,0,0))})),document.addEventListener("mousemove",(t=>{if(this.mouseDown)if(this.drag=!0,this.dir==H_)t.layerY>this.bb[1]?t.layerY<=this.bb[1]+this.bb[2]?this.updateRectangles(null,this.bb[0],t.layerY,this.bb[3],this.bb[2]+this.bb[1]-t.layerY):this.updateRectangles(null,this.bb[0],this.bb[1]+this.bb[2],this.bb[3],t.layerY-this.bb[1]-this.bb[2]):this.updateRectangles(null,this.bb[0],t.layerY,this.bb[3],this.bb[2]+this.bb[1]-t.layerY);else if(this.dir==X_)t.layerY>this.bb[1]?this.updateRectangles(null,this.bb[0],this.bb[1],this.bb[3],t.layerY-this.bb[1]):this.updateRectangles(null,this.bb[0],t.layerY,this.bb[3],this.bb[1]-t.layerY);else if(this.dir==Z_)t.layerX>this.bb[0]?t.layerX<=this.bb[0]+this.bb[3]?this.updateRectangles(null,t.layerX,this.bb[1],this.bb[3]-t.layerX+this.bb[0],this.bb[2]):this.updateRectangles(null,this.bb[0]+this.bb[3],this.bb[1],t.layerX-this.bb[0]-this.bb[3],this.bb[2]):this.updateRectangles(null,t.layerX,this.bb[1],this.bb[3]+this.bb[0]-t.layerX,this.bb[2]);else if(this.dir==$_)t.layerX>this.bb[0]?this.updateRectangles(null,this.bb[0],this.bb[1],t.layerX-this.bb[0],this.bb[2]):this.updateRectangles(null,t.layerX,this.bb[1],this.bb[0]-t.layerX,this.bb[2]);else if(this.dir==K_);else if(this.dir==Q_);else if(this.dir==tm)t.layerX>this.bb[0]&&t.layerY>this.bb[1]?this.updateRectangles(null,this.bb[0],this.bb[1],t.layerX-this.bb[0],t.layerY-this.bb[1]):t.layerX>this.bb[0]&&t.layerY<this.bb[1]?this.updateRectangles(null,this.bb[0],t.layerY,t.layerX-this.bb[0],this.bb[1]-t.layerY):t.layerX<this.bb[0]&&t.layerY<this.bb[1]?this.updateRectangles(null,t.layerX,t.layerY,this.bb[0]-t.layerX,this.bb[1]-t.layerY):this.updateRectangles(null,t.layerX,this.bb[1],this.bb[0]-t.layerX,t.layerY-this.bb[1]);else if(this.dir==em);else if(this.dir==im)this.updateRectangles(null,this.bb[0]+t.layerX-this.selection[0],this.bb[1]+t.layerY-this.selection[1],this.bb[3],this.bb[2]),this.bb[0]=this.bb[0]+t.layerX-this.selection[0],this.bb[1]=this.bb[1]+t.layerY-this.selection[1],this.selection=[t.layerX,t.layerY];else{let{__x:e,__y:i,__height:s,__width:n}=this.getRectCoordinates(t,this.selection);this.updateRectangles(null,e,i,n,s)}})),document.addEventListener("mouseup",(t=>{if(this.mouseDown){if(this.drag){console.log("Brush");let t=this.rectSvg._groups[0][0].getBoundingClientRect();this.bb=[t.x-183,t.y,t.height,t.width],document.dispatchEvent(new CustomEvent("brush",{detail:{selection:[[t.x-183,t.y],[t.x-183+t.width,t.y+t.height]]}}))}else console.log("Click"),this.updateRectangles("none"),this.bb=[],this.removeRectangles(),document.dispatchEvent(new CustomEvent("brush",{detail:{e:this.mouseDownEvent}}));this.selection=[],this.dir=null,this.mouseDown=!1}})),1}removeRectangles(){this.rectSvg=null,d3.selectAll(".handle--selection").remove(),d3.selectAll(".handle--n").remove(),d3.selectAll(".handle--w").remove(),d3.selectAll(".handle--e").remove(),d3.selectAll(".handle--s").remove(),d3.selectAll(".handle--nw").remove(),d3.selectAll(".handle--ne").remove(),d3.selectAll(".handle--sw").remove(),d3.selectAll(".handle--se").remove(),d3.selectAll(".handle--overlay").remove()}appendRectangles(t){this.SVG.append("rect").attr("class","handle--overlay").attr("x","0").attr("x","0").attr("height",this.SVG._groups[0][0].clientHeight).attr("width",this.SVG._groups[0][0].clientWidth).style("cursor","crosshair").style("opacity","0"),this.rectSvg=this.SVG.append("rect").attr("class","handle--selection").style("fill",t).style("cursor","move").style("opacity","0.3").attr("display","none"),this.SVG.append("rect").attr("class","handle--n").style("cursor","ns-resize").attr("display","none").style("opacity","0"),this.SVG.append("rect").attr("class","handle--w").style("cursor","ew-resize").attr("display","none").style("opacity","0"),this.SVG.append("rect").attr("class","handle--e").style("cursor","ew-resize").attr("display","none").style("opacity","0"),this.SVG.append("rect").attr("class","handle--s").style("cursor","ns-resize").attr("display","none").style("opacity","0"),this.SVG.append("rect").attr("class","handle--nw").style("cursor","nwse-resize").attr("display","none").style("opacity","0"),this.SVG.append("rect").attr("class","handle--ne").style("cursor","nesw-resize").attr("display","none").style("opacity","0"),this.SVG.append("rect").attr("class","handle--sw").style("cursor","nesw-resize").attr("display","none").style("opacity","0"),this.SVG.append("rect").attr("class","handle--se").style("cursor","nwse-resize").attr("display","none").style("opacity","0")}updateRectangles(t=null,e=null,i=null,s=null,n=null){d3.selectAll(".handle--selection").attr("display",t).attr("x",e).attr("y",i).attr("height",n).attr("width",s),d3.selectAll(".handle--n").attr("display",t).attr("x",e?e-3:e).attr("y",i?i-3:i).attr("height",0==n||n?6:n).attr("width",0==s||s?s+6:s),d3.selectAll(".handle--w").attr("display",t).attr("x",e?e-3:e).attr("y",i?i-3:i).attr("height",0==n||n?n+6:n).attr("width",0==s||s?6:s),d3.selectAll(".handle--e").attr("display",t).attr("x",e?e+s-3:e).attr("y",i?i-3:i).attr("height",0==n||n?n+6:n).attr("width",0==s||s?6:s),d3.selectAll(".handle--s").attr("display",t).attr("x",e?e-3:e).attr("y",i?i+n-3:i).attr("height",0==n||n?6:n).attr("width",0==s||s?s+6:s),d3.selectAll(".handle--nw").attr("display",t).attr("x",e?e-3:e).attr("y",i?i-3:i).attr("height",0==n||n?6:n).attr("width",0==s||s?6:s),d3.selectAll(".handle--ne").attr("display",t).attr("x",e?e+s-3:e).attr("y",i?i-3:i).attr("height",0==n||n?6:n).attr("width",0==s||s?6:s),d3.selectAll(".handle--sw").attr("display",t).attr("x",e?e-3:e).attr("y",i?i+n-3:i).attr("height",0==n||n?6:n).attr("width",0==s||s?6:s),d3.selectAll(".handle--se").attr("display",t).attr("x",e?e+s-3:e).attr("y",i?i+n-3:i).attr("height",0==n||n?6:n).attr("width",0==s||s?6:s)}getRectCoordinates(t,e){let i,s,n,r=null;return t.layerY-e[1]<0?t.layerX-e[0]>0?(i=e[0],s=t.layerY,r=e[1]-t.layerY,n=t.layerX-e[0]):(i=t.layerX,s=t.layerY,r=e[1]-t.layerY,n=e[0]-t.layerX):t.layerX-e[0]>0?(i=e[0],s=e[1],r=t.layerY-e[1],n=t.layerX-e[0]):(i=t.layerX,s=e[1],r=t.layerY-e[1],n=e[0]-t.layerX),this.bounds&&(t.layerY-e[1]>0?s+r>this.bounds.top+this.bounds.height&&(r=this.bounds.top+this.bounds.height-e[1]):this.bounds.top+r>e[1]&&(s=this.bounds.top,r=e[1]-t.layerY-(this.bounds.top+r-e[1])),t.layerX-e[0]>0?i+n>this.bounds.left+this.bounds.width&&(n=this.bounds.left+this.bounds.width-e[0]):this.bounds.left+n>e[0]&&(i=this.bounds.left,n=e[0]-t.layerX-(this.bounds.left+n-e[0]))),{__x:i,__y:s,__height:r,__width:n}}}class nm{constructor(t){this._renderer=t,this._globalPredicates={}}created=0;processInteraction(t,e){if(t.target&&t.targetEval&&t.targetEval.false&&t.listener.type==k.Scene){const i=[];vg(t.target,e).forEach((e=>{const s={};Object.keys(t.targetEval.false).forEach((t=>{s[t]=e[t]})),i.push(s)})),"brush"!=t.event&&"click"!=t.event||0==this.created&&(this.created=new sm(this._renderer._svgId,"#9c3131",t.hitObject._bounds).brush(),document.addEventListener("brush",(s=>{this._processBrush1(t,e,i,s.detail.selection?{selection:s.detail.selection}:null),null==s.detail.selection&&this._processClick(t,e,i,s.detail.e)})))}}_processBrush1(t,e,i,n){let r={};if("brush"==t.event){if(t.predicate.length<=0)return;t.predicate.forEach((e=>{if("range"!=e.type)throw new Error(`Event Type Brush should not have ${t.predicate.type} as Predicate Type`);{let i=[];"axis"==t.hitObject.type?t.hitObject._labels.children.forEach((t=>{i.push({axisCoordinate:t[e.channel],actualValue:t.text})})):"collection"==t.hitObject.type&&t.hitObject.children.forEach((t=>{i.push({axisCoordinate:t[e.channel],actualValue:t.dataScope.getFieldValue(e.field)})})),i.sort(((t,e)=>t.axisCoordinate-e.axisCoordinate)),r[e.channel]={_actualLabels:i.map((t=>t.actualValue)),_axisCoordinates:i.map((t=>t.axisCoordinate))},i=null}}))}if(n&&n.selection){let a={x:[n.selection[0][0],n.selection[1][0]],y:[n.selection[0][1],n.selection[1][1]]},o={x:null,y:null};Object.entries(r).forEach((t=>{const[e,i]=t;let n=i._actualLabels[s.bisect(i._axisCoordinates,a[e][0])],r=i._actualLabels[s.bisect(i._axisCoordinates,a[e][1])-1];o[e]={_high:n>=r?n:r,_low:n<r?n:r}}));let h,l=t.predicate.filter((t=>o.x&&"x"==t.channel))[0],c=t.predicate.filter((t=>o.y&&"y"==t.channel))[0],u=!1;vg(t.target,e).forEach(((e,s)=>{l&&(h=o.x._high>=e.dataScope.getFieldValue(l.field)&&o.x._low<=e.dataScope.getFieldValue(l.field)),c&&(u=o.y._high>=e.dataScope.getFieldValue(c.field)&&o.y._low<=e.dataScope.getFieldValue(c.field)),null==l&&u||null==c&&h||h&&u?this.setTargetProperties(i[s],e):this.setTargetProperties(t.targetEval.false,e)}))}else vg(t.target,e).forEach(((t,e)=>{this.setTargetProperties(i[e],t)}));this._renderer.render(e,{visualOnly:!0})}_processClick(t,e,i,s){t=e._interactionsObj.click;let n=new Set;if("point"==t.predicate[0].type)if(s.target.id.includes(t.target.type)){const n=vg(t.target,e).filter((t=>t.id==s.target.id));n.length>0&&vg(t.target,e).forEach(((e,s)=>{e.dataScope.getFieldValue(t.predicate[0].field)==n[0].dataScope.getFieldValue(t.predicate[0].field)?this.setTargetProperties(i[s],e):this.setTargetProperties(t.targetEval.false,e)}))}else"legend"==t.hitObject.type&&t.hitObject.encoding.datatable._fieldSummaries[t.predicate[0].field].unique.includes(s.target.innerHTML)?vg(t.target,e).forEach(((e,n)=>{e.dataScope.getFieldValue(t.predicate[0].field)==s.target.innerHTML?this.setTargetProperties(i[n],e):this.setTargetProperties(t.targetEval.false,e)})):vg(t.target,e).forEach(((t,e)=>{this.setTargetProperties(i[e],t)}));else if("list"==t.predicate[0].type)if(t.predicate[0].multiByField)if(s.target.id.includes(t.target.type)){const r=vg(t.target,e).filter((t=>t.id==s.target.id));r.length>0&&(n.add(r[0].dataScope.getFieldValue(t.predicate[0].field)),vg(t.target,e).forEach(((e,s)=>{n.has(e.dataScope.getFieldValue(t.predicate[0].field))?this.setTargetProperties(i[s],e):this.setTargetProperties(t.targetEval.false,e)})))}else n.clear(),vg(t.target,e).forEach(((t,e)=>{this.setTargetProperties(i[e],t)}));else s.target.id.includes(t.target.type)?(n.has(s.target.id)?n.delete(s.target.id):n.add(s.target.id),vg(t.target,e).forEach(((e,s)=>{n.has(e.id)?this.setTargetProperties(i[s],e):this.setTargetProperties(t.targetEval.false,e)}))):(n.clear(),vg(t.target,e).forEach(((t,e)=>{this.setTargetProperties(i[e],t)})));this._renderer.render(e,{visualOnly:!0})}evaluatePredicate(t,e,i){if("range"==t.predicate.type)return e.dataScope.getFieldValue(t.predicate.field)<=_[0]&&e.dataScope.getFieldValue(t.predicate.field)>=_[1]}setTargetProperties(t,e){Object.keys(t).forEach((i=>{try{e[i]=t[i]}catch(t){console.log("Property not found")}}))}_getSelection(t,e,i,s){let n={};s?n.item=s:e.item;let r=e.field?e.field:a;return n.item&&(n.predicate={field:r,value:n.item.dataScope.getFieldValue(r)}),n}addGlobalPredicate(t,e){t.id in this._globalPredicates||(this._globalPredicates[t.id]={}),this._globalPredicates[t.id][e.field]=e}getGlobalPredicates(t){return t.id in this._globalPredicates?Object.values(this._globalPredicates[t.id]):[]}}class rm{constructor(t){this._svgId=t,this._compMap={},this._decoMap={},this._interactionHandler=new nm(this)}render(t,e){let i=e||{};for(let t in this._decoMap)this._decoMap[t].remove(),delete this._decoMap[t];this._removed={};for(let t in this._compMap)this._removed[t]=1;this._renderItem(t,i);for(let t in this._removed)this._compMap[t].remove(),delete this._compMap[t];if(!("visualOnly"in i))for(let e of t._interactions)this._interactionHandler.processInteraction(e,t)}clear(){let t=document.getElementById(this._svgId);for(;t.firstChild;)t.firstChild.remove();this._compMap={},this._decoMap={}}_renderItem(t,e){let i,n=t.id,r=t.parent;i=r&&r.id&&r.id in this._compMap?s.select("#"+this._svgId).select("#"+r.id):s.select("#"+this._svgId),n in this._compMap?delete this._removed[n]:this._compMap[n]=i.append(this._getSVGElementType(t)),t.type==k.Gridlines&&this._compMap[n].lower();let a=this._compMap[n];if(a.attr("id",n),t.classId&&a.attr("class",t.classId),t.type==k.Scene&&s.select("#"+this._svgId).style("background",t.fillColor?t.fillColor:"#fff"),"vertex"!=t.type){if([k.Path,k.Polygon,k.Link,k.Pie,k.Line,k.Area,k.Ring,k.Arc].indexOf(t.type)>=0)a.attr("d",t.getSVGPathData()),t.closed||a.style("fill","none"),0==n.indexOf("axis")&&a.style("shape-rendering","crispEdges");else if(t.type==k.Circle)a.attr("cx",t.x),a.attr("cy",t.y),a.attr("r",t.radius);else if(t.type==k.Rect){let e=t.bounds;a.attr("x",e.left).attr("y",e.top).attr("width",e.width).attr("height",e.height)}else t.type==k.PointText?a.attr("text-anchor",this._getTextAnchor(t.anchor[0])).attr("alignment-baseline",this._getTextAnchor(t.anchor[1])).attr("dominant-baseline",this._getTextAnchor(t.anchor[1])).text(t.text).attr("x",t.x).attr("y",t.y):t.type==k.Image&&a.attr("href",t.src).attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height);for(let e in t.styles)if(void 0!==t.styles[e])if(e.indexOf("Color")>0&&t.styles[e].type==k.LinearGradient){s.select("#"+this._svgId).select("defs").empty()&&s.select("#"+this._svgId).append("defs");let i=s.select("defs"),n=t.styles[e];if(i.select("#"+n.id).empty()){let t=i.append("linearGradient").attr("id",n.id);t.attr("x1",n.x1+"%").attr("x2",n.x2+"%").attr("y1",n.y1+"%").attr("y2",n.y2+"%");for(let e of n.stops)t.append("stop").attr("offset",e.offset+"%").style("stop-color",e.color).style("stop-opacity",e.opacity)}a.style(N[e],"url(#"+n.id+")")}else a.style(N[e],t.styles[e]);if(t._rotate&&a.attr("transform","rotate("+t._rotate.join(" ")+")"),t.vertices&&this._renderVertices(t),t.type==k.Collection&&e&&e.collectionBounds){let e=t.bounds;t.layout&&"grid"==t.layout.type?this._renderLayout(t):(t.id in this._decoMap||(this._decoMap[t.id]=s.select("#"+this._svgId).append("rect").attr("class","deco")),this._decoMap[t.id].attr("x",e.left).attr("y",e.top).attr("width",e.width).attr("height",e.height).attr("fill","none").attr("stroke","#1ecb40").attr("stroke-width","2px").attr("stroke-dasharray","5,5"))}if(t.children)for(let i of t.children)this._renderItem(i,e)}}_renderVertices(t){let e=t.id+"-vertices";if(e in this._compMap)delete this._removed[e];else{let i=t.parent,n=i?i.id:this._svgId;this._compMap[e]=s.select("#"+n).append("g").attr("id",e)}if(0===t.vertices.map((t=>t.shape)).filter((t=>void 0!==t)).length)return void this._compMap[e].style("visible","hidden");this._compMap[e].style("visible","visible");let i=t.vertices.filter((t=>void 0!==t.shape));for(let t of i){let i=e+"-"+t.id;i in this._compMap?t.shape!==this._compMap[i].node().tagName?(this._compMap[i].remove(),this._compMap[i]=s.select("#"+e).append(t.shape).attr("id",i),delete this._removed[i]):delete this._removed[i]:this._compMap[i]=s.select("#"+e).append(t.shape).attr("id",i),"rect"==t.shape?s.select("#"+i).attr("x",t.x-t.width/2).attr("y",t.y-t.height/2).attr("width",t.width).attr("height",t.height):"circle"==t.shape&&s.select("#"+i).attr("cx",t.x).attr("cy",t.y).attr("r",t.radius),s.select("#"+i).style("fill",t.fillColor).style("opacity",t.opacity).style("stroke-width",t.strokeWidth).style("stroke",t.strokeColor)}}_renderLayout(t){let e=t.id+"-grid";e in this._decoMap||(this._decoMap[e]=s.select("#"+this._svgId).append("g").attr("id",e).attr("class","deco"));let i=t.layout.cellBounds,n=t.layout.rowGap;this._decoMap[e].selectAll("rect").remove(),this._decoMap[e].selectAll("rect").data(i.slice(0,i.length-1)).enter().append("rect").attr("x",(t=>t.left)).attr("y",(t=>t.bottom)).attr("width",(t=>t.width)).attr("height",n).style("fill","pink").style("opacity",.5);for(let t of i)this._decoMap[e].append("rect").attr("x",t.left).attr("y",t.top).attr("width",t.width).attr("height",t.height).attr("stroke","blue").attr("stroke-width","1px").attr("stroke-dasharray","5,5").attr("fill","none")}_getTextAnchor(t){switch(t){case"top":return"text-before-edge";case"bottom":return"auto";case"left":return"start";case"right":return"end";case"center":case"middle":return"middle";default:return t}}_getSVGElementType(t){switch(t.type){case k.Rect:return"rect";case k.Collection:case k.Group:case k.Glyph:case k.Scene:case k.Axis:case k.Legend:case k.Gridlines:return"g";case k.Area:case k.Path:case k.Polygon:case k.Ring:case k.Pie:case k.Arc:case k.Link:case k.Line:return"path";case k.Circle:return"circle";case k.PointText:return"text";case"vertex":if("circle"==t.shape)return"circle";if("rect"==t.shape)return"rect";throw"argument exception";case"image":return"image"}}}class am{constructor(){this.axes={},this.guideCmds=[],this.collectionCmds=[],this.glyphCmds=[],this.spec=[]}run(t){for(let e of t.children)switch(e.type){case k.Axis:{let t=e.classId?e.classId:e.id;this.axes[t]=e;break}case k.Gridlines:case k.Legend:{let t=e.toJSON();this.guideCmds.push({cmd:e.type,channel:t.channel,field:t.field,args:t.args});break}case k.Collection:case k.Group:case k.Glyph:{let i=[];this._analyze(e,i);for(let t=i.length-1;t>0;t--)for(let e of i[t].fields)i[t-1].fields.delete(e);for(let[e,s]of i.entries()){if(s.item instanceof z){let e={cmd:"mark",type:s.item.type,output:s.item,args:s.item.toJSON().args};this._inferMarkArgs(e,t),this.collectionCmds.push(e)}else if(s.item instanceof A_)this.collectionCmds.push({cmd:"glyph",output:s.item,input:i.slice(0,e).map((t=>t.item)),args:{}});else if(s.item instanceof B_){let t=[...i[e-1].fields][0],n={cmd:"join",input:i[e-1].item,output:s.item,data:i[e-1].item.dataScope.dataTable.id,args:{field:t}};t==a&&delete n.field,this.collectionCmds.push(n)}s.item.dataScope&&0==s.item.dataScope.fields.length&&!s.item.parent.dataScope&&this.collectionCmds.push({cmd:"attach",input:s.item,data:s.item.dataScope.dataTable.id})}break}default:if(e instanceof z){let i={cmd:"mark",type:e.type,output:e,args:e.toJSON().args};this._inferMarkArgs(i,t),this.glyphCmds.push(i)}}this._inferJoin(),this._inferArgs(t);for(let t in this.axes){let e=this.axes[t].toJSON();this.guideCmds.push({cmd:e.type,channel:e.channel,field:e.field,args:e.args})}return this._generateFullSpec(t),this.spec}_inferJoin(){for(let t of this.collectionCmds){if("join"!=t.cmd)continue;let e=t.input,i=e.parent;if(e.type===k.Rect)i.layout&&i.layout.type==m.Stack?t.cmd="divide":t.cmd="repeat";else t.cmd="repeat"}}_inferArgs(t){for(let e of this.collectionCmds)switch(e.cmd){case"mark":this._inferMarkArgs(e,t);break;case"divide":this._inferDivideArgs(e,t)}}_inferDivideArgs(t){t.args.orientation=t.output.layout.orientation}_inferMarkArgs(t,e){let i=t.output,s=i.parent,n=vg(i,e),r=vg(s,e);switch(i.type){case k.Rect:s.layout&&s.layout.type==m.Grid?(t.args.width=s.layout.cellBounds[0].width,t.args.height=s.layout.cellBounds[0].height):s.layout&&s.layout.type==m.Stack?(t.args.width=Math.max(...r.map((t=>t.bounds.width))),t.args.height=Math.max(...r.map((t=>t.bounds.height)))):(t.args.width=Math.max(...n.map((t=>t.bounds.width))),t.args.height=Math.max(...n.map((t=>t.bounds.height)))),t.args.left=Math.min(...n.map((t=>t.bounds.left))),t.args.top=Math.min(...n.map((t=>t.bounds.top)));break;case k.Line:t.args.x1=Math.min(...n.map((t=>t.vertices[0].x))),t.args.y1=Math.min(...n.map((t=>t.vertices[0].y))),t.args.x2=Math.min(...n.map((t=>t.vertices[1].x))),t.args.y2=Math.min(...n.map((t=>t.vertices[1].y)));break;case k.Arc:t.args.x=i.x,t.args.y=i.y,t.args.innerRadius=i.innerRadius,t.args.outerRadius=i.outerRadius}for(let e in i.styles)t.args[e]=i.styles[e]}_analyze(t,e){if(t instanceof A_)for(let i of t.children)this._analyze(i,e);else t instanceof Jg&&this._analyze(t.firstChild,e);let i={type:t.type,item:t};t.dataScope?i.fields=new Set(t.dataScope.fields):i.fields=new Set,e.push(i)}_generateFullSpec(t){this.spec=[],this.spec.push({cmd:"scene",args:{fillColor:t.fillColor}});let e=t.getDataTables(),i={},s=[];for(let t in e){let n=e[t];if(n.sourceDataTable)for(;n.sourceDataTable;)s.push({cmd:"transform",type:n.transform.type,args:n.transform.args,input:n.sourceDataTable.id,output:n.id}),n=n.sourceDataTable;n.id in i||(i[n.id]={cmd:"data",url:n.url,output:n.id})}this.spec=this.spec.concat(Object.values(i)),this.spec=this.spec.concat(s);let n=[];for(let t of this.collectionCmds){let e;t.output&&t.output.layout&&(e={cmd:"layout",type:t.output.layout.type,input:t.output.id,args:t.output.layout.toJSON().args}),this.spec.push(t),t.output&&t.output.childrenOrder&&n.push({cmd:"sortChildren",args:t.output.childrenOrder,input:t.output.id}),e&&this.spec.push(e),t.input&&Array.isArray(t.input)?t.input=t.input.map((t=>t.classId?t.classId:t.id)):t.input&&(t.input=t.input.classId?t.input.classId:t.input.id),t.output&&(t.output=t.output.classId?t.output.classId:t.output.id)}let r={},a=[];for(let e in t.encodings)for(let i in t.encodings[e]){let s=t.encodings[e][i];s.scale&&!(s.scale.id in r)&&(r[s.scale.id]=s.scale.toJSON());let n=s.toJSON().args;n.field=s.field,n.channel=s.channel,delete n.datatable,a.push({cmd:"encode",input:Cg(s.anyItem),scale:s.scale.id,args:n})}for(let t in r){let e=r[t];e.cmd="scale",this.spec.push(e)}this.spec=this.spec.concat(a),this.spec=this.spec.concat(n);for(let e in t.constraints){let i=t.constraints[e],s={cmd:"constraint",type:i.type,args:{}};switch(i.type){case w:s.item=i.item.classId?i.item.classId:i.item.id,s.baseItem=i.baseItem.classId?i.baseItem.classId:i.baseItem.id,s.channel=i.channel,s.args.itemAnchor=i.itemAnchor,s.args.baseAnchor=i.baseAnchor,s.args.offset=i.offset;break;case x:s.items=i.items.map((t=>t.classId?t.classId:t.id)),s.anchor=i.anchor}this.spec.push(s)}for(let t of this.guideCmds)this.spec.push(t);for(let t of this.glyphCmds)t.output&&(t.output=t.output.classId?t.output.classId:t.output.id),this.spec.push(t)}}class om{constructor(){this.axes={},this.legends=[],this.gridlines=[],this.scales={},this.tables={}}load(t){let e={};if(t.fillColor&&(e.fillColor=t.fillColor),t.itemCounter)for(let e in t.itemCounter)Fg[e]=t.itemCounter[e];let i=new J_(e);if(i.id=t.id,i.type=t.type,t.bounds&&(i._bounds=new n(t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height)),t.tables)for(let e in t.tables)this.tables[e]=new x_(t.tables[e].data,t.tables[e].url,t.tables[e].fieldTypes),this.tables[e].id=t.tables[e].id;for(let e of t.children)this._processItem(i,e,i);if(t.scales)for(let e in t.scales)this._loadScale(t.scales[e],i);if(t.encodings)for(let e of t.encodings)this._loadEncoding(e,i);if(t.constraints)for(let e in t.constraints)this._loadConstraint(t.constraints[e],i);for(let t in this.axes)this._createGuide(i,this.axes[t]);for(let t of this.legends)this._createGuide(i,t);for(let t of this.gridlines)this._createGuide(i,t);return i}_loadScale(t,e){let i;t.type.indexOf("Color")>0&&t.scheme?i=new p_(t.type,t.scheme):(i=new p_(t.type),i.range=t.range),i.domain="time"==t.type?t.domain.map((t=>new Date(t))):t.domain,i.id=t.id,"offset"in t&&(i.offset=t.offset),i.isFlipped=t.isFlipped,i.clamp=t.clamp,i._mapping=t.mapping,"includeZero"in t&&(i.includeZero=t.includeZero),"baseItem"in t&&(i._baseItem=e.getItem(t.baseItem)),this.scales[i.id]=i}_loadEncoding(t,e){t.args.datatable&&(t.args.datatable=this.tables[t.args.datatable]),t.args.scale&&(t.args.scale=this.scales[t.args.scale]);let i=t.items.map((t=>e.getItem(t)));e._doEncode(i,t.args),e._relayoutAncestors(i[0],i)}_createGuide(t,e){switch(e.type){case k.Axis:e.args.item&&(e.args.item=t.getItem(e.args.item)),t.axis(e.channel,e.field,e.args);break;case k.Legend:t.legend(e.channel,e.field,e.args);break;case k.Gridlines:e.args.item&&(e.args.item=t.getItem(e.args.item)),t.gridlines(e.channel,e.field,e.args)}}_processItem(t,e,i){switch(e.type){case k.Axis:{let t=e.classId?e.classId:e.id;e.args.tickValues&&e.args.isDate&&(e.args.tickValues=e.args.tickValues.map((t=>new Date(t)))),this.axes[t]=e;break}case k.Gridlines:e.args.values&&e.args.isDate&&(e.args.values=e.args.values.map((t=>new Date(t)))),this.gridlines.push(e);break;case k.Legend:this.legends.push(e);break;case k.Collection:{let s=i.collection();t.addChild(s),this._loadGroup(s,e,i);break}case k.Group:{let s=i.group();t.addChild(s),this._loadGroup(s,e,i);break}case k.Glyph:{let s=i.glyph();t.addChild(s),this._loadGroup(s,e,i);break}default:this._loadMark(t,e,i)}}_loadConstraint(t,e){switch(t.type){case"affixation":{let i=e.getItem(t.item),s=e.getItem(t.baseItem),n=new M_(i,s,e,t.channel,t.itemAnchor,t.baseAnchor,t.offset);return n.id=t.id,e.constraints[t.id]=n,n.apply(),n}case"alignment":{let i=t.items.map((t=>e.getItem(t))),s=new R_(i,t.direction);return s.id=t.id,e.constraints[t.id]=s,s.apply(),s}}}_loadDataScope(t){let e=new Hg(this.tables[t.dt]);for(let i in t.f2v)e._field2value[i]=t.f2v[i],e._updateTuples(i,t.f2v[i]);return e}_loadGroup(t,e,i){if(t.id=e.id,e.classId&&(t.classId=e.classId),e.dataScope&&(t.dataScope=this._loadDataScope(e.dataScope)),e.children)for(let s of e.children)this._processItem(t,s,i);if(e.layout){let i=this._loadLayout(e.layout);i.group=t,t._layout=i}e.bounds&&(t._bounds=new n(e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height))}_loadMark(t,e,i){if(e.args.fillColor&&"LinearGradient"===e.args.fillColor.type){let t=e.args.fillColor;e.args.fillColor=new D(t),e.args.fillColor.id=t.id,e.args.fillColor._stops=t.stops}"id"in e&&(e.args.id=e.id);let s=i.mark(e.type,e.args);if(e.classId&&(s.classId=e.classId),e.dataScope&&(s.dataScope=this._loadDataScope(e.dataScope)),e.vertices){const t=[];for(let i of e.vertices){const e=Y.fromJSON(i,s);e.dataScope&&(e.dataScope=this._loadDataScope(e.dataScope)),t.push(e)}s.vertices=t,s.segments=[];for(let t=1;t<s.vertices.length;t++)s.segments.push(new U(s.vertices[t-1],s.vertices[t],s,s.segmentCounter++))}e.bounds&&(s._bounds=new n(e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height)),e.boundsOffsets&&(s.boundsOffsets=e.boundsOffsets),Ng(s)?(s.vertexCounter=e.vertexCounter,s.segmentCounter=e.segmentCounter,s.curveMode=e.curveMode):e.type===k.Image&&(s.src=e.src,s.width=e.width,s.height=e.height,s.x=e.x,s.y=e.y),t.addChild(s)}_loadLayout(t){let e=qg(t.type,t.args);if(t.type===m.Grid)e._left=t.left,e._top=t.top;return e}}function hm(t,e){let i=[t[0]],s=[e[0]];for(let n=1;n<e.length;n++){let r=!1,a=e[n];for(let e=0;e<s.length;e++){let o=s[e],h=new Set(a);if(o.forEach((t=>h.add(t))),h.size<a.length+o.length){s[e]=[...h],i[e]=i[e].concat(t[n]),r=!0;break}}r||(s.push(a),i.push(t[n]))}return{grouping:i,subgraphs:s}}class lm{constructor(t,e){this._type="network",this._nodeTable=new x_(t.nodes,"nodes"),this._linkTable=new x_(t.links,"links"),this._nodeTable.graph=this,this._linkTable.graph=this,this._nodes=t.nodes,this._links=t.links,this._name=e,this._nodeHash={};for(let e of t.nodes)this._nodeHash[e[r]]=e}get type(){return this._type}get nodeTable(){return this._nodeTable}get linkTable(){return this._linkTable}get nodes(){return this._nodes}get links(){return this._links}getNode(t){return this._nodeHash[t]}getSources(t){let e,i=t[r],s=this._links.data,n=this._nodes.data,a=[];for(let t in s)if(s[t].target==i){e=s[t].source;let i=n.findIndex((t=>t[r]===e));a.push(n[i])}return a}getTargets(t){let e,i=t[r],s=this._links.data,n=this._nodes.data,a=[];for(let t in s)if(s[t].source==i){e=s[t].target;let i=n.findIndex((t=>t[r]===e));a.push(n[i])}return a}transform(t,e,i){if("partition"===t)return function(t){let e=t.nodes,i=t.links,s=i.map(((t,e)=>[e])),n=i.map((t=>[t.source,t.target])),a=hm(s,n);for(;a.grouping.length!=s.length;)s=a.grouping,n=a.subgraphs,a=hm(s,n);let o=[];for(let[t,s]of a.grouping.entries()){let n={nodes:[],links:[]};n.links=s.map((t=>i[t]));const h=a.subgraphs[t];n.nodes=e.filter((t=>h.indexOf(t[r])>=0)),o.push(new lm(n))}return o}(this)}isLinear(){let t={},e={};for(let i of this._links)i.source in e||(e[i.source]=0),i.target in t||(t[i.target]=0),e[i.source]++,t[i.target]++;for(let e in t)if(t[e]>1)return!1;for(let t in e)if(e[t]>1)return!1;return!0}}function cm(t,e){return new Promise((function(i,s){let n=new XMLHttpRequest;n.open(t,e),n.onload=function(){this.status>=200&&this.status<300?i(n.response):s({status:this.status,statusText:n.statusText})},n.onerror=function(){s({status:this.status,statusText:n.statusText})},n.send()}))}async function um(t){let e=await cm("GET",t),i=s.csvParse(e.trim(),s.autoType);return new x_(i,t)}class dm{constructor(){}async run(t){let e,i,s={},n={},r={};for(let a of t)switch(a.cmd){case"scene":e=new J_(a.args);break;case"data":i=await um(a.url),n[a.output]=i;break;case"transform":n[a.output]=n[a.input].transform(a.type,a.args);break;case"mark":s[a.output]=e.mark(a.type,a.args);break;case"glyph":s[a.output]=e.glyph(...a.input.map((t=>s[t])));break;case"attach":e.attach(s[a.input],n[a.data]);break;case"repeat":{let t=e.repeat(s[a.input],n[a.data],a.args);s[a.output]=t;break}case"divide":{let t=e.divide(s[a.input],n[a.data],a.args);s[a.output]=t;break}case"layout":s[a.input].layout=qg(a.type,a.args);break;case"sortChildren":"field"in a.args?s[a.input].sortChildrenByData(a.args.field,a.args.reverse,a.args.order):"channel"in a.args&&s[a.input].sortChildren(a.args.channel,a.args.reverse);break;case"scale":{let t=new p_(a.type);t.id=a.id,t.domain="time"==a.type?a.domain.map((t=>new Date(t))):a.domain,t.range=a.range,t.clamp=a.clamp,t.isFlipped=a.isFlipped,"offset"in a&&(t.offset=a.offset),r[t.id]=t;break}case"encode":{let t,i=a.input;if(i.indexOf("_v_")>0){let e=parseInt(i.split("_v_")[1]);t=s[i.split("_v_")[0]].vertices[e]}else if(i.indexOf("_v")>0);else if(i.indexOf("_s_")>0){let e=parseInt(i.split("_s_")[1]);t=s[i.split("_s_")[0]].segments[e]}else i.indexOf("_s")>0||(t=s[a.input]);a.scale&&r[a.scale]&&(a.args.scale=r[a.scale]),e.encode(t,a.args);break}case"constraint":if(a.type===w)e.affix(s[a.item],s[a.baseItem],a.channel,a.args);break;case"axis":e.axis(a.channel,a.field,a.args);break;case"legend":e.legend(a.channel,a.field,a.args);break;case"gridlines":e.gridlines(a.channel,a.field,a.args)}return e}}t.canClassify=function(t){return q_(t)},t.canDensify=function(t){return Qg(t)},t.canDivide=function(t){return Zg(t)},t.canFormGlyph=function(t){for(let e of t)if(!Mg(e))return!1;return!0},t.canRepeat=function(t){return Xg(t)},t.cartesianToPolar=function(t,e,i,s){return Wg(t,e,i,s)},t.createScale=function(t,e){return new p_(t,e)},t.csv=async function(t){return um(t)},t.csvFromFile=async function(t){let e=s.csvParse(t.trim(),s.autoType);return new x_(e,"")},t.csvFromString=function(t,e){let i=s.csvParse(t.trim(),s.autoType);return new x_(i,e)},t.getPeersInScene=function(t){return"vertex"==t.type||"segment"==t.type?vg(t,t.parent.getScene()):vg(t,t.getScene())},t.graphjson=async function(t){return async function(t){let e=await cm("GET",t);return new lm(JSON.parse(e),t)}(t)},t.hitTest=function(t,e,i){if(!t.children||0==t.children.length)return t.contains(e,i)&&t.type!==k.Scene?t:null;let s=t.children;t.type===k.Scene&&(s=s.slice(),s.sort(((t,e)=>Rg(t)?1:Rg(e)?-1:0)));for(let t=s.length-1;t>=0;t--){let n=s[t];if(n.contains(e,i))return n}return null},t.hitTestAll=function(t,e,i){let s=Og(t);for(let t=s.length-1;t>=0;t--){let n=s[t];if(n.contains(e,i))return n}return null},t.inMarkHitTest=function(t,e,i,s){let r,a=Ig(t),o=s||2,h=jg.getContext();for(let t of a){if(!(t instanceof q))continue;let s=new Path2D(t.getSVGPathData());if(h.lineWidth=Math.max(t.strokeWidth,2*o),h.stroke(s),h.isPointInStroke(s,e,i)){r=t;break}}if(!r)return null;let l=[];for(let t of r.vertices){let e=Math.max(o,t.width,2*t.radius),i=Math.max(o,t.height,2*t.radius);l.push({i:t,b:new n(t.x-e/2,t.y-i/2,e,i)})}for(let t of l)if(t.b.contains(e,i))return t.i;if(r.segments&&r.segments.length>0)for(let t of r.segments){let s=new Path2D;if(s.moveTo(t.vertex1.x,t.vertex1.y),s.lineTo(t.vertex2.x,t.vertex2.y),h.lineWidth=Math.max(r.strokeWidth,o),h.stroke(s),h.isPointInStroke(s,e,i))return t}return null},t.inMarkRectHitTest=function t(e,i,s){let r=s||2;if(Mg(e)){let t=[];for(let i of e.vertices){let e=Math.max(r,i.width,2*i.radius),s=Math.max(r,i.height,2*i.radius);t.push({i:i,b:new n(i.x-e/2,i.y-s/2,e,s)})}if(e.type===k.Rect)for(let i of e.segments){let s=Math.max(e.strokeWidth,r);"v"===(i.vertex1.x===i.vertex2.x?"v":"h")?t.push({i:i,b:new n(i.vertex1.x-s/2,Math.min(i.vertex1.y,i.vertex2.y)-s/2,s,Math.abs(i.vertex1.y-i.vertex2.y))}):t.push({i:i,b:new n(Math.min(i.vertex1.x,i.vertex2.x)-s/2,i.vertex1.y-s/2,Math.abs(i.vertex1.x-i.vertex2.x),s)})}for(let e of t)if(e.b.overlap(i))return e.i;return null}if(!Rg(e)&&e.children&&e.children.length>0){for(let s of e.children)if(s.bounds.overlap(i)){let e=t(s,i,r);if(e)return e}return null}return null},t.layout=function(t,e){return qg(t,e)},t.linearGradient=function(t){return new D(t)},t.polarToCartesian=function(t,e,i,s){return Gg(t,e,i,s)},t.rectHitTest=function(t,e){let i=[];if(!t.children||0==t.children.length)return t.bounds.overlap(e)&&t.type!==k.Scene?[t]:[];for(let s=t.children.length-1;s>=0;s--){let n=t.children[s];n.bounds.overlap(e)&&i.push(n)}return i},t.renderer=function(t,e){if("svg"===t)return new rm(e)},t.scene=function(t){return new J_(t)},t.sceneLoader=function(){return new om},t.specExecutor=function(){return new dm},t.specGenerator=function(){return new am},t.treejson=async function(t){return async function(t){let e=await cm("GET",t);return new G_(JSON.parse(e),t)}(t)}}));
